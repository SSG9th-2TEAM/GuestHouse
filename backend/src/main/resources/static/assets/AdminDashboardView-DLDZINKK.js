import{_ as we,r as u,q as c,b as Ce,y as De,c as i,e,d as A,F as b,f as p,t as o,C as x,I as H,m as L,H as K,l as T,k as Ae,o as l,E as Se,z as V,D as Q}from"./index-DunUV3Ya.js";import{A as Ie}from"./AdminStatCard-vYTOlc5-.js";import{A as M}from"./AdminBadge-onkglhq_.js";import{A as Re}from"./AdminTableCard-C7R_ncHs.js";import{b as Ne,f as $e,A as Ee,a as Pe,t as j}from"./chartSeries-BdSf7CEO.js";import{e as xe,a as Le}from"./reportExport-DvZZ7m0X.js";import{f as Te,a as Ve}from"./adminApi-Dzdry8Ng.js";const Me={class:"admin-page"},Oe={class:"admin-grid"},Fe={key:0,class:"admin-status"},Be={key:1,class:"admin-status"},Ue={class:"admin-filter-bar"},Ge={class:"admin-filter-group"},We={class:"admin-period-label"},qe={class:"admin-filter-group"},Xe={class:"admin-dropdown"},ze={class:"admin-dropdown__menu"},Je={class:"admin-grid admin-grid--2 admin-grid--main"},He={class:"admin-table--nowrap admin-table--roomy"},Ke={class:"admin-strong"},Qe={class:"admin-strong"},je=["onClick"],Ye={key:0,class:"admin-status"},Ze={class:"admin-grid admin-grid--2 admin-grid--summary"},et={class:"admin-card admin-alerts-card"},tt={class:"admin-issue-grid"},at={class:"admin-issue-card__head"},nt=["title"],st={class:"admin-issue-card__count"},lt=["onClick"],it={class:"admin-issue-card__body"},ot={key:0,class:"admin-issue-skeleton"},rt={key:1,class:"admin-issue-error"},dt={key:2,class:"admin-issue-empty"},ut=["title"],ct={key:3,class:"admin-issue-table"},mt=["title"],vt={key:1},bt={key:0,class:"admin-status"},pt={class:"admin-card__footer"},gt={class:"admin-card admin-highlight"},ht={class:"admin-card__head"},yt={class:"admin-highlight-grid"},_t={class:"admin-highlight-label"},ft={class:"admin-highlight-sub"},kt={class:"admin-highlight-metric"},wt={class:"admin-highlight-value"},Ct={class:"admin-highlight-unit"},Dt={key:0,class:"admin-status"},At={class:"admin-card admin-placeholder-chart"},St={class:"admin-chart-area"},It={key:0,class:"admin-status"},Rt={key:1,class:"admin-status"},Nt={key:2,class:"admin-status"},$t={__name:"AdminDashboardView",setup(Et){const Y=Ae(),S=u([]),d=u(null),g=u([]),I=u([]),R=u([]),N=u({from:"",to:""}),$=u(!1),k=u(""),O=u([]),E=u(""),w=u("all"),h=u("30"),y=u(!1),v=u(""),Z=t=>t.toISOString().slice(0,10),ee=(t,a)=>{const n=t.map(r=>({id:`report-${r.reportId}`,title:`리뷰 신고 #${r.reportId}`,meta:r.title??"신고 사유 확인 필요",time:r.createdAt?.slice?.(0,10)??"-",tone:"warning",target:`/admin/reports?highlight=${r.reportId}`})),s=a.map(r=>({id:`acc-${r.accommodationsId}`,title:`숙소 심사 대기 #${r.accommodationsId}`,meta:r.name??"승인 대기 숙소",time:r.createdAt?.slice?.(0,10)??"-",tone:"accent",target:`/admin/accommodations?highlight=${r.accommodationsId}`}));return[...n,...s].slice(0,6)},te=t=>{const a=Number(t)||30,n=new Date,s=new Date;return s.setDate(n.getDate()-(a-1)),{from:j(s),to:j(n)}},ae={7:"최근 7일",30:"최근 30일",90:"최근 3개월"},ne=c(()=>ae[Number(h.value)]||"최근 30일"),F=t=>Pe(t),se=t=>`${(Number(t??0)*100).toFixed(1)}%`,le=t=>`₩${Number(t??0).toLocaleString()}`,ie=t=>Number(t??0).toLocaleString(),oe=t=>t||"미등록",C=t=>Number(t??0).toLocaleString(),B=t=>{const a=Number(t??0);if(!Number.isFinite(a))return"0";if(a<1)return"당일";const n=Math.round(a*10)/10;return Number.isInteger(n)?String(Math.round(n)):n.toFixed(1)},re=t=>{const a=Number(t??0);if(!Number.isFinite(a)||a<1)return"0";const n=Math.round(a*10)/10;return Number.isInteger(n)?String(Math.round(n)):n.toFixed(1)},_=async()=>{y.value=!0,v.value="",$.value=!0,k.value="";const t=te(h.value);N.value=t;const[a,n]=await Promise.all([Te(t),Ve({metric:"platform_fee",...t})]);if(a.ok&&a.data){const s=a.data;d.value=s;const r=s.platformFeeRate??0;if(S.value=[{label:"승인 대기 숙소",value:`${s.pendingAccommodations??0}건`,badge:"심사 대기",sub:"",tone:"warning",target:"/admin/accommodations?status=PENDING"},{label:"미처리 신고",value:`${s.openReports??0}건`,badge:"처리 필요",sub:"",tone:"warning",target:"/admin/reports?status=WAIT"},{label:"예약 생성",value:`${s.reservationCount??0}건`,badge:"선택 기간",sub:"",tone:"success",target:"/admin/bookings?sort=latest"},{label:"결제 성공",value:F(s.paymentSuccessAmount),badge:"선택 기간",sub:"",tone:"accent",target:"/admin/payments?status=success"},{label:"플랫폼 수익(수수료)",value:F(s.platformFeeAmount),badge:"선택 기간",sub:`수수료율 ${se(r)}`,tone:"primary",target:"/admin/payments?status=success"},{label:"결제 실패",value:`${s.paymentFailureCount??0}건`,badge:"실패/취소",sub:"",tone:"neutral",target:"/admin/payments?status=failed"},{label:"환불 요청",value:`${s.refundRequestCount??0}건`,badge:"요청",sub:"",tone:"neutral",target:"/admin/payments?type=refund"},{label:"환불 완료",value:`${s.refundCompletedCount??0}건`,badge:"완료",sub:"",tone:"neutral",target:"/admin/payments?type=refund"}],g.value=s.pendingAccommodationsList??[],I.value=s.openReportsList??[],O.value=ee(I.value,g.value),n.ok&&n.data){const m=n.data.points??[];R.value=m}else k.value="수익 추이를 불러오지 못했습니다.",R.value=[]}else v.value="대시보드 데이터를 불러오지 못했습니다.";$.value=!1,y.value=!1},P=c(()=>{const t=E.value.trim().toLowerCase();return g.value.filter(a=>{const n=!t||(a.name??"").toLowerCase().includes(t)||String(a.hostUserId??"").includes(t)||`${a.city??""} ${a.district??""}`.toLowerCase().includes(t),s=w.value==="all"||a.approvalStatus===w.value;return n&&s})}),U=t=>t==="PENDING"?"warning":t==="APPROVED"?"success":t==="REJECTED"?"danger":"neutral",de=(t,a)=>t==="pending"?U(a):t==="reports"&&["WAIT","OPEN","UNRESOLVED"].includes(a)?"danger":"neutral",ue=t=>t?t==="PENDING"?"대기":t==="APPROVED"?"승인":t==="REJECTED"?"반려":["WAIT","OPEN","UNRESOLVED"].includes(t)?"미처리":t==="DONE"?"처리":t:"-",G=t=>t?t.slice(0,10):"-",ce=t=>{if(!t)return"-";const a=new Date(t);if(Number.isNaN(a.getTime()))return"-";const n=Date.now()-a.getTime(),s=Math.floor(n/(1e3*60*60));return s<24?`${s}시간`:`${Math.floor(s/24)}일`},me=t=>{if(!t)return"기타";const a=String(t).toUpperCase();return a.includes("REVIEW")?"리뷰":a.includes("ACCOM")?"숙소":a.includes("USER")?"회원":a.includes("BOOK")?"예약":"기타"},W=c(()=>d.value?[{label:"승인 리드타임",sub:"평균 대기일",value:B(d.value.pendingLeadTimeAvgDays),unit:B(d.value.pendingLeadTimeAvgDays)==="당일"?"":"일"},{label:"48시간+ 미처리 신고",sub:"리스크",value:C(d.value.overdueOpenReports48h),unit:"건"},{label:"환불 요청(주간)",sub:"주간 합",value:C(d.value.weeklyRefundRequestCount),unit:"건"},{label:"환불 완료(주간)",sub:"주간 합",value:C(d.value.weeklyRefundCompletedCount),unit:"건"},{label:"결제 실패율(주간)",sub:"결제 실패/시도",value:re(d.value.weeklyPaymentFailureRate),unit:"%"},{label:"7일+ 승인 대기",sub:"대기 경과",value:C(d.value.weeklyPendingOver7Days),unit:"건"}]:[]),ve=c(()=>g.value.slice(0,2).map(t=>({id:`#${t.accommodationsId}`,name:t.name??"-",date:G(t.createdAt),status:t.approvalStatus??"PENDING"}))),be=c(()=>I.value.slice(0,2).map(t=>({id:`#${t.reportId}`,target:me(t.type),reason:t.title??"-",date:G(t.createdAt),elapsed:ce(t.createdAt),status:t.status??"WAIT"}))),pe=c(()=>{const t=Z(new Date);return g.value.filter(a=>a.createdAt?.slice?.(0,10)===t).length}),ge=t=>({id:"pending",title:"숙소 승인 대기",count:t.pendingAccommodations??0,tone:"warning",target:"/admin/accommodations?status=PENDING",columns:[{key:"id",label:"ID",width:"0.8fr"},{key:"name",label:"숙소명",width:"1.5fr"},{key:"date",label:"신청일",width:"1fr"},{key:"status",label:"상태",align:"right",width:"0.9fr"}],rows:ve.value,emptyMeta:g.value.length?`오늘 신규 ${pe.value}건`:"기간 내 신규 없음"}),he=t=>({id:"reports",title:"미처리 신고",count:t.openReports??0,tone:"danger",target:"/admin/reports?status=WAIT",columns:[{key:"id",label:"신고ID",width:"0.9fr"},{key:"target",label:"대상",width:"1fr"},{key:"reason",label:"사유",width:"1.6fr"},{key:"date",label:"등록일",width:"1fr"},{key:"elapsed",label:"경과",width:"0.9fr"},{key:"status",label:"상태",align:"right",width:"0.9fr"}],rows:be.value,emptyMeta:"기간 내 신규 없음"}),ye=t=>{const a=t.paymentFailureCount??0;return{id:"payments",title:"결제 실패/취소",count:a,tone:"neutral",target:"/admin/payments?status=failed",columns:[{key:"metric",label:"구분",width:"1.6fr"},{key:"value",label:"건수",align:"right",width:"0.8fr"}],rows:a>0?[{metric:"주간 합계",value:`${a}건`}]:[],emptyMeta:"최근 24h 신규 없음"}},_e=t=>{const a=t.refundRequestCount??0,n=t.refundCompletedCount??0;return{id:"refunds",title:"환불 요청/완료",count:a+n,tone:"accent",target:"/admin/payments?type=refund",columns:[{key:"metric",label:"구분",width:"1.6fr"},{key:"value",label:"건수",align:"right",width:"0.8fr"}],rows:a+n>0?[{metric:"요청",value:`${a}건`},{metric:"완료",value:`${n}건`}]:[],emptyMeta:"이번 기간 신규 없음"}},q=c(()=>d.value?[ge(d.value),he(d.value),ye(d.value),_e(d.value)]:[]),X=t=>t?.length?t.map(a=>a.width||"1fr").join(" "):"1fr",D=c(()=>Ne(N.value.from,N.value.to)),z=c(()=>D.value.length?$e(D.value,R.value,t=>String(t.date??"").slice(0,10),t=>t.value):[]),fe=c(()=>{const t=D.value.length;return t<=8?t:8}),ke=c(()=>z.value.some(t=>Number(t??0)!==0)),f=t=>{t&&Y.push(t)},J=t=>{const a=new Date().toISOString().slice(0,10),n=[{name:"요약 지표",columns:[{key:"label",label:"지표"},{key:"value",label:"값"},{key:"sub",label:"설명"}],rows:S.value},{name:"승인 대기 숙소",columns:[{key:"id",label:"ID"},{key:"name",label:"숙소명"},{key:"host",label:"호스트"},{key:"location",label:"위치"},{key:"type",label:"유형"},{key:"rooms",label:"객실"},{key:"nightlyPrice",label:"가격(1박)"},{key:"contact",label:"연락처"},{key:"submittedAt",label:"신청일"},{key:"status",label:"상태"}],rows:P.value},{name:"운영 알림",columns:[{key:"title",label:"알림"},{key:"meta",label:"메타"},{key:"time",label:"시간"}],rows:O.value}];if(t==="xlsx"){xe({filename:`admin-dashboard-report-${a}.xlsx`,sheets:n});return}Le({filename:`admin-dashboard-report-${a}.csv`,sheets:n})};return Ce(_),De(h,_),(t,a)=>(l(),i("section",Me,[a[19]||(a[19]=e("header",{class:"admin-page__header"},[e("div",null,[e("h1",{class:"admin-title"},"관리자 대시보드"),e("p",{class:"admin-subtitle"},"주요 지표와 거래 현황을 한 눈에 확인하세요.")])],-1)),e("div",Oe,[(l(!0),i(b,null,p(S.value,n=>(l(),T(Ie,{key:n.label,label:n.label,value:n.value,sub:n.sub,badge:n.badge,tone:n.tone,clickable:!!n.target,onClick:s=>f(n.target)},null,8,["label","value","sub","badge","tone","clickable","onClick"]))),128)),y.value?(l(),i("div",Fe,"불러오는 중...")):v.value?(l(),i("div",Be,[e("span",null,o(v.value),1),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:_},"다시 시도")])):A("",!0)]),e("div",Ue,[e("div",Ge,[a[8]||(a[8]=e("span",{class:"admin-chip"},"운영 기간",-1)),x(e("select",{"onUpdate:modelValue":a[0]||(a[0]=n=>h.value=n),class:"admin-select"},[...a[7]||(a[7]=[e("option",{value:"7"},"최근 7일",-1),e("option",{value:"30"},"최근 30일",-1),e("option",{value:"90"},"최근 3개월",-1)])],512),[[H,h.value]]),e("span",We,"선택 기간: "+o(ne.value),1)]),e("div",qe,[a[10]||(a[10]=e("span",{class:"admin-chip"},"빠른 작업",-1)),e("details",Xe,[a[9]||(a[9]=e("summary",{class:"admin-btn admin-btn--ghost"},"다운로드",-1)),e("div",ze,[e("button",{class:"admin-btn admin-btn--ghost admin-dropdown__item",type:"button",onClick:a[1]||(a[1]=n=>J("csv"))}," CSV "),e("button",{class:"admin-btn admin-btn--primary admin-dropdown__item",type:"button",onClick:a[2]||(a[2]=n=>J("xlsx"))}," XLSX ")])])])]),e("div",Je,[L(Re,{title:"승인 대기 숙소",class:"admin-table-card--wide"},{actions:K(()=>[x(e("input",{"onUpdate:modelValue":a[3]||(a[3]=n=>E.value=n),class:"admin-input",type:"search",placeholder:"숙소/호스트/지역 검색"},null,512),[[Se,E.value]]),x(e("select",{"onUpdate:modelValue":a[4]||(a[4]=n=>w.value=n),class:"admin-select"},[...a[11]||(a[11]=[e("option",{value:"all"},"전체 상태",-1),e("option",{value:"PENDING"},"대기",-1),e("option",{value:"APPROVED"},"승인",-1),e("option",{value:"REJECTED"},"반려",-1)])],512),[[H,w.value]])]),default:K(()=>[e("table",He,[a[12]||(a[12]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"숙소명"),e("th",null,"호스트"),e("th",null,"위치"),e("th",null,"유형"),e("th",null,"객실"),e("th",null,"가격(1박)"),e("th",null,"연락처"),e("th",null,"신청일"),e("th",null,"상태"),e("th",null,"관리")])],-1)),e("tbody",null,[(l(!0),i(b,null,p(P.value,n=>(l(),i("tr",{key:n.accommodationsId},[e("td",Ke,"#"+o(n.accommodationsId),1),e("td",Qe,o(n.name),1),e("td",null,o(n.hostUserId),1),e("td",null,o(n.city)+" "+o(n.district),1),e("td",null,o(n.category),1),e("td",null,o(ie(n.roomCount)),1),e("td",null,o(le(n.minPrice)),1),e("td",null,o(oe(n.hostPhone)),1),e("td",null,o(n.createdAt?.slice?.(0,10)??"-"),1),e("td",null,[L(M,{text:n.approvalStatus,variant:U(n.approvalStatus)},null,8,["text","variant"])]),e("td",null,[e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s=>f(`/admin/accommodations?highlight=${n.accommodationsId}`)}," 상세 보기 ",8,je)])]))),128))])]),P.value.length?A("",!0):(l(),i("div",Ye,"승인 대기 숙소가 없습니다."))]),_:1})]),e("div",Ze,[e("div",et,[a[16]||(a[16]=e("div",{class:"admin-card__head"},[e("div",null,[e("p",{class:"admin-card__eyebrow"},"운영 이슈 센터"),e("h3",{class:"admin-card__title"},"바로 조치할 항목")])],-1)),e("div",tt,[(l(!0),i(b,null,p(q.value,n=>(l(),i("div",{key:n.id,class:V(["admin-issue-card",`admin-issue-card--${n.tone}`])},[e("div",at,[e("div",null,[e("p",{class:"admin-issue-card__title",title:n.title},o(n.title),9,nt),e("p",st,o(n.count)+"건",1)]),e("button",{class:"admin-btn admin-btn--ghost admin-issue-card__link",type:"button",onClick:s=>f(n.target)}," 바로가기 ",8,lt)]),e("div",it,[y.value?(l(),i("div",ot,[...a[13]||(a[13]=[e("span",{class:"admin-issue-skeleton__line"},null,-1),e("span",{class:"admin-issue-skeleton__line"},null,-1),e("span",{class:"admin-issue-skeleton__line admin-issue-skeleton__line--short"},null,-1)])])):v.value?(l(),i("div",rt,[a[14]||(a[14]=e("p",{class:"admin-issue-error__text"},"데이터를 불러오지 못했습니다.",-1)),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:_},"재시도")])):n.count===0?(l(),i("div",dt,[a[15]||(a[15]=e("div",{class:"admin-issue-empty__count"},"0건",-1)),L(M,{text:"정상",variant:"success"}),e("p",{class:"admin-issue-empty__desc",title:n.emptyMeta},o(n.emptyMeta),9,ut)])):(l(),i("div",ct,[e("div",{class:"admin-issue-table__row admin-issue-table__head",style:Q({gridTemplateColumns:X(n.columns)})},[(l(!0),i(b,null,p(n.columns,s=>(l(),i("span",{key:s.key,class:V(["admin-issue-table__cell",{"is-right":s.align==="right"}])},o(s.label),3))),128))],4),(l(!0),i(b,null,p(n.rows,(s,r)=>(l(),i("div",{key:r,class:"admin-issue-table__row",style:Q({gridTemplateColumns:X(n.columns)})},[(l(!0),i(b,null,p(n.columns,m=>(l(),i("span",{key:m.key,class:V(["admin-issue-table__cell",{"is-right":m.align==="right"}]),title:String(s[m.key]??"-")},[m.key==="status"?(l(),T(M,{key:0,text:ue(s[m.key]),variant:de(n.id,s[m.key])},null,8,["text","variant"])):(l(),i("span",vt,o(s[m.key]??"-"),1))],10,mt))),128))],4))),128))]))])],2))),128)),q.value.length?A("",!0):(l(),i("div",bt,"이슈 데이터를 불러오는 중입니다."))]),e("div",pt,[e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:a[5]||(a[5]=n=>f("/admin/dashboard/issues"))},"전체 보기")])]),e("div",gt,[e("div",ht,[a[17]||(a[17]=e("div",null,[e("p",{class:"admin-card__eyebrow"},"운영 요약"),e("h3",{class:"admin-card__title"},"이번 주 주요 지표"),e("p",{class:"admin-card__caption"},"기간: 이번 주(월~오늘)")],-1)),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:a[6]||(a[6]=n=>f("/admin/dashboard/weekly"))},"리포트 보기")]),e("div",yt,[(l(!0),i(b,null,p(W.value,n=>(l(),i("div",{key:n.label,class:"admin-highlight-item"},[e("div",null,[e("p",_t,o(n.label),1),e("p",ft,o(n.sub),1)]),e("div",kt,[e("p",wt,o(n.value),1),e("span",Ct,o(n.unit),1)])]))),128)),W.value.length?A("",!0):(l(),i("div",Dt,"요약 데이터를 불러오는 중입니다."))])])]),e("div",At,[a[18]||(a[18]=e("div",{class:"admin-card__head"},[e("div",null,[e("p",{class:"admin-card__eyebrow"},"수익 추이"),e("h3",{class:"admin-card__title"},"플랫폼 수익(수수료) 추이")])],-1)),e("div",St,[y.value||$.value?(l(),i("div",It,"불러오는 중...")):v.value||k.value?(l(),i("div",Rt,[e("span",null,o(v.value||k.value),1),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:_},"다시 시도")])):ke.value?(l(),T(Ee,{key:3,labels:D.value,values:z.value,height:260,"max-x-ticks":fe.value},null,8,["labels","values","max-x-ticks"])):(l(),i("div",Nt,"표시할 데이터가 없습니다."))])])]))}},Ft=we($t,[["__scopeId","data-v-98b58197"]]);export{Ft as default};
