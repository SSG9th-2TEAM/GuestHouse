import{_ as H,r as o,b as G,s as X,y as Z,c as r,e,m as q,t as i,C as h,E as R,I as tt,a as et,w as at,n as nt,H as st,k as ot,o as c,d as k,F as lt,f as it,p as dt,z as U}from"./index-GmEodlcO.js";import{A as ut}from"./AdminTableCard-DIWKKD67.js";import{d as rt}from"./adminApi-CaZYCdyU.js";import{t as L,e as ct,a as pt}from"./adminData-ZmZ3C3cR.js";import{d as vt}from"./formatters-De2UUEom.js";const D={ACCOMMODATIONS:"/admin/accommodations",USERS:"/admin/users",PAYMENTS:"/admin/payments",REPORTS:"/admin/reports"},mt={class:"admin-page"},gt={class:"admin-page__header"},bt={class:"admin-summary-chip"},yt={class:"admin-filter-bar"},ft={class:"admin-filter-group"},ht={class:"admin-preset-group"},Dt={class:"admin-filter-group"},Et={class:"admin-filter-group"},At=["onKeydown"],_t={class:"admin-audit-table admin-table--nowrap"},St={class:"is-center"},wt={class:"is-center"},Ct={class:"is-center"},Tt=["disabled","onClick"],Rt={class:"admin-audit-reason col-reason"},kt=["title"],Nt={class:"reason-text__content clamp-2"},Vt={class:"is-center"},Pt={key:0},$t={key:0,class:"admin-status"},Mt={key:1,class:"admin-status"},xt={key:2,class:"admin-pagination"},It=["disabled"],Ot=["disabled"],Ut={__name:"AdminAuditLogView",setup(Lt){const E=o([]),u=o("all"),v=o(""),d=o(""),l=o(""),s=o(0),A=o(20),_=o(0),S=o(0),f=o(!1),m=o(""),g=X(),N=ot(),w=o(!1),b=a=>{if(!a)return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),y=String(a.getDate()).padStart(2,"0");return`${t}-${n}-${y}`},V=()=>{const a=new Date,t=new Date;t.setDate(a.getDate()-6),d.value=b(t),l.value=b(a)},p=a=>{const t={...g.query,...a},n=L(t),y=L(g.query);Object.keys({...n,...y}).every(O=>String(n[O]??"")===String(y[O]??""))||N.replace({query:n})},P=async()=>{f.value=!0,m.value="";const a=await rt({startDate:d.value||void 0,endDate:l.value||void 0,actionType:u.value==="all"?void 0:u.value,keyword:v.value||void 0,page:s.value,size:A.value});if(a.ok&&a.data){const t=a.data;E.value=ct(t);const n=pt(t);s.value=n.page,A.value=n.size,_.value=n.totalPages,S.value=n.totalElements}else m.value="감사 로그를 불러오지 못했습니다.";f.value=!1},C=a=>{const t=new Date,n=new Date;n.setDate(t.getDate()-(a-1)),d.value=b(n),l.value=b(t),s.value=0,p({startDate:d.value,endDate:l.value,page:s.value})},F=()=>{s.value=0,p({actionType:u.value==="all"?void 0:u.value,page:s.value})},$=()=>{s.value=0,p({keyword:v.value||void 0,page:s.value})},M=()=>{s.value=0,p({startDate:d.value||void 0,endDate:l.value||void 0,page:s.value})},x=a=>{s.value=a,p({page:s.value})},T=a=>!a||a==="-"?"없음":a,B={APPROVE:"승인",REJECT:"반려",REFUND:"환불",BAN:"정지",UNBAN:"해제",RESOLVE:"처리"},z={APPROVE:"success",REJECT:"danger",REFUND:"accent",BAN:"warning",UNBAN:"neutral",RESOLVE:"primary"},Y={ACC:"숙소",USER:"회원",PAY:"결제",REVIEW:"리뷰"},K=a=>Y[a]??a??"-",J=a=>B[a]??a??"-",Q=a=>z[a]??"neutral",I=a=>{const t=a?.targetId;return t?a?.targetType==="ACC"?`${D.ACCOMMODATIONS}?highlight=${t}`:a?.targetType==="USER"?`${D.USERS}?highlight=${t}`:a?.targetType==="PAY"?`${D.PAYMENTS}?highlight=${t}`:a?.targetType==="REVIEW"?`${D.REPORTS}?highlight=${t}`:null:null},W=a=>{const t=I(a);t&&N.push(t)},j=a=>{u.value=a.actionType??"all",v.value=a.keyword??"",s.value=Number(a.page??0),A.value=Number(a.size??20),a.startDate?d.value=a.startDate:V(),a.endDate?l.value=a.endDate:l.value=l.value||b(new Date)};return G(()=>{V(),(!g.query.startDate||!g.query.endDate)&&(w.value=!0,p({startDate:d.value,endDate:l.value,page:s.value}))}),Z(()=>g.query,a=>{w.value&&(!a.startDate||!a.endDate)||(w.value=!1,j(a),P())},{immediate:!0}),(a,t)=>(c(),r("section",mt,[e("header",gt,[t[9]||(t[9]=e("div",null,[e("h1",{class:"admin-title"},"감사 로그"),e("p",{class:"admin-subtitle"},"관리자 주요 액션 기록을 조회합니다.")],-1)),e("div",bt," 총 "+i(S.value.toLocaleString())+"건 ",1)]),e("div",yt,[e("div",ft,[t[10]||(t[10]=e("span",{class:"admin-chip"},"기간",-1)),h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>d.value=n),class:"admin-input",type:"date",onChange:M},null,544),[[R,d.value]]),t[11]||(t[11]=e("span",{class:"admin-divider"},"~",-1)),h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>l.value=n),class:"admin-input",type:"date",onChange:M},null,544),[[R,l.value]]),e("div",ht,[e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:t[2]||(t[2]=n=>C(7))},"최근 7일(오늘 포함)"),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:t[3]||(t[3]=n=>C(30))},"최근 30일(오늘 포함)"),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:t[4]||(t[4]=n=>C(90))},"최근 90일(오늘 포함)")])]),e("div",Dt,[t[13]||(t[13]=e("span",{class:"admin-chip"},"액션 필터",-1)),h(e("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>u.value=n),class:"admin-select",onChange:F},[...t[12]||(t[12]=[et('<option value="all" data-v-b7a2e610>전체</option><option value="APPROVE" data-v-b7a2e610>승인</option><option value="REJECT" data-v-b7a2e610>반려</option><option value="REFUND" data-v-b7a2e610>환불</option><option value="BAN" data-v-b7a2e610>정지</option><option value="UNBAN" data-v-b7a2e610>해제</option>',6)])],544),[[tt,u.value]])]),e("div",Et,[t[14]||(t[14]=e("span",{class:"admin-chip"},"검색",-1)),h(e("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>v.value=n),class:"admin-input",type:"search",placeholder:"대상ID, 사유, 대상 타입",onKeydown:at(nt($,["prevent"]),["enter"])},null,40,At),[[R,v.value]]),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:$},"검색")])]),q(ut,{title:"감사 로그",class:"admin-audit-card"},{default:st(()=>[e("table",_t,[t[16]||(t[16]=e("colgroup",null,[e("col",{style:{width:"180px"}}),e("col",{style:{width:"110px"}}),e("col",{style:{width:"90px"}}),e("col",{style:{width:"120px"}}),e("col"),e("col",{style:{width:"90px"}})],-1)),t[17]||(t[17]=e("thead",null,[e("tr",null,[e("th",null,"시간"),e("th",{class:"is-center"},"액션"),e("th",{class:"is-center"},"대상"),e("th",{class:"is-center"},"대상ID"),e("th",{class:"col-reason"},"사유"),e("th",{class:"is-center"},"관리자ID")])],-1)),e("tbody",null,[(c(!0),r(lt,null,it(E.value,n=>(c(),r("tr",{key:n.logId},[e("td",null,i(dt(vt)(n.createdAt,!0)),1),e("td",St,[e("span",{class:U(["admin-action-badge",`admin-action-badge--${Q(n.actionType)}`])},i(J(n.actionType)),3)]),e("td",wt,i(K(n.targetType)),1),e("td",Ct,[e("button",{class:"admin-link-button",type:"button",disabled:!I(n),onClick:y=>W(n)},i(n.targetId),9,Tt)]),e("td",Rt,[e("span",{class:U(["reason-text",{"reason-text--empty":T(n.reason)==="없음"}]),title:T(n.reason)},[e("span",Nt,i(T(n.reason)),1)],10,kt)]),e("td",Vt,i(n.adminId),1)]))),128)),!E.value.length&&!f.value&&!m.value?(c(),r("tr",Pt,[...t[15]||(t[15]=[e("td",{class:"admin-audit-empty",colspan:"6"},"조건에 맞는 로그가 없습니다.",-1)])])):k("",!0)])]),f.value?(c(),r("div",$t,"불러오는 중...")):m.value?(c(),r("div",Mt,[e("span",null,i(m.value),1),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:P},"다시 시도")])):k("",!0),S.value>0?(c(),r("div",xt,[e("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:s.value<=0,onClick:t[7]||(t[7]=n=>x(s.value-1))}," 이전 ",8,It),e("span",null,i(s.value+1)+" / "+i(Math.max(_.value,1)),1),e("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:s.value+1>=_.value,onClick:t[8]||(t[8]=n=>x(s.value+1))}," 다음 ",8,Ot)])):k("",!0)]),_:1})]))}},Qt=H(Ut,[["__scopeId","data-v-b7a2e610"]]);export{Qt as default};
