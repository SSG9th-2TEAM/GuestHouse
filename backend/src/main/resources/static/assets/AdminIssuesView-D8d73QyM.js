import{_ as nt,r as m,x as r,d as et,c as o,e as t,f as b,w as at,N as ot,t as i,F as p,i as x,n as E,p as v,I as k,q as it,m as lt,o as a}from"./index-ChMRK3m0.js";import{A as dt}from"./AdminStatCard-BMFaXmkb.js";import{A as _}from"./AdminBadge-ECazdGCh.js";import{A as H}from"./AdminTableCard-K0Ji3Qjx.js";import{b as ut}from"./adminApi-Bj5BGWJN.js";const rt={class:"admin-page"},ct={class:"admin-page__header"},mt={class:"admin-header-actions"},pt={class:"admin-check"},vt={class:"admin-update-meta"},_t=["disabled"],bt={class:"admin-grid"},yt={key:0,class:"admin-status"},gt={key:1,class:"admin-status"},ft={class:"admin-grid admin-grid--2"},ht={key:0,class:"admin-issue-accordion"},Ct={class:"admin-issue-accordion__summary"},kt={class:"admin-issue-accordion__body"},wt={class:"admin-table--tight admin-issue-table admin-issue-table--pending"},At={class:"admin-strong"},Dt={class:"admin-strong"},It={class:"admin-issue-cell--center admin-issue-cell--date"},xt={class:"admin-issue-cell--center"},Et={class:"admin-issue-cell--center"},$t={key:0,class:"admin-issue-accordion"},Nt={class:"admin-issue-accordion__summary"},Rt={class:"admin-issue-accordion__body"},St={class:"admin-table--tight admin-issue-table admin-issue-table--reports"},Tt={class:"admin-strong"},Ft=["title"],Vt={class:"admin-issue-cell--center admin-issue-cell--date"},Lt={class:"admin-issue-cell--center"},Mt={class:"admin-issue-cell--center"},Ot={class:"admin-issue-cell--center"},Ut=["onClick"],Bt={class:"admin-grid admin-grid--2"},Pt={key:0,class:"admin-issue-accordion"},Wt={class:"admin-issue-accordion__summary"},Ht={class:"admin-issue-accordion__body"},Gt={key:1,class:"admin-card"},qt={class:"admin-card__head"},Jt={class:"admin-card__title"},Kt={key:0,class:"admin-issue-accordion"},Yt={class:"admin-issue-accordion__summary"},Zt={class:"admin-issue-accordion__body"},jt={key:1,class:"admin-card"},zt={class:"admin-card__head"},Qt={class:"admin-card__title"},Xt={class:"admin-modal__content"},ts={class:"admin-modal__head"},ss={class:"admin-modal__actions"},ns={class:"admin-modal__body"},es={class:"admin-modal__row"},as={class:"admin-modal__row"},os={class:"admin-modal__row"},is={class:"admin-modal__row admin-modal__row--detail"},ls={class:"admin-modal__row"},ds={class:"admin-modal__row"},us={class:"admin-modal__row"},rs={__name:"AdminIssuesView",setup(cs){const G=lt(),w=m([]),d=m({pendingAccommodations:0,openReports:0,refundCount:0,paymentFailureCount:0,pendingAccommodationsList:[],openReportsList:[]}),y=m(!1),g=m(""),f=m(!1),$=m(""),l=m(null),N=e=>e.toISOString().slice(0,10),h=e=>String(e).padStart(2,"0"),q=e=>{if(!e)return"-";const s=new Date(e);return Number.isNaN(s.getTime())?"-":`${s.getFullYear()}-${h(s.getMonth()+1)}-${h(s.getDate())} ${h(s.getHours())}:${h(s.getMinutes())}`},J=e=>{if(!e)return!1;const s=new Date(e);return Number.isNaN(s.getTime())?!1:Date.now()-s.getTime()>=2880*60*1e3},R=e=>(e??[]).filter(s=>J(s.createdAt)).length,A=async()=>{y.value=!0,g.value="";const e=new Date,s={from:N(e),to:N(e)},n=await ut(s);if(n.ok&&n.data){d.value=n.data;const c=n.data.pendingAccommodations??0,O=n.data.openReports??0,U=n.data.paymentFailureCount??0,B=n.data.refundCount??0,P=R(n.data.pendingAccommodationsList),W=R(n.data.openReportsList);w.value=[{label:"승인 대기 숙소",count:c,value:`${c}건`,sub:"심사 대기",badge:P?`48시간+ ${P}건`:"",tone:"warning"},{label:"미처리 신고",count:O,value:`${O}건`,sub:"처리 필요",badge:W?`48시간+ ${W}건`:"",tone:"warning"},{label:"결제 실패",count:U,value:`${U}건`,sub:"실패/취소",tone:"neutral"},{label:"환불 요청",count:B,value:`${B}건`,sub:"요청/완료",tone:"accent"}],$.value=new Date().toISOString()}else g.value="이슈 센터 데이터를 불러오지 못했습니다.";y.value=!1},K=e=>e==="PENDING"?"warning":e==="APPROVED"?"success":e==="REJECTED"?"danger":"neutral",S=e=>e==="WAIT"?"warning":e==="CHECKED"?"success":"neutral",D=e=>{const s=String(e?.type??"").toUpperCase();return s.includes("REVIEW")?"리뷰":s.includes("ACCOM")?"숙소":s.includes("USER")?"회원":s.includes("RESERV")?"예약":"기타"},Y=e=>e?.title??"-",Z=e=>e?.content??e?.description??e?.detail??e?.message??"",I=e=>{if(!e)return"-";const s=new Date(e);if(Number.isNaN(s.getTime()))return"-";const n=Date.now()-s.getTime(),c=Math.floor(n/(1e3*60*60));return c<24?`${c}h`:`${Math.floor(c/24)}일`},u=e=>{e&&G.push(e)},j=e=>{l.value=e},T=()=>{l.value=null},z=r(()=>f.value?w.value:w.value.filter(e=>(e.count??0)>0)),F=r(()=>d.value.pendingAccommodations??0),V=r(()=>d.value.openReports??0),L=r(()=>d.value.paymentFailureCount??0),M=r(()=>d.value.refundCount??0),C=e=>f.value||e>0,Q=r(()=>F.value===0),X=r(()=>V.value===0),tt=r(()=>L.value===0),st=r(()=>M.value===0);return et(A),(e,s)=>(a(),o("section",rt,[t("header",ct,[s[11]||(s[11]=t("div",null,[t("h1",{class:"admin-title"},"운영 이슈 센터"),t("p",{class:"admin-subtitle"},"오늘 확인해야 할 운영 이슈를 빠르게 점검합니다.")],-1)),t("div",mt,[t("label",pt,[at(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>f.value=n),type:"checkbox"},null,512),[[ot,f.value]]),s[10]||(s[10]=t("span",null,"이상 없음 포함",-1))]),t("div",vt," 마지막 갱신: "+i(q($.value)),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:y.value,onClick:A},i(y.value?"새로고침 중...":"새로고침"),9,_t)])]),t("div",bt,[(a(!0),o(p,null,x(z.value,n=>(a(),E(dt,{key:n.label,label:n.label,value:n.value,sub:n.sub,badge:n.badge,tone:n.tone},null,8,["label","value","sub","badge","tone"]))),128)),y.value?(a(),o("div",yt,"불러오는 중...")):g.value?(a(),o("div",gt,[t("span",null,i(g.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:A},"다시 시도")])):b("",!0)]),t("div",ft,[C(F.value)?(a(),o(p,{key:0},[Q.value?(a(),o("details",ht,[t("summary",Ct,[s[12]||(s[12]=t("span",null,"숙소 승인 대기",-1)),v(_,{text:"이상 없음",variant:"success"}),s[13]||(s[13]=t("span",{class:"admin-issue-accordion__meta"},"기간 내 신규 없음",-1))]),t("div",kt,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s[1]||(s[1]=n=>u("/admin/accommodations?status=PENDING"))}," 숙소 관리로 이동 ")])])):(a(),E(H,{key:1,title:"숙소 승인 대기"},{actions:k(()=>[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s[2]||(s[2]=n=>u("/admin/accommodations?status=PENDING"))}," 바로가기 ")]),default:k(()=>[t("table",wt,[s[14]||(s[14]=t("colgroup",null,[t("col",{style:{width:"90px"}}),t("col",{style:{width:"1fr"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"80px"}}),t("col",{style:{width:"100px"}})],-1)),s[15]||(s[15]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"숙소명"),t("th",null,"신청일"),t("th",null,"경과"),t("th",null,"상태")])],-1)),t("tbody",null,[(a(!0),o(p,null,x(d.value.pendingAccommodationsList,n=>(a(),o("tr",{key:n.accommodationsId},[t("td",At,"#"+i(n.accommodationsId),1),t("td",Dt,i(n.name),1),t("td",It,i(n.createdAt?.slice?.(0,10)??"-"),1),t("td",xt,i(I(n.createdAt)),1),t("td",Et,[v(_,{text:n.approvalStatus,variant:K(n.approvalStatus)},null,8,["text","variant"])])]))),128))])])]),_:1}))],64)):b("",!0),C(V.value)?(a(),o(p,{key:1},[X.value?(a(),o("details",$t,[t("summary",Nt,[s[16]||(s[16]=t("span",null,"미처리 신고",-1)),v(_,{text:"이상 없음",variant:"success"}),s[17]||(s[17]=t("span",{class:"admin-issue-accordion__meta"},"기간 내 신규 없음",-1))]),t("div",Rt,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s[3]||(s[3]=n=>u("/admin/reports?status=WAIT"))}," 신고 관리로 이동 ")])])):(a(),E(H,{key:1,title:"미처리 신고"},{actions:k(()=>[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s[4]||(s[4]=n=>u("/admin/reports?status=WAIT"))}," 바로가기 ")]),default:k(()=>[t("table",St,[s[18]||(s[18]=t("colgroup",null,[t("col",{style:{width:"90px"}}),t("col",{style:{width:"110px"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"80px"}}),t("col",{style:{width:"90px"}}),t("col",{style:{width:"90px"}})],-1)),s[19]||(s[19]=t("thead",null,[t("tr",null,[t("th",null,"신고ID"),t("th",null,"대상"),t("th",null,"등록일"),t("th",null,"경과"),t("th",null,"상태"),t("th",null,"액션")])],-1)),t("tbody",null,[(a(!0),o(p,null,x(d.value.openReportsList,n=>(a(),o("tr",{key:n.reportId},[t("td",Tt,i(n.reportId?`#${n.reportId}`:"-"),1),t("td",{class:"admin-issue-cell--center",title:D(n)},i(D(n)),9,Ft),t("td",Vt,i(n.createdAt?.slice?.(0,10)??"-"),1),t("td",Lt,i(I(n.createdAt)),1),t("td",Mt,[v(_,{text:n.status,variant:S(n.status)},null,8,["text","variant"])]),t("td",Ot,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:c=>j(n)}," 보기/처리 ",8,Ut)])]))),128))])])]),_:1}))],64)):b("",!0)]),t("div",Bt,[C(L.value)?(a(),o(p,{key:0},[tt.value?(a(),o("details",Pt,[t("summary",Wt,[s[20]||(s[20]=t("span",null,"결제 실패/취소",-1)),v(_,{text:"이상 없음",variant:"success"}),s[21]||(s[21]=t("span",{class:"admin-issue-accordion__meta"},"기간 내 신규 없음",-1))]),t("div",Ht,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s[5]||(s[5]=n=>u("/admin/payments?status=FAILED"))}," 결제 관리로 이동 ")])])):(a(),o("div",Gt,[t("div",qt,[t("div",null,[s[22]||(s[22]=t("p",{class:"admin-card__eyebrow"},"결제 실패/취소",-1)),t("h3",Jt,i(d.value.paymentFailureCount??0)+"건",1)]),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s[6]||(s[6]=n=>u("/admin/payments?status=FAILED"))}," 바로가기 ")]),s[23]||(s[23]=t("div",{class:"admin-card__meta"},[t("p",{class:"admin-card__desc"}," 최근 결제 실패/취소 건을 빠르게 확인하세요. ")],-1))]))],64)):b("",!0),C(M.value)?(a(),o(p,{key:1},[st.value?(a(),o("details",Kt,[t("summary",Yt,[s[24]||(s[24]=t("span",null,"환불 요청/완료",-1)),v(_,{text:"이상 없음",variant:"success"}),s[25]||(s[25]=t("span",{class:"admin-issue-accordion__meta"},"기간 내 신규 없음",-1))]),t("div",Zt,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s[7]||(s[7]=n=>u("/admin/payments?status=REFUNDED"))}," 환불 내역으로 이동 ")])])):(a(),o("div",jt,[t("div",zt,[t("div",null,[s[26]||(s[26]=t("p",{class:"admin-card__eyebrow"},"환불 요청/완료",-1)),t("h3",Qt,i(d.value.refundCount??0)+"건",1)]),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s[8]||(s[8]=n=>u("/admin/payments?status=REFUNDED"))}," 바로가기 ")]),s[27]||(s[27]=t("div",{class:"admin-card__meta"},[t("p",{class:"admin-card__desc"}," 환불 진행 내역을 확인할 수 있습니다. ")],-1))]))],64)):b("",!0)]),l.value?(a(),o("div",{key:0,class:"admin-modal",onClick:it(T,["self"])},[t("div",Xt,[t("div",ts,[s[28]||(s[28]=t("h3",null,"신고 상세",-1)),t("div",ss,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:s[9]||(s[9]=n=>u("/admin/reports?status=WAIT"))}," 신고 관리로 이동 "),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:T},"닫기")])]),t("div",ns,[t("div",es,[s[29]||(s[29]=t("span",null,"신고ID",-1)),t("strong",null,i(l.value.reportId?`#${l.value.reportId}`:"-"),1)]),t("div",as,[s[30]||(s[30]=t("span",null,"대상",-1)),t("strong",null,i(D(l.value)),1)]),t("div",os,[s[31]||(s[31]=t("span",null,"사유",-1)),t("strong",null,i(Y(l.value)),1)]),t("div",is,[s[32]||(s[32]=t("span",null,"내용",-1)),t("p",null,i(Z(l.value)||"-"),1)]),t("div",ls,[s[33]||(s[33]=t("span",null,"등록일",-1)),t("strong",null,i(l.value.createdAt?.slice?.(0,10)??"-"),1)]),t("div",ds,[s[34]||(s[34]=t("span",null,"경과",-1)),t("strong",null,i(I(l.value.createdAt)),1)]),t("div",us,[s[35]||(s[35]=t("span",null,"상태",-1)),v(_,{text:l.value.status,variant:S(l.value.status)},null,8,["text","variant"])])])])])):b("",!0)]))}},ys=nt(rs,[["__scopeId","data-v-4822b495"]]);export{ys as default};
