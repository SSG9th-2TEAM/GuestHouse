import{_ as K,r as m,q as I,b as M,c as a,e as t,p as U,k as L,t as n,F as g,f as $,i as P,o as c,w as R,z as l,n as N,A as V}from"./index-CdO51RKj.js";import{getMyReservations as B,deleteCompletedReservation as F}from"./reservationApi-CJCzkSxj.js";const q={class:"reservation-page container"},z={class:"header-section"},T={key:0,class:"loading-state"},E={key:1,class:"error-state"},W={class:"section"},Y={key:0,class:"empty-state"},j={key:1,class:"card-list"},G=["onClick","onKeydown"],J={class:"card-content"},O=["src"],Q={class:"card-info"},X={class:"res-title"},Z={class:"res-loc"},ss={class:"res-details"},ts={class:"val"},os={class:"res-details"},es={class:"val"},ns={class:"res-details"},as={class:"val"},cs={class:"val"},is={class:"res-price"},ls={class:"price-val"},rs=["onClick"],ds={class:"section"},us={key:0,class:"empty-state"},vs={key:1,class:"card-list"},ps=["onClick","onKeydown"],ks={class:"card-content"},hs=["src"],_s={class:"card-info"},ms={class:"res-title"},gs={class:"res-loc"},ys={class:"res-details"},bs={class:"val"},ws={class:"res-details"},fs={class:"val"},Cs={class:"val"},Ds={class:"res-price"},Is={class:"price-val"},$s=["onClick","disabled"],Rs={key:1,class:"action-btn review completed",disabled:""},Ns=["onClick","disabled","title"],Ss={__name:"ReservationHistoryView",setup(As){const d=L(),p=m(!0),u=m(""),v=m([]),k=new Date;k.setHours(0,0,0,0);const y=I(()=>v.value.filter(o=>{const s=new Date(o.checkin);return s.setHours(0,0,0,0),s>=k&&o.reservationStatus===2})),b=I(()=>v.value.filter(o=>{const s=new Date(o.checkin);return s.setHours(0,0,0,0),s<k&&o.reservationStatus===2})),r=o=>{const s=new Date(o),e=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),x=String(s.getDate()).padStart(2,"0");return`${e}.${i}.${x}`},h=o=>o||"",_=o=>{const s=new Date(o);s.setHours(0,0,0,0);const e=new Date(s);e.setDate(e.getDate()+7);const i=new Date;return i.setHours(0,0,0,0),i<=e},w=o=>new Date>=new Date(o),f=async()=>{try{if(p.value=!0,u.value="",!P()){d.push("/login");return}const o=await B();v.value=o||[]}catch(o){console.error("ì˜ˆì•½ ì¡°íšŒ ì‹¤íŒ¨:",o),u.value="ì˜ˆì•½ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."}finally{p.value=!1}},S=o=>{d.push({name:"reservation-cancel",params:{id:o.reservationId},state:{reservationData:{id:o.reservationId,accommodationName:o.accommodationName,location:o.accommodationAddress,checkin:r(o.checkin),checkout:r(o.checkout),guests:o.guestCount,price:o.finalPaymentAmount,image:h(o.accommodationImageUrl)||`https://picsum.photos/seed/${o.accommodationsId}/200/200`}}})},A=async o=>{if(confirm("ë‚´ì—­ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{await F(o),v.value=v.value.filter(s=>s.reservationId!==o)}catch(s){console.error("ì‚­ì œ ì‹¤íŒ¨:",s),u.value="ì´ìš© ì™„ë£Œëœ ì˜ˆì•½ë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}},C=o=>{d.push({name:"booking-success",query:{reservationId:o.reservationId}})},D=o=>{d.push(`/room/${o.accommodationsId}`)},H=o=>{d.push({name:"write-review",state:{reservationData:{reservationId:o.reservationId,accommodationId:o.accommodationsId,accommodationName:o.accommodationName,dates:`${r(o.checkin)} ~ ${r(o.checkout)}`}}})};return M(()=>{f()}),(o,s)=>(c(),a("div",q,[t("div",z,[t("button",{class:"back-btn",onClick:s[0]||(s[0]=e=>U(d).back())},"â†"),s[3]||(s[3]=t("h1",{class:"page-title"},"ì˜ˆì•½ ë‚´ì—­",-1))]),p.value?(c(),a("div",T,[...s[4]||(s[4]=[t("p",null,"ì˜ˆì•½ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...",-1)])])):u.value?(c(),a("div",E,[t("p",null,n(u.value),1),t("button",{onClick:f,class:"retry-btn"},"ë‹¤ì‹œ ì‹œë„")])):(c(),a(g,{key:2},[t("section",W,[s[14]||(s[14]=t("h2",{class:"section-title"},"ì˜ˆì •ëœ ì˜ˆì•½",-1)),y.value.length===0?(c(),a("div",Y," ì˜ˆì •ëœ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤. ")):(c(),a("div",j,[(c(!0),a(g,null,$(y.value,e=>(c(),a("div",{key:e.reservationId,class:"res-card clickable",role:"link",tabindex:"0",onClick:i=>C(e),onKeydown:R(i=>C(e),["enter"])},[t("div",J,[t("img",{src:h(e.accommodationImageUrl)||`https://picsum.photos/seed/${e.accommodationsId}/200/200`,class:"card-img",alt:"thumbnail"},null,8,O),t("div",Q,[t("h3",X,n(e.accommodationName||"ìˆ™ì†Œëª… ì—†ìŒ"),1),t("p",Z,n(e.accommodationAddress||"ì£¼ì†Œ ì—†ìŒ"),1),t("div",ss,[s[5]||(s[5]=t("span",null,"ì²´í¬ì¸",-1)),s[6]||(s[6]=l()),t("span",ts,n(r(e.checkin)),1)]),t("div",os,[s[7]||(s[7]=t("span",null,"ì²´í¬ì•„ì›ƒ",-1)),s[8]||(s[8]=l()),t("span",es,n(r(e.checkout)),1)]),t("div",ns,[s[9]||(s[9]=t("span",null,"ì¸ì›",-1)),s[10]||(s[10]=l()),t("span",as,n(e.guestCount)+"ëª…",1),s[11]||(s[11]=t("span",{class:"spacer"},"ìˆ™ë°•",-1)),s[12]||(s[12]=l()),t("span",cs,n(e.stayNights)+"ë°•",1)]),t("div",is,[s[13]||(s[13]=l(" ê²°ì œê¸ˆì•¡ ",-1)),t("span",ls,n(e.finalPaymentAmount?.toLocaleString()||0)+"ì›",1)])])]),t("div",{class:"card-actions",onClick:s[1]||(s[1]=N(()=>{},["stop"]))},[t("button",{class:"action-btn outline",onClick:i=>S(e)},"ì˜ˆì•½ ì·¨ì†Œ",8,rs)])],40,G))),128))]))]),t("section",ds,[s[22]||(s[22]=t("h2",{class:"section-title"},"ì´ìš© ì™„ë£Œ",-1)),b.value.length===0?(c(),a("div",us," ì´ìš© ì™„ë£Œëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤. ")):(c(),a("div",vs,[(c(!0),a(g,null,$(b.value,e=>(c(),a("div",{key:e.reservationId,class:"res-card clickable",role:"link",tabindex:"0",onClick:i=>D(e),onKeydown:R(i=>D(e),["enter"])},[t("div",ks,[t("img",{src:h(e.accommodationImageUrl)||`https://picsum.photos/seed/${e.accommodationsId}/200/200`,class:"card-img",alt:"thumbnail"},null,8,hs),t("div",_s,[t("h3",ms,n(e.accommodationName||"ìˆ™ì†Œëª… ì—†ìŒ"),1),t("p",gs,n(e.accommodationAddress||"ì£¼ì†Œ ì—†ìŒ"),1),t("div",ys,[s[15]||(s[15]=t("span",null,"ì´ìš©ì¼",-1)),s[16]||(s[16]=l()),t("span",bs,n(r(e.checkin))+" ~ "+n(r(e.checkout)),1)]),t("div",ws,[s[17]||(s[17]=t("span",null,"ì¸ì›",-1)),s[18]||(s[18]=l()),t("span",fs,n(e.guestCount)+"ëª…",1),s[19]||(s[19]=t("span",{class:"spacer"},"ìˆ™ë°•",-1)),s[20]||(s[20]=l()),t("span",Cs,n(e.stayNights)+"ë°•",1)]),t("div",Ds,[s[21]||(s[21]=l(" ê²°ì œê¸ˆì•¡ ",-1)),t("span",Is,n(e.finalPaymentAmount?.toLocaleString()||0)+"ì›",1)])])]),t("div",{class:"card-actions",onClick:s[2]||(s[2]=N(()=>{},["stop"]))},[e.hasReview?(c(),a("button",Rs," ë¦¬ë·° ë“±ë¡ ì™„ë£Œ ")):(c(),a("button",{key:0,class:V(["action-btn review",{disabled:!_(e.checkout)}]),onClick:i=>H(e),disabled:!_(e.checkout)},n(_(e.checkout)?"ë¦¬ë·° ì‘ì„±í•˜ê¸°":"ì‘ì„± ê¸°í•œ ë§Œë£Œ"),11,$s)),t("button",{class:"icon-btn delete",onClick:i=>A(e.reservationId),disabled:!w(e.checkout),title:w(e.checkout)?"ë‚´ì—­ ì‚­ì œ":"ì´ìš© ì™„ë£Œ í›„ ì‚­ì œ ê°€ëŠ¥"},"ğŸ—‘",8,Ns)])],40,ps))),128))]))])],64))]))}},Ks=K(Ss,[["__scopeId","data-v-1e8c3ea8"]]);export{Ks as default};
