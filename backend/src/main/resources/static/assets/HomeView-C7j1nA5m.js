const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ChMRK3m0.js","assets/index-Dc7bfj8K.css"])))=>i.map(i=>d[i]);
import{_ as Q,c as r,o as n,a as J,h as ae,b as oe,r as c,u as ne,d as ie,e as i,f as m,w as re,v as ce,g as F,F as p,i as f,t as w,j as N,k as le,l as de,m as ue,n as V,p as X,q,s as W}from"./index-ChMRK3m0.js";import{G as D}from"./GuesthouseCard-pA2dybis.js";import{f as me,a as ve}from"./theme-B1xaNXbv.js";import{f as he,a as pe}from"./list-pLfRexFX.js";import{f as fe,r as _e,a as ge}from"./wishlist-DjG6QIac.js";const ke="/assets/home-banner-BEw4KG_1.png",we={class:"skeleton-card"},ye={__name:"SkeletonCard",setup(y){return(d,v)=>(n(),r("div",we,[...v[0]||(v[0]=[J('<div class="skeleton-image shimmer" data-v-6777c92f></div><div class="skeleton-content" data-v-6777c92f><div class="skeleton-title shimmer" data-v-6777c92f></div><div class="skeleton-location shimmer" data-v-6777c92f></div><div class="skeleton-rating shimmer" data-v-6777c92f></div><div class="skeleton-price shimmer" data-v-6777c92f></div></div>',2)])]))}},z=Q(ye,[["__scopeId","data-v-6777c92f"]]);async function Ce(y,d=10){return ae(`/recommendations?userId=${y}&limit=${d}`)}async function be(y){return oe("/recommendations/ai",{query:y})}const Ae={class:"container main-content"},Ie={class:"ai-search-section"},Te={class:"ai-search-input-wrapper"},Se=["disabled"],Re=["disabled"],$e={key:0,class:"loading-spinner"},xe={key:1},Ne={key:0,class:"ai-result-info"},Ue={class:"ai-themes"},Ee={key:0,class:"ai-reasoning"},Le={key:1,class:"ai-recommendations"},Me={class:"row-scroll"},Be={key:2,class:"ai-error"},Fe={key:0,class:"theme-section recommendation-section"},Ve={class:"row-scroll"},We={key:1,class:"theme-section skeleton-section"},De={class:"row-scroll"},Ke={key:2,class:"theme-section skeleton-section"},Pe={class:"row-scroll"},Ge={key:3,class:"empty-state"},He={class:"section-header"},Oe=["onClick","onKeydown"],je={key:0,class:"row-scroll"},Xe={key:0,class:"row-card more-card"},qe=["onClick"],ze=["aria-label","onClick"],Qe=12,Je=8,Ye={__name:"HomeView",setup(y){const d=c(""),v=c([]),_=c(null),C=c(!1),b=c(""),K=async()=>{if(d.value.trim()){C.value=!0,b.value="",v.value=[],_.value=null;try{const e=await be(d.value);e.ok&&e.data?(_.value={themes:e.data.matchedThemes||[],reasoning:e.data.reasoning||"",confidence:e.data.confidence||0},v.value=(e.data.accommodations||[]).map(s=>({id:s.accommodationsId,title:s.accommodationsName,description:"",rating:s.rating,reviewCount:s.reviewCount,location:[s.city,s.district].filter(Boolean).join(" "),price:0,imageUrl:s.thumbnailUrl||"https://placehold.co/400x300"}))):b.value="ì¶”ì²œ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."}catch(e){console.error("AI Recommendation failed:",e),b.value="AI ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}finally{C.value=!1}}},A=ue(),P=c([]),U=c([]),l=c(new Set),$=c(!1),G=c(!1),I=c(""),E=ne(),H=Qe-1,O=e=>{const s=e.accommodationsId??e.accommodationId??e.id,t=e.accommodationsName??e.accommodationName??e.title??"",o=e.shortDescription??e.description??"",g=e.rating??null,k=e.reviewCount??e.review_count??null,x=[e.city,e.district,e.township].filter(Boolean).join(" "),S=Number(e.minPrice??e.price??0),B=e.imageUrl||"https://placehold.co/400x300",a=e.score??null,u=e.matchedThemes??[],h=e.matchedTags??[];return{id:s,title:t,description:o,rating:g,reviewCount:k,location:x,price:S,imageUrl:B,score:a,matchedThemes:u,matchedTags:h}},Y=e=>e.slice(0,H),Z=e=>e.length>H,L=e=>e?`${e} ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ë³´ëŸ¬ê°€ê¸°`:"ë” ë§ì€ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ ë³´ëŸ¬ê°€ê¸°",T=e=>{A.push({path:"/list",query:{themeIds:String(e)}})},j=e=>Array.isArray(e)?e:e?.recommendedAccommodations||e?.generalAccommodations?[...e.recommendedAccommodations||[],...e.generalAccommodations||[]]:e?.items??e?.content??e?.data??[],ee=async()=>{if(N())try{const e=await fe();e.status===200&&Array.isArray(e.data)&&(l.value=new Set(e.data))}catch(e){console.error("Failed to load wishlist",e)}},M=async e=>{if(!N()){confirm(`ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)&&A.push("/login");return}if(l.value.has(e)){l.value.delete(e);try{await _e(e)}catch(t){l.value.add(e),console.error(t)}}else{l.value.add(e);try{await ge(e)}catch(t){l.value.delete(e),console.error(t)}}},te=async()=>{$.value=!0,I.value="";try{const e=await me();if(!e.ok||!Array.isArray(e.data)){I.value="í…Œë§ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";return}const s=e.data;let t=[];if(N())try{const a=await ve();a.ok&&Array.isArray(a.data)&&(t=a.data)}catch(a){console.warn("Failed to fetch user themes, continuing with all themes:",a)}const o=new Set(t.map(a=>a.id)),g=s.filter(a=>!o.has(a.id)).sort((a,u)=>{const h=Number(a.accommodationCount??0),R=Number(u.accommodationCount??0);return h!==R?R-h:(a.id??0)-(u.id??0)}),k=[...t,...g].slice(0,Je),x=k.map(a=>a.id).filter(Boolean);let S={};if(x.length){const a=await he(x);a.ok&&a.data&&(S=a.data)}const B=await Promise.all(k.map(async a=>{const u=S?.[a.id]??S?.[String(a.id)];let h=u?j(u):[];if(!u){const R=await pe([a.id]);h=R.ok?j(R.data):[]}return{id:a.id,name:a.themeName,items:h.map(O)}}));P.value=B.filter(a=>a.items.length)}catch(e){console.error("Failed to load sections",e),I.value="í…Œë§ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."}finally{$.value=!1}},se=async()=>{if(N()){G.value=!0;try{let e=le();if(!e){const{getCurrentUser:t}=await de(async()=>{const{getCurrentUser:g}=await import("./index-ChMRK3m0.js").then(k=>k.am);return{getCurrentUser:g}},__vite__mapDeps([0,1])),o=await t();o.ok&&o.data?.userId&&(e=o.data.userId)}if(!e)return;const s=await Ce(e,10);s.ok&&s.data?.recommendations&&(U.value=s.data.recommendations.map(O))}catch(e){console.error("Failed to load recommendations",e)}finally{G.value=!1}}};return ie(()=>{E.setKeyword(""),E.resetDates(),E.setGuestCount(1),te(),ee(),se()}),(e,s)=>(n(),r("main",Ae,[s[6]||(s[6]=J('<div class="bannner" data-v-06d0aea0><img src="'+ke+'" alt="Home banner" class="banner-image" data-v-06d0aea0><div class="banner-text" data-v-06d0aea0><h2 class="banner-caption" data-v-06d0aea0>ì¢‹ì€ ì‚¬ëŒ, ì¢‹ì€ ì¥ì†Œ, ì¢‹ì€ ì‹œê°„</h2><h1 class="banner-title" data-v-06d0aea0>ì§€ê¸ˆ, ì´ê³³</h1></div></div>',1)),i("section",Ie,[i("div",Te,[re(i("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>d.value=t),type:"text",class:"ai-search-input",placeholder:"ì˜ˆ: ì¡°ìš©í•œ ê³³ì—ì„œ í’ê²½ ë³´ë©´ì„œ íë§í•˜ê³  ì‹¶ì–´",onKeydown:F(K,["enter"]),disabled:C.value},null,40,Se),[[ce,d.value]]),i("button",{class:"ai-search-button",onClick:K,disabled:C.value||!d.value.trim()},[C.value?(n(),r("span",$e)):(n(),r("span",xe,"âœ¨ ì¶”ì²œë°›ê¸°"))],8,Re)]),_.value?(n(),r("div",Ne,[i("div",Ue,[s[1]||(s[1]=i("span",{class:"ai-theme-label"},"ë¶„ì„ëœ í…Œë§ˆ:",-1)),(n(!0),r(p,null,f(_.value.themes,t=>(n(),r("span",{key:t,class:"ai-theme-tag"},w(t),1))),128))]),_.value.reasoning?(n(),r("p",Ee,"ğŸ’¡ "+w(_.value.reasoning),1)):m("",!0)])):m("",!0),v.value.length>0?(n(),r("div",Le,[i("div",Me,[(n(!0),r(p,null,f(v.value,t=>(n(),V(D,{key:t.id,id:t.id,title:t.title,description:t.description,rating:t.rating,"review-count":t.reviewCount,location:t.location,price:t.price,"image-url":t.imageUrl,"is-favorite":l.value.has(t.id),onToggleFavorite:M,onClick:o=>W(A).push(`/room/${t.id}`),class:"row-card"},null,8,["id","title","description","rating","review-count","location","price","image-url","is-favorite","onClick"]))),128))])])):m("",!0),b.value?(n(),r("div",Be,w(b.value),1)):m("",!0)]),U.value.length>0?(n(),r("section",Fe,[s[2]||(s[2]=i("div",{class:"section-header"},[i("h2",{class:"section-title recommendation-title"},[i("span",null,"âœ¨ ë‹¹ì‹ ì„ ìœ„í•œ ë§ì¶¤ ì¶”ì²œ")])],-1)),i("div",Ve,[(n(!0),r(p,null,f(U.value,t=>(n(),V(D,{key:t.id,id:t.id,title:t.title,description:t.description,rating:t.rating,"review-count":t.reviewCount,location:t.location,price:t.price,"image-url":t.imageUrl,"is-favorite":l.value.has(t.id),onToggleFavorite:M,onClick:o=>W(A).push(`/room/${t.id}`),class:"row-card"},null,8,["id","title","description","rating","review-count","location","price","image-url","is-favorite","onClick"]))),128))])])):m("",!0),$.value?(n(),r("section",We,[s[3]||(s[3]=i("div",{class:"section-header"},[i("div",{class:"skeleton-section-title shimmer"})],-1)),i("div",De,[(n(),r(p,null,f(4,t=>X(z,{key:t})),64))])])):m("",!0),$.value?(n(),r("section",Ke,[s[4]||(s[4]=i("div",{class:"section-header"},[i("div",{class:"skeleton-section-title shimmer"})],-1)),i("div",Pe,[(n(),r(p,null,f(4,t=>X(z,{key:t})),64))])])):I.value?(n(),r("div",Ge,w(I.value),1)):(n(!0),r(p,{key:4},f(P.value,t=>(n(),r("section",{key:t.id,class:"theme-section"},[i("div",He,[i("h2",{class:"section-title theme-title",role:"button",tabindex:"0",onClick:o=>T(t.id),onKeydown:[F(q(o=>T(t.id),["prevent"]),["enter"]),F(q(o=>T(t.id),["prevent"]),["space"])]},[i("span",null,w(L(t.name)),1),s[5]||(s[5]=i("span",{class:"theme-title-arrow"},"â†’",-1))],40,Oe)]),t.items.length?(n(),r("div",je,[(n(!0),r(p,null,f(Y(t.items),o=>(n(),V(D,{key:o.id,id:o.id,title:o.title,description:o.description,rating:o.rating,"review-count":o.reviewCount,location:o.location,price:o.price,"image-url":o.imageUrl,"is-favorite":l.value.has(o.id),onToggleFavorite:M,onClick:g=>W(A).push(`/room/${o.id}`),class:"row-card"},null,8,["id","title","description","rating","review-count","location","price","image-url","is-favorite","onClick"]))),128)),Z(t.items)?(n(),r("div",Xe,[i("button",{type:"button",class:"more-text",onClick:o=>T(t.id)},w(L(t.name)),9,qe),i("button",{type:"button",class:"more-arrow","aria-label":L(t.name),onClick:o=>T(t.id)},"â†’",8,ze)])):m("",!0)])):m("",!0)]))),128))]))}},ot=Q(Ye,[["__scopeId","data-v-06d0aea0"]]);export{ot as default};
