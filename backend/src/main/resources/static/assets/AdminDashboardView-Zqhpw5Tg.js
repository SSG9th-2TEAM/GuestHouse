import{_ as xt,r,q as m,b as $t,y as B,c as l,e as t,d as p,l as w,C as k,I as It,t as u,M as x,F as $,f as I,p as Dt,H as Y,k as At,o as n,m as P}from"./index-dxBmIVsU.js";import{A as Z}from"./AdminStatCard-CiiWiBb0.js";import{A as T}from"./AdminBadge-CaJ-wnS9.js";import{A as Rt}from"./AdminTableCard-BrGNU9hB.js";import{A as tt}from"./AdminBarChart-BmXfB6yY.js";import{e as St,a as Nt}from"./reportExport-DvZZ7m0X.js";import{f as Pt,a as et}from"./adminApi-aMfxTe8b.js";import{b as Tt,f as at,a as Lt,t as st}from"./chartSeries-o4DA8yhq.js";const Vt={class:"admin-page"},Et={class:"admin-filter-bar"},Kt={class:"admin-filter-group"},Ft={class:"admin-period-label"},Bt={class:"admin-filter-group admin-filter-group--actions"},Ot={class:"admin-dropdown"},Mt={class:"admin-dropdown__menu"},Gt={class:"admin-dropdown admin-layout-control"},Ut={class:"admin-dropdown__menu admin-layout-control__menu"},qt={class:"admin-check"},Wt={class:"admin-check"},Xt={class:"admin-check"},Jt={class:"admin-check"},Ht={class:"admin-check"},jt={key:0,class:"admin-card admin-alerts-section"},zt={class:"admin-card__head"},Qt={class:"admin-alert-grid"},Yt={key:0,class:"admin-status"},Zt={key:1,class:"admin-status"},te={class:"admin-alert-card__head"},ee={class:"admin-alert-card__title"},ae={class:"admin-alert-card__value"},se=["onClick"],ne={key:1,class:"admin-card admin-trend-section"},le={class:"admin-card__head"},oe={class:"admin-card__caption"},ie={class:"admin-trend-grid"},de={class:"admin-trend-panel"},re={class:"admin-chart-area"},ue={key:0,class:"admin-status"},me={key:1,class:"admin-status"},ce={key:2,class:"admin-status"},ve={class:"admin-trend-panel"},pe={class:"admin-chart-area"},be={key:0,class:"admin-status"},ge={key:1,class:"admin-status"},ye={key:2,class:"admin-status"},_e={key:2,class:"admin-card admin-kpi-section"},ke={class:"admin-card__head"},he={class:"admin-grid admin-grid--kpi"},fe={key:1,class:"admin-status"},Ce={key:2,class:"admin-status"},we={key:3,class:"admin-grid admin-grid--2 admin-grid--issues"},xe={class:"admin-card"},$e={class:"admin-card__head"},Ie={class:"admin-issue-list"},De={key:0,class:"admin-status"},Ae={key:1,class:"admin-status"},Re={key:2,class:"admin-status"},Se={class:"admin-issue-list__title"},Ne={class:"admin-issue-list__count is-right"},Pe=["onClick"],Te={class:"admin-card admin-summary-card"},Le={class:"admin-summary-list"},Ve={class:"admin-summary-item"},Ee={class:"admin-summary-desc"},Ke={class:"admin-summary-item"},Fe={class:"admin-table--nowrap admin-table--tight"},Be={class:"admin-strong"},Oe={class:"admin-strong"},Me=["onClick"],Ge={key:0,class:"admin-status"},nt="adminDashboardLayout",lt="adminDashboardKpiExpanded",Ue={__name:"AdminDashboardView",setup(qe){const ot=At(),D=r([]),b=r(null),A=r([]),O=r([]),L=r([]),V=r([]),E=r({from:"",to:""}),R=r(!1),S=r(""),N=r(""),M=r([]),h=r("30"),g=r(!1),c=r(""),K={alerts:!0,trends:!0,kpi:!0,issues:!0,pendingTable:!0},it=()=>{try{const s=localStorage.getItem(nt);if(!s)return{...K};const e=JSON.parse(s);return{...K,...e||{}}}catch{return{...K}}},dt=()=>{try{return localStorage.getItem(lt)==="true"}catch{return!1}},d=r(it()),f=r(dt()),rt=(s,e)=>{const a=s.map(o=>({id:`report-${o.reportId}`,title:`리뷰 신고 #${o.reportId}`,meta:o.title??"신고 사유 확인 필요",time:o.createdAt?.slice?.(0,10)??"-",tone:"warning",target:`/admin/reports?highlight=${o.reportId}`})),i=e.map(o=>({id:`acc-${o.accommodationsId}`,title:`숙소 심사 대기 #${o.accommodationsId}`,meta:o.name??"승인 대기 숙소",time:o.createdAt?.slice?.(0,10)??"-",tone:"accent",target:`/admin/accommodations?highlight=${o.accommodationsId}`}));return[...a,...i].slice(0,6)},ut=s=>{const e=Number(s)||30,a=new Date,i=new Date;return i.setDate(a.getDate()-(e-1)),{from:st(i),to:st(a)}},mt={7:"최근 7일",30:"최근 30일",90:"최근 3개월"},G=m(()=>mt[Number(h.value)]||"최근 30일"),U=s=>Lt(s),ct=s=>`${(Number(s??0)*100).toFixed(1)}%`,y=s=>Number(s??0).toLocaleString(),vt=s=>{const e=Number(s??0);if(!Number.isFinite(e)||e<1)return"0";const a=Math.round(e*10)/10;return Number.isInteger(a)?String(Math.round(a)):a.toFixed(1)},_=async()=>{g.value=!0,c.value="",R.value=!0,S.value="",N.value="";const s=ut(h.value);E.value=s;const[e,a,i]=await Promise.all([Pt(s),et({metric:"platform_fee",...s}),et({metric:"reservations",...s})]);if(e.ok&&e.data){const o=e.data;b.value=o;const Ct=o.platformFeeRate??0;if(D.value=[{label:"승인 대기 숙소",value:`${o.pendingAccommodations??0}건`,badge:"심사 대기",sub:"",tone:"warning",target:"/admin/accommodations?status=PENDING"},{label:"미처리 신고",value:`${o.openReports??0}건`,badge:"처리 필요",sub:"",tone:"warning",target:"/admin/reports?status=WAIT"},{label:"예약 생성",value:`${o.reservationCount??0}건`,badge:"선택 기간",sub:"",tone:"success",target:"/admin/bookings?sort=latest"},{label:"결제 성공",value:U(o.paymentSuccessAmount),badge:"선택 기간",sub:"",tone:"accent",target:"/admin/payments?status=success"},{label:"플랫폼 수익(수수료)",value:U(o.platformFeeAmount),badge:"선택 기간",sub:`수수료율 ${ct(Ct)}`,tone:"primary",target:"/admin/payments?status=success"},{label:"결제 실패",value:`${o.paymentFailureCount??0}건`,badge:"실패/취소",sub:"",tone:"neutral",target:"/admin/payments?status=failed"},{label:"환불 요청",value:`${o.refundRequestCount??0}건`,badge:"요청",sub:"",tone:"neutral",target:"/admin/payments?type=refund"},{label:"환불 완료",value:`${o.refundCompletedCount??0}건`,badge:"완료",sub:"",tone:"neutral",target:"/admin/payments?type=refund"}],A.value=o.pendingAccommodationsList??[],O.value=o.openReportsList??[],M.value=rt(O.value,A.value),a.ok&&a.data){const wt=a.data.points??[];L.value=wt}else S.value="수익 추이를 불러오지 못했습니다.",L.value=[];i.ok&&i.data?V.value=i.data.points??[]:(N.value="예약 추이를 불러오지 못했습니다.",V.value=[])}else c.value="대시보드 데이터를 불러오지 못했습니다.";R.value=!1,g.value=!1},pt=s=>s==="PENDING"?"warning":s==="APPROVED"?"success":s==="REJECTED"?"danger":"neutral",bt=s=>s?s.slice(0,10):"-",gt=m(()=>{if(!b.value)return[];const s=b.value;return[{id:"pending",title:"승인 대기",badge:"심사 대기",variant:"warning",value:`${y(s.pendingAccommodations)}건`,target:"/admin/accommodations?status=PENDING"},{id:"reports",title:"미처리 신고",badge:"처리 필요",variant:"danger",value:`${y(s.openReports)}건`,target:"/admin/reports?status=WAIT"},{id:"payments",title:"결제 실패/취소",badge:"확인 필요",variant:"neutral",value:`${y(s.paymentFailureCount)}건`,target:"/admin/payments?status=failed"},{id:"refunds",title:"환불 요청",badge:"요청",variant:"accent",value:`${y(s.refundRequestCount)}건`,target:"/admin/payments?type=refund"}]}),q=["예약 생성","결제 성공","플랫폼 수익(수수료)","환불 완료"],yt=m(()=>q.map(s=>D.value.find(e=>e.label===s)).filter(Boolean)),W=m(()=>D.value.filter(s=>!q.includes(s.label))),_t=s=>s.id==="overdue"?{label:"긴급",tone:"danger",rank:4}:s.id==="reports"?{label:"높음",tone:"danger",rank:3}:["pending","refunds","payments","pending-over-7"].includes(s.id)?{label:"보통",tone:"warning",rank:2}:{label:"낮음",tone:"neutral",rank:1},X=m(()=>{if(!b.value)return[];const s=b.value;return[{id:"pending",title:"승인 대기 숙소",count:s.pendingAccommodations??0,status:"심사 대기",statusTone:"warning",target:"/admin/accommodations?status=PENDING"},{id:"reports",title:"미처리 신고",count:s.openReports??0,status:"미처리",statusTone:"danger",target:"/admin/reports?status=WAIT"},{id:"payments",title:"결제 실패/취소",count:s.paymentFailureCount??0,status:"실패",statusTone:"neutral",target:"/admin/payments?status=failed"},{id:"refunds",title:"환불 요청",count:s.refundRequestCount??0,status:"요청",statusTone:"accent",target:"/admin/payments?type=refund"},{id:"overdue",title:"48시간+ 미처리 신고",count:s.overdueOpenReports48h??0,status:"지연",statusTone:"danger",target:"/admin/reports?status=WAIT"},{id:"pending-over-7",title:"7일+ 승인 대기",count:s.weeklyPendingOver7Days??0,status:"지연",statusTone:"warning",target:"/admin/accommodations?status=PENDING"}].filter(a=>a.count>0).map(a=>({...a,priority:_t(a)})).sort((a,i)=>i.priority.rank!==a.priority.rank?i.priority.rank-a.priority.rank:i.count-a.count).slice(0,5)}),kt=m(()=>{if(!b.value)return"";const s=b.value;return`환불 요청 ${y(s.weeklyRefundRequestCount)}건 · 결제 실패율 ${vt(s.weeklyPaymentFailureRate)}% · 48시간+ 미처리 신고 ${y(s.overdueOpenReports48h)}건`}),J=m(()=>A.value.slice(0,5)),C=m(()=>Tt(E.value.from,E.value.to)),H=m(()=>C.value.length?at(C.value,L.value,s=>String(s.date??"").slice(0,10),s=>s.value):[]),j=m(()=>{const s=C.value.length;return s<=8?s:8}),ht=m(()=>H.value.some(s=>Number(s??0)!==0)),F=C,z=m(()=>F.value.length?at(F.value,V.value,s=>String(s.date??"").slice(0,10),s=>s.value):[]),ft=m(()=>z.value.some(s=>Number(s??0)!==0)),v=s=>{s&&ot.push(s)},Q=s=>{const e=new Date().toISOString().slice(0,10),a=[{name:"요약 지표",columns:[{key:"label",label:"지표"},{key:"value",label:"값"},{key:"sub",label:"설명"}],rows:D.value},{name:"승인 대기 숙소",columns:[{key:"id",label:"ID"},{key:"name",label:"숙소명"},{key:"host",label:"호스트"},{key:"location",label:"위치"},{key:"type",label:"유형"},{key:"rooms",label:"객실"},{key:"nightlyPrice",label:"가격(1박)"},{key:"contact",label:"연락처"},{key:"submittedAt",label:"신청일"},{key:"status",label:"상태"}],rows:A.value},{name:"운영 알림",columns:[{key:"title",label:"알림"},{key:"meta",label:"메타"},{key:"time",label:"시간"}],rows:M.value}];if(s==="xlsx"){St({filename:`admin-dashboard-report-${e}.xlsx`,sheets:a});return}Nt({filename:`admin-dashboard-report-${e}.csv`,sheets:a})};return $t(_),B(h,_),B(d,s=>{localStorage.setItem(nt,JSON.stringify(s))},{deep:!0}),B(f,s=>{localStorage.setItem(lt,s?"true":"false")}),(s,e)=>(n(),l("section",Vt,[e[36]||(e[36]=t("header",{class:"admin-page__header"},[t("div",null,[t("h1",{class:"admin-title"},"관리자 대시보드"),t("p",{class:"admin-subtitle"},"주요 지표와 거래 현황을 한 눈에 확인하세요.")])],-1)),t("div",Et,[t("div",Kt,[e[15]||(e[15]=t("span",{class:"admin-chip"},"운영 기간",-1)),k(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),class:"admin-select"},[...e[14]||(e[14]=[t("option",{value:"7"},"최근 7일",-1),t("option",{value:"30"},"최근 30일",-1),t("option",{value:"90"},"최근 3개월",-1)])],512),[[It,h.value]]),t("span",Ft,"선택 기간: "+u(G.value),1)]),t("div",Bt,[e[23]||(e[23]=t("span",{class:"admin-chip"},"빠른 작업",-1)),t("details",Ot,[e[16]||(e[16]=t("summary",{class:"admin-btn admin-btn--ghost"},"다운로드",-1)),t("div",Mt,[t("button",{class:"admin-btn admin-btn--ghost admin-dropdown__item",type:"button",onClick:e[1]||(e[1]=a=>Q("csv"))}," CSV "),t("button",{class:"admin-btn admin-btn--primary admin-dropdown__item",type:"button",onClick:e[2]||(e[2]=a=>Q("xlsx"))}," XLSX ")])]),t("details",Gt,[e[22]||(e[22]=t("summary",{class:"admin-btn admin-btn--ghost"},"대시보드 구성 ⚙️",-1)),t("div",Ut,[t("label",qt,[k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>d.value.alerts=a),type:"checkbox"},null,512),[[x,d.value.alerts]]),e[17]||(e[17]=t("span",null,"알림 카드",-1))]),t("label",Wt,[k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.trends=a),type:"checkbox"},null,512),[[x,d.value.trends]]),e[18]||(e[18]=t("span",null,"트렌드 차트",-1))]),t("label",Xt,[k(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.kpi=a),type:"checkbox"},null,512),[[x,d.value.kpi]]),e[19]||(e[19]=t("span",null,"KPI",-1))]),t("label",Jt,[k(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>d.value.issues=a),type:"checkbox"},null,512),[[x,d.value.issues]]),e[20]||(e[20]=t("span",null,"운영 이슈 리스트",-1))]),t("label",Ht,[k(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>d.value.pendingTable=a),type:"checkbox"},null,512),[[x,d.value.pendingTable]]),e[21]||(e[21]=t("span",null,"승인 대기 테이블",-1))])])])])]),d.value.alerts?(n(),l("section",jt,[t("div",zt,[e[24]||(e[24]=t("div",null,[t("p",{class:"admin-card__eyebrow"},"운영 알림"),t("h3",{class:"admin-card__title"},"즉시 확인해야 할 리스크")],-1)),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:e[8]||(e[8]=a=>v("/admin/dashboard/issues"))},"이슈 센터")]),t("div",Qt,[g.value?(n(),l("div",Yt,"불러오는 중...")):c.value?(n(),l("div",Zt,[t("span",null,u(c.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:_},"다시 시도")])):(n(!0),l($,{key:2},I(gt.value,a=>(n(),l("article",{key:a.id,class:"admin-alert-card"},[t("div",te,[t("p",ee,u(a.title),1),P(T,{text:a.badge,variant:a.variant},null,8,["text","variant"])]),t("div",ae,u(a.value),1),t("button",{class:"admin-btn admin-btn--ghost admin-alert-card__link",type:"button",onClick:i=>v(a.target)}," 바로가기 ",8,se)]))),128))])])):p("",!0),d.value.trends?(n(),l("section",ne,[t("div",le,[t("div",null,[e[25]||(e[25]=t("p",{class:"admin-card__eyebrow"},"트렌드",-1)),e[26]||(e[26]=t("h3",{class:"admin-card__title"},"플랫폼 수익과 예약 추이",-1)),t("p",oe,"기간: "+u(G.value),1)])]),t("div",ie,[t("div",de,[e[27]||(e[27]=t("div",{class:"admin-trend-panel__head"},[t("h4",null,"플랫폼 수익(수수료) 추이"),t("span",null,"일별 수익 흐름")],-1)),t("div",re,[g.value||R.value?(n(),l("div",ue,"불러오는 중...")):c.value||S.value?(n(),l("div",me,[t("span",null,u(c.value||S.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:_},"다시 시도")])):ht.value?(n(),w(tt,{key:3,labels:C.value,values:H.value,height:220,"max-x-ticks":j.value},null,8,["labels","values","max-x-ticks"])):(n(),l("div",ce,"표시할 데이터가 없습니다."))])]),t("div",ve,[e[28]||(e[28]=t("div",{class:"admin-trend-panel__head"},[t("h4",null,"예약 생성 추이"),t("span",null,"예약 수 변화를 확인하세요")],-1)),t("div",pe,[g.value||R.value?(n(),l("div",be,"불러오는 중...")):c.value||N.value?(n(),l("div",ge,[t("span",null,u(c.value||N.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:_},"다시 시도")])):ft.value?(n(),w(tt,{key:3,labels:Dt(F),values:z.value,height:220,format:"count","unit-label":"건","tooltip-label":"예약 생성","max-x-ticks":j.value},null,8,["labels","values","max-x-ticks"])):(n(),l("div",ye,"표시할 데이터가 없습니다."))])])])])):p("",!0),d.value.kpi?(n(),l("section",_e,[t("div",ke,[e[29]||(e[29]=t("div",null,[t("p",{class:"admin-card__eyebrow"},"KPI 요약"),t("h3",{class:"admin-card__title"},"핵심 지표만 먼저 확인하세요")],-1)),W.value.length?(n(),l("button",{key:0,class:"admin-btn admin-btn--ghost admin-kpi-toggle",type:"button",onClick:e[9]||(e[9]=a=>f.value=!f.value)},u(f.value?"KPI 접기 ▴":"KPI 더보기 ▾"),1)):p("",!0)]),t("div",he,[(n(!0),l($,null,I(yt.value,a=>(n(),w(Z,{key:a.label,label:a.label,value:a.value,sub:a.sub,badge:a.badge,tone:a.tone,clickable:!!a.target,onClick:i=>v(a.target)},null,8,["label","value","sub","badge","tone","clickable","onClick"]))),128)),f.value?(n(!0),l($,{key:0},I(W.value,a=>(n(),w(Z,{key:a.label,label:a.label,value:a.value,sub:a.sub,badge:a.badge,tone:a.tone,clickable:!!a.target,onClick:i=>v(a.target)},null,8,["label","value","sub","badge","tone","clickable","onClick"]))),128)):p("",!0),g.value?(n(),l("div",fe,"불러오는 중...")):c.value?(n(),l("div",Ce,[t("span",null,u(c.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:_},"다시 시도")])):p("",!0)])])):p("",!0),d.value.issues?(n(),l("div",we,[t("div",xe,[t("div",$e,[e[30]||(e[30]=t("div",null,[t("p",{class:"admin-card__eyebrow"},"운영 이슈 센터"),t("h3",{class:"admin-card__title"},"바로 조치할 항목 Top 5")],-1)),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:e[10]||(e[10]=a=>v("/admin/dashboard/issues"))},"전체 보기")]),t("div",Ie,[e[31]||(e[31]=t("div",{class:"admin-issue-list__head"},[t("span",null,"항목"),t("span",null,"우선순위"),t("span",null,"상태"),t("span",{class:"is-right"},"건수"),t("span",{class:"is-right"},"바로가기")],-1)),g.value?(n(),l("div",De,"불러오는 중...")):c.value?(n(),l("div",Ae,[t("span",null,u(c.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:_},"다시 시도")])):X.value.length?(n(!0),l($,{key:3},I(X.value,a=>(n(),l("div",{key:a.id,class:"admin-issue-list__row"},[t("span",Se,u(a.title),1),P(T,{text:a.priority.label,variant:a.priority.tone},null,8,["text","variant"]),P(T,{text:a.status,variant:a.statusTone},null,8,["text","variant"]),t("span",Ne,u(y(a.count))+"건",1),t("button",{class:"admin-btn admin-btn--ghost admin-issue-list__link",type:"button",onClick:i=>v(a.target)}," 보기 ",8,Pe)]))),128)):(n(),l("div",Re,"현재 바로 조치할 항목이 없습니다."))])]),t("div",Te,[e[34]||(e[34]=t("div",{class:"admin-card__head"},[t("div",null,[t("p",{class:"admin-card__eyebrow"},"운영 요약"),t("h3",{class:"admin-card__title"},"이번 주 주요 리포트"),t("p",{class:"admin-card__caption"},"기간: 이번 주(월~오늘)")])],-1)),t("div",Le,[t("div",Ve,[t("div",null,[e[32]||(e[32]=t("p",{class:"admin-summary-title"},"주간 리포트",-1)),t("p",Ee,u(kt.value||"요약 데이터를 불러오는 중입니다."),1)]),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:e[11]||(e[11]=a=>v("/admin/dashboard/weekly"))},"리포트 보기")]),t("div",Ke,[e[33]||(e[33]=t("div",null,[t("p",{class:"admin-summary-title"},"운영 이슈 센터"),t("p",{class:"admin-summary-desc"},"상위 이슈를 빠르게 처리할 수 있습니다.")],-1)),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:e[12]||(e[12]=a=>v("/admin/dashboard/issues"))},"바로가기")])])])])):p("",!0),d.value.pendingTable?(n(),w(Rt,{key:4,title:"승인 대기 숙소 (최근 5개)",class:"admin-table-card--wide"},{actions:Y(()=>[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:e[13]||(e[13]=a=>v("/admin/accommodations?status=PENDING"))}," 전체 보기 ")]),default:Y(()=>[t("table",Fe,[e[35]||(e[35]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"숙소명"),t("th",null,"신청일"),t("th",null,"상태"),t("th",null,"관리")])],-1)),t("tbody",null,[(n(!0),l($,null,I(J.value,a=>(n(),l("tr",{key:a.accommodationsId},[t("td",Be,"#"+u(a.accommodationsId),1),t("td",Oe,u(a.name),1),t("td",null,u(bt(a.createdAt)),1),t("td",null,[P(T,{text:a.approvalStatus,variant:pt(a.approvalStatus)},null,8,["text","variant"])]),t("td",null,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:i=>v(`/admin/accommodations?highlight=${a.accommodationsId}`)}," 상세 보기 ",8,Me)])]))),128))])]),J.value.length?p("",!0):(n(),l("div",Ge,"승인 대기 숙소가 없습니다."))]),_:1})):p("",!0)]))}},Ze=xt(Ue,[["__scopeId","data-v-9e5086fa"]]);export{Ze as default};
