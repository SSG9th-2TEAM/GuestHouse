import{_ as Et,r as o,d as xt,y as Nt,x as R,B as ot,c as d,e as t,p as B,f as y,F as O,i as Q,w as P,v as ut,J as X,t as l,C as dt,I as Rt,s as G,m as Pt,o as u,n as Ft}from"./index-ChMRK3m0.js";import{A as Tt}from"./AdminStatCard-BMFaXmkb.js";import{A as $t}from"./AdminBadge-ECazdGCh.js";import{A as Ut}from"./AdminTableCard-K0Ji3Qjx.js";import{A as Vt}from"./AdminBarChart-Ba7fPytA.js";import{e as Mt,a as Yt}from"./reportExport-DvZZ7m0X.js";import{t as zt,v as qt,w as Bt,x as it,y as Ot}from"./adminApi-Bj5BGWJN.js";import{e as Qt,a as Xt,t as rt}from"./adminData-ZmZ3C3cR.js";import{b as Gt}from"./adminReservationPolicy-98qYny6c.js";const Kt={0:"요청",1:"완료",2:"실패",3:"환불"},jt={0:"neutral",1:"success",2:"danger",3:"warning"},mt=D=>{const b=Number(D);return Number.isFinite(b)?Kt[b]??`알 수 없음(${D})`:"알 수 없음"},Jt=D=>{const b=Number(D);return jt[b]??"neutral"},Ht={class:"admin-page"},Wt={class:"admin-grid"},Zt={class:"admin-filter-bar"},te={class:"admin-filter-group"},ee={class:"admin-filter-group"},ae={class:"admin-filter-group"},ne={class:"admin-dropdown"},le={class:"admin-dropdown__menu"},se={class:"admin-card admin-transaction-card"},oe={class:"admin-card__head"},ue={class:"admin-card__title"},de={class:"admin-toggle-group"},ie=["value"],re={class:"admin-toggle"},me={key:0,class:"admin-chart-status"},ve={key:1,class:"admin-chart-status"},ce={key:2,class:"admin-chart-status"},pe={key:3,class:"admin-chart-area"},ye={class:"admin-table--nowrap admin-table--tight admin-table--stretch"},be={class:"admin-strong admin-align-center"},ge=["title"],fe={class:"admin-align-center"},_e={class:"admin-align-right"},ke={class:"admin-align-center"},Se={class:"admin-align-center"},Ae={class:"admin-align-center"},he=["onClick"],Le={key:0,class:"admin-status"},we={key:1,class:"admin-status"},Ce={key:2,class:"admin-status"},Ie={class:"admin-pagination"},De=["disabled"],Ee=["disabled"],xe={key:0,class:"admin-modal"},Ne={class:"admin-modal__panel",role:"dialog","aria-modal":"true"},Re={class:"admin-modal__header"},Pe={class:"admin-modal__title"},Fe={key:0,class:"admin-status"},Te={key:1,class:"admin-status"},$e={key:2,class:"admin-modal__body"},Ue={class:"admin-modal__section"},Ve={class:"admin-detail-grid"},Me={class:"admin-modal__section"},Ye={class:"admin-detail-grid"},ze={class:"admin-modal__section"},qe={class:"admin-detail-grid"},Be={key:0,class:"admin-modal__section"},Oe={class:"admin-detail-grid"},Qe={key:3,class:"admin-modal__actions"},Xe={key:1,class:"admin-modal"},Ge={class:"admin-modal__panel admin-modal__panel--small",role:"dialog","aria-modal":"true"},Ke={class:"admin-modal__header"},je=["disabled"],Je={class:"admin-detail-grid admin-detail-grid--compact"},He={class:"admin-form"},We=["disabled"],Ze={key:0,class:"admin-status error"},ta={class:"admin-modal__actions"},ea=["disabled"],aa=["disabled"],na={__name:"AdminPaymentsView",setup(D){const b=o([]),K=o([]),v=o(""),i=o("ALL"),r=o("ALL"),A=o(new Date().getFullYear()),g=o("yearly"),f=o([]),V=o(!1),E=o(""),m=o(0),j=o(20),M=o(0),vt=o(0),Y=o(!1),F=o(""),J=o(!1),H=o(""),h=o(null),T=o(!1),_=o(!1),k=o(""),s=o(null),z=o(!1),c=o(!1),L=o(""),w=o(null),x=o(""),C=Nt(),ct=Pt(),pt=a=>{if(!a)return"ALL";const e=String(a).trim().toUpperCase();return["ALL","SUCCESS","FAILED","REFUNDED"].includes(e)?e:"ALL"},yt=a=>{if(!a)return"ALL";const e=String(a).trim().toUpperCase();return["ALL","RESERVATION","REFUND"].includes(e)?e:"ALL"},S=async()=>{Y.value=!0,F.value="";const a=await zt({status:i.value,type:r.value,keyword:v.value||void 0,page:m.value,size:j.value,sort:"latest"});if(a.ok&&a.data){const e=a.data;K.value=Qt(e);const n=Xt(e);m.value=n.page,j.value=n.size,M.value=n.totalPages,vt.value=n.totalElements,W()}else F.value="결제 목록을 불러오지 못했습니다.";Y.value=!1},bt=()=>{const a=new Date;if(g.value==="monthly"){const p=A.value||a.getFullYear();return{from:`${p}-01-01`,to:`${p}-12-31`}}const e=a.getFullYear();return{from:`${e-4}-01-01`,to:`${e}-12-31`}},$=async()=>{J.value=!0,H.value="";const a=bt(),e=await Bt({status:i.value==="ALL"?void 0:i.value,type:r.value==="ALL"?void 0:r.value,keyword:v.value||void 0,...a});e.ok&&e.data?(h.value=e.data,W()):(H.value="요약 지표를 불러오지 못했습니다.",h.value=null),J.value=!1},W=()=>{h.value&&(b.value=[{label:"총 거래액",value:`${Number(h.value.grossAmount??0).toLocaleString()}원`,sub:"기간 기준",tone:"primary"},{label:"순매출",value:`${Number(h.value.netAmount??0).toLocaleString()}원`,sub:"환불 반영",tone:"success"},{label:"환불 완료",value:`${Number(h.value.refundCompletedCount??0).toLocaleString()}건`,sub:"기간 기준",tone:"accent"}])},I=async()=>{V.value=!0,E.value="";const a={mode:g.value,year:A.value,status:i.value==="ALL"?void 0:i.value,type:r.value==="ALL"?void 0:r.value,keyword:v.value||void 0};try{const e=await qt(a);e.ok&&Array.isArray(e.data)?f.value=e.data:(E.value="차트를 불러오지 못했습니다.",f.value=[])}catch{E.value="차트를 불러오지 못했습니다.",f.value=[]}V.value=!1},gt=a=>{const e={...C.query,...a},n=rt(e),p=rt(C.query);Object.keys({...n,...p}).every(st=>String(n[st]??"")===String(p[st]??""))||ct.replace({query:n})};xt(()=>{i.value=pt(C.query.status),r.value=yt(C.query.type),v.value=C.query.keyword??"",m.value=Number(C.query.page??0),S(),I(),$()});const ft=a=>a==="SUCCESS"?"1":a==="FAILED"?"2":a==="REFUNDED"?"3":a,Z=a=>{g.value=a,f.value=[],I(),$()},_t=R(()=>g.value==="monthly"?`${A.value}년 월별 거래액`:"연도별 거래액"),kt=R(()=>f.value.some(a=>Number(a?.totalAmount??0)>0)),St=R(()=>f.value.map(a=>a.label)),At=R(()=>f.value.map(a=>a.totalAmount)),q=R(()=>{const a=v.value.trim().toLowerCase();return K.value.filter(e=>{const n=!a||String(e.paymentId??"").includes(a)||(e.orderId??"").toLowerCase().includes(a)||(e.pgPaymentKey??"").toLowerCase().includes(a),p=i.value==="ALL"||String(e.paymentStatus)===ft(i.value),lt=r.value==="ALL"||(r.value==="REFUND"?e.paymentStatus===3:e.paymentStatus!==3);return n&&p&&lt})}),ht=a=>{const e=Number(a);return Number.isFinite(e)?e===0?"요청":e===1?"완료":e===2?"실패":`알 수 없음(${a})`:"-"},tt=a=>a?String(a).replace("T"," ").slice(0,19):"-",N=a=>a==null?"-":`₩${Number(a).toLocaleString()}`,Lt=a=>{a?.paymentId&&(w.value=a,L.value="",x.value="",z.value=!0)},U=()=>{z.value=!1,c.value=!1,L.value="",w.value=null,x.value=""},wt=async()=>{if(!w.value?.paymentId)return;c.value=!0,L.value="";const a=x.value.trim(),e=a?{reason:a}:{},n=await Ot(w.value.paymentId,e);if(n.ok){U(),S(),I(),T.value&&at();return}L.value=n?.data?.message||"환불 처리에 실패했습니다.",c.value=!1},Ct=a=>Gt(a??{}),It=async a=>{if(!a?.paymentId)return;T.value=!0,_.value=!0,k.value="";const e=await it(a.paymentId);e.ok&&e.data?s.value=e.data:k.value="결제 상세 정보를 불러오지 못했습니다.",_.value=!1},et=()=>{T.value=!1,_.value=!1,k.value="",s.value=null},at=async()=>{if(!s.value?.paymentId)return;_.value=!0,k.value="";const a=await it(s.value.paymentId);a.ok&&a.data?s.value=a.data:k.value="결제 상세 정보를 불러오지 못했습니다.",_.value=!1},Dt=()=>{if(!s.value)return;const a={paymentId:s.value.paymentId,approvedAmount:s.value.approvedAmount,paymentStatus:s.value.paymentStatus};Lt(a)};ot([v,i],()=>{m.value=0,gt({status:i.value==="ALL"?void 0:i.value,type:r.value==="ALL"?void 0:r.value,keyword:v.value||void 0,page:m.value}),S(),I(),$()}),ot([r,A],()=>{S(),I(),$()});const nt=a=>{const e=new Date().toISOString().slice(0,10),n=[{name:"결제 내역",columns:[{key:"id",label:"거래ID"},{key:"host",label:"호스트"},{key:"guest",label:"게스트"},{key:"accommodation",label:"숙소"},{key:"amount",label:"거래액"},{key:"fee",label:"수수료"},{key:"type",label:"유형"},{key:"status",label:"상태"},{key:"method",label:"결제수단"},{key:"settlementDate",label:"정산일"},{key:"date",label:"날짜"}],rows:q.value}];if(a==="xlsx"){Mt({filename:`admin-payments-${e}.xlsx`,sheets:n});return}Yt({filename:`admin-payments-${e}.csv`,sheets:n})};return(a,e)=>(u(),d("section",Ht,[e[45]||(e[45]=t("header",{class:"admin-page__header"},[t("div",null,[t("h1",{class:"admin-title"},"결제 관리"),t("p",{class:"admin-subtitle"},"거래 흐름과 수수료를 모니터링합니다.")])],-1)),t("div",Wt,[(u(!0),d(O,null,Q(b.value,n=>(u(),Ft(Tt,{key:n.label,label:n.label,value:n.value,sub:n.sub,tone:n.tone},null,8,["label","value","sub","tone"]))),128))]),t("div",Zt,[t("div",te,[e[11]||(e[11]=t("span",{class:"admin-chip"},"검색",-1)),P(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>v.value=n),class:"admin-input",type:"search",placeholder:"거래ID, 주문번호, 결제키"},null,512),[[ut,v.value]])]),t("div",ee,[e[14]||(e[14]=t("span",{class:"admin-chip"},"필터",-1)),P(t("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>r.value=n),class:"admin-select"},[...e[12]||(e[12]=[t("option",{value:"ALL"},"전체 유형",-1),t("option",{value:"RESERVATION"},"예약",-1),t("option",{value:"REFUND"},"환불",-1)])],512),[[X,r.value]]),P(t("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>i.value=n),class:"admin-select"},[...e[13]||(e[13]=[t("option",{value:"ALL"},"전체 상태",-1),t("option",{value:"SUCCESS"},"완료",-1),t("option",{value:"FAILED"},"실패",-1),t("option",{value:"REFUNDED"},"환불",-1)])],512),[[X,i.value]])]),e[16]||(e[16]=t("div",{class:"admin-filter-group"},[t("span",{class:"admin-chip"},"정산"),t("button",{class:"admin-btn admin-btn--ghost",type:"button"},"정산 예정"),t("button",{class:"admin-btn admin-btn--primary",type:"button"},"정산 실행")],-1)),t("div",ae,[t("details",ne,[e[15]||(e[15]=t("summary",{class:"admin-btn admin-btn--ghost"},"다운로드",-1)),t("div",le,[t("button",{class:"admin-btn admin-btn--ghost admin-dropdown__item",type:"button",onClick:e[3]||(e[3]=n=>nt("csv"))},"CSV"),t("button",{class:"admin-btn admin-btn--primary admin-dropdown__item",type:"button",onClick:e[4]||(e[4]=n=>nt("xlsx"))},"XLSX")])])])]),t("div",se,[t("div",oe,[t("div",null,[e[17]||(e[17]=t("p",{class:"admin-card__eyebrow"},"거래 모니터링",-1)),t("h3",ue,l(_t.value),1)]),t("div",de,[g.value==="monthly"?P((u(),d("select",{key:0,"onUpdate:modelValue":e[5]||(e[5]=n=>A.value=n),class:"admin-select admin-select--compact"},[(u(),d(O,null,Q(5,n=>t("option",{key:n,value:new Date().getFullYear()-(n-1)},l(new Date().getFullYear()-(n-1))+"년 ",9,ie)),64))],512)),[[X,A.value]]):y("",!0),t("div",re,[t("button",{type:"button",class:dt(["admin-toggle__btn",{"is-active":g.value==="yearly"}]),onClick:e[6]||(e[6]=n=>Z("yearly"))}," 연간 ",2),t("button",{type:"button",class:dt(["admin-toggle__btn",{"is-active":g.value==="monthly"}]),onClick:e[7]||(e[7]=n=>Z("monthly"))}," 월간 ",2)])])]),V.value?(u(),d("div",me,"불러오는 중...")):E.value?(u(),d("div",ve,[t("span",null,l(E.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:I},"다시 시도")])):kt.value?(u(),d("div",pe,[B(Vt,{labels:St.value,values:At.value,height:240,color:"#0f766e"},null,8,["labels","values"])])):(u(),d("div",ce,"선택 조건의 거래 데이터가 없습니다."))]),B(Ut,{title:"결제 내역"},{default:Rt(()=>[t("table",ye,[e[18]||(e[18]=t("colgroup",null,[t("col",{style:{width:"100px"}}),t("col",{style:{width:"220px"}}),t("col",{style:{width:"100px"}}),t("col",{style:{width:"140px"}}),t("col",{style:{width:"100px"}}),t("col",{style:{width:"160px"}}),t("col",{style:{width:"100px"}})],-1)),e[19]||(e[19]=t("thead",null,[t("tr",null,[t("th",{class:"admin-align-center"},"거래ID"),t("th",{class:"admin-align-left"},"주문번호"),t("th",{class:"admin-align-center"},"예약ID"),t("th",{class:"admin-align-right"},"거래액"),t("th",{class:"admin-align-center"},"상태"),t("th",{class:"admin-align-center"},"날짜"),t("th",{class:"admin-align-center"},"관리")])],-1)),t("tbody",null,[(u(!0),d(O,null,Q(q.value,n=>(u(),d("tr",{key:n.paymentId},[t("td",be,"#"+l(n.paymentId),1),t("td",{class:"admin-ellipsis admin-align-left",title:n.orderId},l(n.orderId??"-"),9,ge),t("td",fe,"#"+l(n.reservationId??"-"),1),t("td",_e,"₩"+l(n.approvedAmount?.toLocaleString?.()??"0"),1),t("td",ke,[B($t,{text:G(mt)(n.paymentStatus),variant:G(Jt)(n.paymentStatus)},null,8,["text","variant"])]),t("td",Se,l(n.createdAt?.replace("T"," ").slice(0,19)??"-"),1),t("td",Ae,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:p=>It(n)},"상세",8,he)])]))),128))])]),Y.value?(u(),d("div",Le,"불러오는 중...")):F.value?(u(),d("div",we,[t("span",null,l(F.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:S},"다시 시도")])):q.value.length?y("",!0):(u(),d("div",Ce,"데이터가 없습니다.")),t("div",Ie,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:m.value<=0,onClick:e[8]||(e[8]=n=>{m.value=m.value-1,S()})}," 이전 ",8,De),t("span",null,l(m.value+1)+" / "+l(Math.max(M.value,1)),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:m.value+1>=M.value,onClick:e[9]||(e[9]=n=>{m.value=m.value+1,S()})}," 다음 ",8,Ee)])]),_:1}),T.value?(u(),d("div",xe,[t("div",{class:"admin-modal__backdrop",onClick:et}),t("div",Ne,[t("div",Re,[t("div",null,[e[20]||(e[20]=t("p",{class:"admin-modal__eyebrow"},"결제 상세",-1)),t("h2",Pe,"#"+l(s.value?.paymentId??"-"),1)]),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:et},"닫기")]),_.value?(u(),d("div",Fe,"불러오는 중...")):k.value?(u(),d("div",Te,[t("span",null,l(k.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:at},"다시 시도")])):(u(),d("div",$e,[t("div",Ue,[e[27]||(e[27]=t("h3",null,"결제 정보",-1)),t("div",Ve,[t("div",null,[e[21]||(e[21]=t("span",null,"거래금액",-1)),t("strong",null,l(N(s.value?.approvedAmount)),1)]),t("div",null,[e[22]||(e[22]=t("span",null,"공급가액",-1)),t("strong",null,l(N(Math.floor((s.value?.approvedAmount||0)/1.1))),1)]),t("div",null,[e[23]||(e[23]=t("span",null,"부가세",-1)),t("strong",null,l(N((s.value?.approvedAmount||0)-Math.floor((s.value?.approvedAmount||0)/1.1))),1)]),t("div",null,[e[24]||(e[24]=t("span",null,"결제수단",-1)),t("strong",null,l(s.value?.paymentMethod||"카드"),1)]),t("div",null,[e[25]||(e[25]=t("span",null,"결제상태",-1)),t("strong",null,l(G(mt)(s.value?.paymentStatus)),1)]),t("div",null,[e[26]||(e[26]=t("span",null,"승인일시",-1)),t("strong",null,l(tt(s.value?.approvedAt)),1)])])]),t("div",Me,[e[31]||(e[31]=t("h3",null,"PG사 정보",-1)),t("div",Ye,[t("div",null,[e[28]||(e[28]=t("span",null,"주문번호(OID)",-1)),t("strong",null,l(s.value?.orderId??"-"),1)]),t("div",null,[e[29]||(e[29]=t("span",null,"거래고유번호(TID)",-1)),t("strong",null,l(s.value?.pgPaymentKey??"-"),1)]),t("div",null,[e[30]||(e[30]=t("span",null,"PG사",-1)),t("strong",null,l(s.value?.pgProviderCode||"TOSS"),1)])])]),t("div",ze,[e[35]||(e[35]=t("h3",null,"주문자/예약 정보",-1)),t("div",qe,[t("div",null,[e[32]||(e[32]=t("span",null,"예약번호",-1)),t("strong",null,"#"+l(s.value?.reservationId??"-"),1)]),t("div",null,[e[33]||(e[33]=t("span",null,"숙소 ID",-1)),t("strong",null,"#"+l(s.value?.accommodationsId??"-"),1)]),t("div",null,[e[34]||(e[34]=t("span",null,"게스트 ID",-1)),t("strong",null,"#"+l(s.value?.userId??"-"),1)])])]),s.value?.refundStatus!==null?(u(),d("div",Be,[e[40]||(e[40]=t("h3",null,"환불 정보",-1)),t("div",Oe,[t("div",null,[e[36]||(e[36]=t("span",null,"환불상태",-1)),t("strong",null,l(ht(s.value?.refundStatus)),1)]),t("div",null,[e[37]||(e[37]=t("span",null,"환불금액",-1)),t("strong",null,l(N(s.value?.refundAmount)),1)]),t("div",null,[e[38]||(e[38]=t("span",null,"환불일시",-1)),t("strong",null,l(tt(s.value?.refundApprovedAt)),1)]),t("div",null,[e[39]||(e[39]=t("span",null,"환불사유",-1)),t("strong",null,l(s.value?.refundReason??"-"),1)])])])):y("",!0)])),_.value?y("",!0):(u(),d("div",Qe,[Ct(s.value)?(u(),d("button",{key:0,class:"admin-btn admin-btn--danger",type:"button",onClick:Dt}," 결제 취소 ")):y("",!0)]))])])):y("",!0),z.value?(u(),d("div",Xe,[t("div",{class:"admin-modal__backdrop",onClick:U}),t("div",Ge,[t("div",Ke,[e[41]||(e[41]=t("div",null,[t("p",{class:"admin-modal__eyebrow"},"결제 취소"),t("h2",{class:"admin-modal__title"},"정말 취소하시겠습니까?")],-1)),t("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:c.value,onClick:U},"닫기",8,je)]),t("div",Je,[t("div",null,[e[42]||(e[42]=t("span",null,"거래ID",-1)),t("strong",null,"#"+l(w.value?.paymentId??"-"),1)]),t("div",null,[e[43]||(e[43]=t("span",null,"취소금액",-1)),t("strong",null,l(N(w.value?.approvedAmount)),1)])]),t("div",He,[e[44]||(e[44]=t("label",{class:"admin-form__label",for:"refund-reason"},"취소 사유",-1)),P(t("textarea",{id:"refund-reason","onUpdate:modelValue":e[10]||(e[10]=n=>x.value=n),class:"admin-input",rows:"3",placeholder:"예) 고객 요청, 중복 결제 등",disabled:c.value},null,8,We),[[ut,x.value]])]),L.value?(u(),d("div",Ze,l(L.value),1)):y("",!0),t("div",ta,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:c.value,onClick:U},"닫기",8,ea),t("button",{class:"admin-btn admin-btn--danger",type:"button",disabled:c.value,onClick:wt},l(c.value?"처리 중...":"결제 취소"),9,aa)])])])):y("",!0)]))}},ca=Et(na,[["__scopeId","data-v-5bf0f27d"]]);export{ca as default};
