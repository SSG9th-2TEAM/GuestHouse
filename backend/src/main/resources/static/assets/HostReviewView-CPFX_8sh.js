import{h as q,a7 as K,_ as ie,r as n,x as y,d as ue,B as de,c as l,n as ce,F as _,e as s,f as i,t as r,w as A,J as j,i as C,s as F,m as ve,q as pe,v as L,o,C as M}from"./index-ChMRK3m0.js";import{f as z}from"./hostAccommodation-KiikHbb8.js";import{e as me,d as ye,a as J}from"./formatters-BE-0ymhR.js";import{H as _e}from"./HostGateNotice-GzzyrG15.js";async function fe(m={}){return q("/host/reviews",m)}async function he(){return q("/host/reviews/summary")}async function ke(m,d){return K(`/host/reviews/${m}/reply`,{method:"POST",body:JSON.stringify(d)})}async function be(m,d){return K(`/host/reviews/${m}/report`,{method:"POST",body:JSON.stringify(d)})}const ge={class:"review-view"},we={class:"host-view-header"},Ce={class:"host-subtitle"},Re={key:0,class:"muted"},Se={class:"filters host-view-header__actions"},xe=["value"],Ne=["value"],Ae={key:0,class:"empty-box"},He={class:"review-list"},Ie={key:0,class:"review-skeleton"},Ue={key:1,class:"empty-box"},De={key:2,class:"empty-box"},Ve={class:"card-header"},Te={class:"user-profile"},Ee={class:"avatar"},Oe={class:"user-info"},Be={class:"user-name"},$e={class:"accommodation-name"},Ge={class:"meta-info"},Pe={class:"rating"},je={class:"date"},Fe={class:"review-content"},Le={key:0,class:"reply-box"},Me={key:0,class:"reply-date"},ze={key:1,class:"reply-editor"},Je={key:0,class:"muted error"},qe={class:"reply-actions"},Ke=["disabled","onClick"],Qe={class:"card-footer"},We={key:0,class:"visit-date"},Xe={class:"card-actions"},Ye=["onClick"],Ze=["onClick"],et={class:"modal-card"},tt={key:0,class:"muted error"},st={class:"modal-actions"},at=["disabled"],ot={__name:"HostReviewView",setup(m){const d=n([]),H=n(!1),I=n(""),Q=ve(),f=n({hostState:"loading",counts:{total:0,approved:0,pending:0,rejected:0,unknown:0},rejectedReason:"",recheckReason:""}),W=y(()=>f.value.hostState),h=y(()=>f.value.gateState==="APPROVED"),X=y(()=>!h.value&&W.value!=="loading"),c=y(()=>me(f.value)),U=n({avgRating:0,reviewCount:0}),D=n(""),V=n(!1),$=n([]),T=n(!1),E=n(""),k=n("all"),R=n("latest"),Y=[{value:"latest",label:"최신순"},{value:"oldest",label:"오래된순"}],S=n(null),b=n(""),v=n(""),x=n(!1),g=n(null),w=n(""),p=n(""),N=n(!1),Z=y(()=>Number(U.value.avgRating??0).toFixed(1)),ee=y(()=>U.value.reviewCount??0),te=a=>{const t=a.authorName??a.userName??a.reviewerName??a.name??"";return{id:a.reviewId??a.id,userName:t,userInitial:t?t.slice(0,1):"U",accommodationName:a.accommodationName??a.property??"",rating:a.rating??0,date:J(a.createdAt??a.date,!0),visitDate:a.visitDate??"",content:a.content??a.reviewContent??"",isCrawled:!!a.isCrawled,replyContent:a.replyContent??"",replyUpdatedAt:a.replyUpdatedAt??null}},O=async()=>{if(!h.value)return;H.value=!0,I.value="";const a={page:0,size:20,sort:R.value};k.value!=="all"&&(a.accommodationId=k.value);const t=await fe(a);if(t.ok){const e=t.data,u=Array.isArray(e)?e:e?.items??e?.content??e?.data??[];d.value=u.map(te)}else I.value="리뷰를 불러오지 못했습니다.";H.value=!1},se=a=>{S.value=a.id,b.value=a.replyContent||"",v.value=""},G=()=>{S.value=null,b.value="",v.value=""},ae=async a=>{const t=b.value.trim();if(!t){v.value="답글 내용을 입력해주세요.";return}x.value=!0,v.value="";const e=await ke(a.id,{content:t});e.ok?(a.replyContent=e.data?.content??t,a.replyUpdatedAt=e.data?.updatedAt??new Date().toISOString(),G()):v.value=e.data?.message||"답글 저장에 실패했습니다.",x.value=!1},oe=a=>{g.value=a,w.value="",p.value=""},B=()=>{g.value=null,w.value="",p.value=""},le=async()=>{if(!g.value)return;const a=w.value.trim();if(!a){p.value="신고 사유를 입력해주세요.";return}N.value=!0,p.value="";const t=await be(g.value.id,{reason:a});t.ok?(B(),window.alert("신고가 접수되었습니다.")):p.value=t.data?.message||"신고 처리에 실패했습니다.",N.value=!1},ne=async()=>{if(!h.value)return;V.value=!0,D.value="";const a=await he();a.ok?U.value=a.data??{avgRating:0,reviewCount:0}:D.value="요약 정보를 불러오지 못했습니다.",V.value=!1},P=async()=>{T.value=!0,E.value="";const a=await z();if(a.ok){const t=a.data;$.value=Array.isArray(t)?t:t?.items??t?.content??t?.data??[]}else E.value="숙소 목록을 불러오지 못했습니다.";T.value=!1},re=async()=>{const a=await z();if(a.ok){const t=a.data,e=Array.isArray(t)?t:t?.items??t?.content??t?.data??[];f.value=ye(e)}else f.value={hostState:"empty",counts:{total:0,approved:0,pending:0,rejected:0,unknown:0},rejectedReason:"",recheckReason:""}};return ue(async()=>{await re(),h.value&&(await Promise.all([P(),ne()]),O())}),de([k,R],()=>{h.value&&O()}),(a,t)=>(o(),l("div",ge,[X.value?(o(),ce(_e,{key:0,title:c.value.title,description:c.value.description,reason:c.value.reason,"primary-text":c.value.primaryText,"primary-to":c.value.primaryTo,"secondary-text":c.value.secondaryText,"secondary-to":c.value.secondaryTo},null,8,["title","description","reason","primary-text","primary-to","secondary-text","secondary-to"])):(o(),l(_,{key:1},[s("div",we,[s("div",null,[t[5]||(t[5]=s("h2",{class:"host-title"},"리뷰 관리",-1)),s("p",Ce," 평균 평점 "+r(Z.value)+" · 총 "+r(ee.value)+"개의 리뷰 ",1),D.value?(o(),l("p",Re,"요약 정보를 불러오지 못했습니다.")):i("",!0)]),s("div",Se,[A(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),class:"filter-select","aria-label":"숙소 선택"},[t[6]||(t[6]=s("option",{value:"all"},"전체 숙소",-1)),(o(!0),l(_,null,C($.value,e=>(o(),l("option",{key:e.accommodationsId??e.id,value:e.accommodationsId??e.id},r(e.accommodationsName??e.name??e.accommodationName??"숙소"),9,xe))),128))],512),[[j,k.value]]),A(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>R.value=e),class:"filter-select","aria-label":"정렬 선택"},[(o(),l(_,null,C(Y,e=>s("option",{key:e.value,value:e.value},r(e.label),9,Ne)),64))],512),[[j,R.value]])])]),E.value?(o(),l("div",Ae,[t[7]||(t[7]=s("p",null,"숙소 목록을 불러오지 못했어요.",-1)),s("button",{class:"ghost-btn",onClick:P},"다시 시도")])):i("",!0),s("div",He,[H.value||V.value||T.value?(o(),l("div",Ie,[(o(),l(_,null,C(3,e=>s("div",{key:e,class:"skeleton-card"})),64))])):I.value?(o(),l("div",Ue,[t[8]||(t[8]=s("p",null,"데이터를 불러오지 못했어요.",-1)),s("button",{class:"ghost-btn",onClick:O},"다시 시도")])):d.value.length?i("",!0):(o(),l("div",De,[t[9]||(t[9]=s("p",null,"조건에 맞는 리뷰가 없습니다.",-1)),s("button",{class:"ghost-btn",onClick:t[2]||(t[2]=e=>F(Q).push("/host/booking"))},"예약 확인하기")])),(o(!0),l(_,null,C(d.value,e=>(o(),l("div",{key:e.id,class:"review-card"},[s("div",Ve,[s("div",Te,[s("div",Ee,r(e.userInitial),1),s("div",Oe,[s("span",Be,r(e.userName),1),s("span",$e,r(e.accommodationName),1)])]),s("div",Ge,[s("div",Pe,[(o(),l(_,null,C(5,u=>s("span",{key:u,class:M(["star",{filled:u<=e.rating}])},"★",2)),64))]),s("span",je,r(e.date),1)])]),s("div",Fe,[s("p",null,r(e.content),1)]),e.replyContent&&S.value!==e.id?(o(),l("div",Le,[t[10]||(t[10]=s("p",{class:"reply-title"},"호스트 답글",-1)),s("p",null,r(e.replyContent),1),e.replyUpdatedAt?(o(),l("p",Me,r(F(J)(e.replyUpdatedAt,!0)),1)):i("",!0)])):i("",!0),S.value===e.id?(o(),l("div",ze,[A(s("textarea",{"onUpdate:modelValue":t[3]||(t[3]=u=>b.value=u),rows:"4",placeholder:"답글을 입력해주세요."},null,512),[[L,b.value]]),v.value?(o(),l("p",Je,r(v.value),1)):i("",!0),s("div",qe,[s("button",{class:"ghost-btn",type:"button",onClick:G},"취소"),s("button",{class:"primary-btn",type:"button",disabled:x.value,onClick:u=>ae(e)},r(x.value?"저장 중...":"답글 저장"),9,Ke)])])):i("",!0),s("div",Qe,[s("span",{class:M(["review-chip",{crawled:e.isCrawled}])},r(e.isCrawled?"크롤링 리뷰":"직접 작성"),3),e.visitDate?(o(),l("span",We,"방문일 "+r(e.visitDate),1)):i("",!0)]),s("div",Xe,[s("button",{class:"ghost-btn",type:"button",onClick:u=>se(e)},r(e.replyContent?"답글 수정":"답글 달기"),9,Ye),s("button",{class:"ghost-btn danger",type:"button",onClick:u=>oe(e)},"신고",8,Ze)])]))),128))]),g.value?(o(),l("div",{key:1,class:"modal-overlay",onClick:pe(B,["self"])},[s("div",et,[t[11]||(t[11]=s("h3",null,"리뷰 신고",-1)),t[12]||(t[12]=s("p",{class:"muted"},"신고 사유를 입력해주세요.",-1)),A(s("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>w.value=e),rows:"4",placeholder:"예: 욕설/광고/허위 내용"},null,512),[[L,w.value]]),p.value?(o(),l("p",tt,r(p.value),1)):i("",!0),s("div",st,[s("button",{class:"ghost-btn",type:"button",onClick:B},"취소"),s("button",{class:"primary-btn",type:"button",disabled:N.value,onClick:le},r(N.value?"접수 중...":"신고 접수"),9,at)])])])):i("",!0)],64))]))}},ut=ie(ot,[["__scopeId","data-v-8df4cdbd"]]);export{ut as default};
