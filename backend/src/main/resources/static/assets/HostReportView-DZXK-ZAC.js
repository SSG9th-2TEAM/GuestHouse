import{h as he,a6 as vs,_ as ms,r as m,a7 as ps,q as u,b as hs,a5 as kt,k as _s,a2 as Et,G as gs,y as Te,c as l,l as ys,F as c,e as s,d as r,t as o,f as v,A as I,C as V,I as pe,z as b,E as le,a as fs,o as n,D as bs,p as ks}from"./index-CMhx5Eqk.js";import{f as Es}from"./hostAccommodation-43Mo6bXT.js";import{d as Is,b as ws}from"./useHostState-C50sIYyu.js";import{H as Ds}from"./HostGateNotice-BbRU-RLX.js";import{a as Rs}from"./formatters-De2UUEom.js";const _e=(M={})=>{const oe={};return Object.entries(M).forEach(([F,Y])=>{if(Y!=null){if(typeof Y=="string"){const S=Y.trim();if(!S)return;oe[F]=S;return}oe[F]=Y}}),oe};async function It(M={}){return he("/host/reports/reviews/summary",_e(M))}async function Ms(M={}){return he("/host/reports/reviews/trend",_e(M))}async function Ns(M={}){return he("/host/reports/themes/popular",_e(M))}async function As(M={}){return he("/host/reports/forecast/demand",_e(M))}async function $s(M={}){return vs("/host/reports/ai-insight",{method:"POST",body:JSON.stringify(M)})}async function Cs(M={}){return he("/host/reports/ai-insight/eligibility",_e(M))}const Vs={key:0,class:"report-view"},Ss={class:"host-view-header"},Ts={key:0,class:"host-subtitle"},xs={key:1,class:"error-text"},Hs={class:"context-bar"},Ws={class:"context-text"},Fs={class:"context-chips"},Ls={key:0,class:"tag-chip"},Ps={class:"tag-chip"},zs={class:"report-tabs",role:"tablist"},Os=["onClick"],Us={key:0,class:"report-section"},Ys={class:"filter-card"},Gs={class:"filters filters-grid"},Bs=["value"],js={class:"filter-group"},Ks={key:0,class:"report-skeleton"},qs={class:"kpi-grid"},Xs={class:"skeleton-tags"},Zs={key:1,class:"error-box"},Js={key:2},Qs={class:"kpi-grid"},ea={class:"kpi-label"},ta=["title"],sa={class:"kpi-value"},aa={key:0,class:"kpi-delta"},na={key:0,class:"compare-toolbar"},la={key:0,class:"compare-label"},oa={key:0,class:"compare-skeleton"},ia={key:1,class:"compare-items"},ra={key:2,class:"empty-box"},ua={key:3,class:"grid-two"},da={class:"panel"},ca={class:"rating-bars"},va={class:"rating-label"},ma={class:"rating-bar"},pa={class:"rating-count"},ha={class:"rating-percent"},_a={class:"panel"},ga={class:"tag-chip-list"},ya={key:0,class:"muted"},fa=["title"],ba={class:"chip-count"},ka={class:"panel ai-panel"},Ea={class:"ai-head"},Ia={key:0,class:"ai-warning"},wa={key:1,class:"ai-warning ai-warning--muted"},Da={class:"ai-meta"},Ra=["disabled","aria-busy"],Ma={key:0,class:"spinner","aria-hidden":"true"},Na={class:"ai-meta-chips"},Aa={key:0,class:"empty-box ai-state"},$a={key:1,class:"ai-skeleton"},Ca={key:2,class:"error-box ai-state"},Va={key:3,class:"empty-box ai-state"},Sa={key:4,class:"ai-grid review-grid"},Ta={class:"ai-block ai-card ai-card--overview"},xa={class:"ai-card__head"},Ha={key:0,class:"ai-badge"},Wa={class:"ai-list"},Fa={class:"ai-main"},La={key:0,class:"ai-evidence"},Pa={class:"ai-block ai-card ai-card--positives"},za={class:"ai-card__head"},Oa={key:0,class:"ai-badge"},Ua={class:"ai-list"},Ya={class:"ai-main"},Ga={key:0,class:"ai-evidence"},Ba={class:"ai-block ai-card ai-card--negatives"},ja={class:"ai-card__head"},Ka={key:0,class:"ai-badge"},qa={class:"ai-list"},Xa={class:"ai-main"},Za={key:0,class:"ai-evidence"},Ja={class:"ai-card__head"},Qa={key:0,class:"ai-badge"},en={class:"action-list"},tn={class:"action-text"},sn={key:0,class:"ai-evidence"},an={key:0,class:"monitoring-callout"},nn={key:0,class:"ai-block ai-card ai-card--risks"},ln={class:"ai-card__head"},on={key:0,class:"ai-badge"},rn={class:"ai-list"},un={class:"ai-main"},dn={key:0,class:"ai-evidence"},cn={key:5,class:"muted ai-state"},vn={class:"panel"},mn={key:0,class:"muted"},pn={key:1,class:"review-cards"},hn={class:"review-head"},_n={class:"review-meta"},gn={class:"review-date"},yn=["onClick"],fn={key:4,class:"panel"},bn={class:"simple-table table-only"},kn={class:"card-list mobile-only"},En={class:"report-card__row"},In={class:"muted"},wn={key:1,class:"report-section"},Dn={class:"theme-section-wrap"},Rn={class:"theme-layout"},Mn={class:"filter-card theme-filter"},Nn={class:"filters filters-grid"},An=["value"],$n={class:"filter-group"},Cn={class:"theme-content"},Vn={class:"theme-kpi-grid"},Sn={class:"panel ai-panel"},Tn={class:"ai-head"},xn={key:0,class:"ai-warning"},Hn={key:1,class:"ai-warning ai-warning--muted"},Wn={class:"ai-meta"},Fn=["disabled","aria-busy"],Ln={key:0,class:"spinner","aria-hidden":"true"},Pn={class:"ai-meta-chips"},zn={key:0,class:"empty-box ai-state"},On={key:1,class:"ai-skeleton"},Un={key:2,class:"error-box ai-state"},Yn={key:3,class:"ai-grid theme-ai-grid"},Gn={class:"ai-block ai-card ai-card--summary"},Bn={class:"ai-card__head"},jn={key:0,class:"ai-badge"},Kn={class:"ai-list"},qn={class:"ai-main"},Xn={key:0,class:"ai-evidence"},Zn={class:"ai-block ai-card ai-card--positives"},Jn={class:"ai-card__head"},Qn={key:0,class:"ai-badge"},el={class:"ai-list"},tl={class:"ai-main"},sl={key:0,class:"ai-evidence"},al={class:"ai-block ai-card ai-card--negatives"},nl={class:"ai-card__head"},ll={key:0,class:"ai-badge"},ol={class:"ai-list"},il={class:"ai-main"},rl={key:0,class:"ai-evidence"},ul={class:"ai-block ai-card ai-card--actions ai-wide"},dl={class:"ai-card__head"},cl={key:0,class:"ai-badge"},vl={class:"action-list"},ml={class:"action-text"},pl={key:0,class:"ai-evidence"},hl={class:"ai-block ai-card ai-card--monitoring ai-wide"},_l={class:"ai-card__head"},gl={key:0,class:"ai-badge"},yl={class:"ai-list"},fl={class:"ai-main"},bl={key:0,class:"ai-evidence"},kl={key:4,class:"muted ai-state"},El={class:"theme-results-card"},Il={class:"theme-results-head"},wl={class:"theme-view-toggle",role:"tablist","aria-label":"보기 전환"},Dl=["aria-selected"],Rl=["aria-selected"],Ml={class:"theme-results-body"},Nl={key:0,class:"loading-box"},Al={key:1,class:"error-box"},$l={key:2},Cl={key:0,class:"empty-box"},Vl={key:1},Sl={key:0,class:"theme-grid-desktop"},Tl={class:"theme-card__head"},xl={class:"theme-card__metrics"},Hl={class:"theme-metric"},Wl={class:"theme-metric"},Fl={class:"theme-metric"},Ll={key:1,class:"theme-table-wrapper"},Pl={class:"simple-table theme-table"},zl={class:"cell-right"},Ol={class:"cell-right"},Ul={class:"cell-right"},Yl={key:2,class:"theme-grid theme-grid-stack"},Gl={class:"theme-card__head"},Bl={class:"theme-card__metrics"},jl={class:"theme-metric"},Kl={class:"theme-metric"},ql={class:"theme-metric"},Xl={key:3,class:"theme-more"},Zl={key:2,class:"report-section"},Jl={class:"filter-card"},Ql={class:"filters filters-grid"},eo=["value"],to={key:0,class:"loading-box"},so={key:1,class:"error-box"},ao={key:2},no={class:"kpi-grid"},lo={class:"kpi-card"},oo={class:"kpi-card"},io={class:"kpi-card"},ro={class:"kpi-card"},uo={key:0,class:"forecast-meta"},co={class:"panel ai-panel"},vo={class:"ai-head"},mo={key:0,class:"ai-warning"},po={key:1,class:"ai-warning ai-warning--muted"},ho={class:"ai-meta"},_o=["disabled","aria-busy"],go={key:0,class:"spinner","aria-hidden":"true"},yo={class:"ai-meta-chips"},fo={key:0,class:"empty-box ai-state"},bo={key:1,class:"ai-skeleton"},ko={key:2,class:"error-box ai-state"},Eo={key:3,class:"ai-grid demand-ai-grid"},Io={class:"ai-block ai-card ai-card--summary"},wo={class:"ai-card__head"},Do={key:0,class:"ai-badge"},Ro={class:"ai-list"},Mo={class:"ai-main"},No={key:0,class:"ai-evidence"},Ao={class:"ai-block ai-card ai-card--analysis"},$o={class:"ai-card__head"},Co={key:0,class:"ai-badge"},Vo={class:"ai-list"},So={class:"ai-main"},To={key:0,class:"ai-evidence"},xo={class:"ai-block ai-card ai-card--actions"},Ho={class:"ai-card__head"},Wo={key:0,class:"ai-badge"},Fo={class:"ai-list"},Lo={class:"ai-main"},Po={key:0,class:"ai-evidence"},zo={class:"ai-block ai-card ai-card--improve"},Oo={class:"ai-card__head"},Uo={key:0,class:"ai-badge"},Yo={class:"ai-list"},Go={class:"ai-main"},Bo={key:0,class:"ai-evidence"},jo={class:"ai-block ai-card ai-card--monitoring ai-wide"},Ko={class:"ai-card__head"},qo={key:0,class:"ai-badge"},Xo={class:"ai-list"},Zo={class:"ai-main"},Jo={key:0,class:"ai-evidence"},Qo={key:4,class:"muted ai-state"},ei={key:1,class:"empty-box"},ti={key:2},si={key:0,class:"forecast-toolbar"},ai={class:"forecast-view-toggle",role:"tablist","aria-label":"예측 보기 전환"},ni=["aria-selected"],li=["aria-selected"],oi={key:1,class:"forecast-table-wrap"},ii={key:0,class:"forecast-chart"},ri={class:"forecast-chart__canvas",viewBox:"0 0 1000 200",role:"img","aria-label":"수요 예측 차트",preserveAspectRatio:"none"},ui=["d"],di=["points"],ci={class:"forecast-chart__points"},vi=["cx","cy"],mi={class:"forecast-chart__axis"},pi={key:1,class:"empty-box"},hi={class:"simple-table forecast-table"},_i={class:"cell-right"},gi={class:"cell-right"},yi={class:"cell-right"},fi={class:"cell-right"},bi={key:2,class:"card-list forecast-cards"},ki={class:"report-card__row"},Ei={class:"muted forecast-card-meta"},Ii={class:"muted forecast-card-range"},wi={key:1,class:"report-view"},Di={__name:"HostReportView",setup(M){const oe=[{id:"reviews",label:"리뷰 리포트"},{id:"themes",label:"테마 인기"},{id:"forecast",label:"수요 예측"}],F=m("reviews"),Y=_s(),S=m(ps()),st=m(!1),wt=u(()=>S.value?S.value.role==="HOST"||S.value.role==="ROLE_HOST"||S.value.hostApproved===!0:!1),ie=m([]),xe=m(!1),ge=m(""),ye=()=>new Date().toISOString().slice(0,10),He=a=>{const e=new Date;return e.setDate(e.getDate()-a),e.toISOString().slice(0,10)},at=He(30),nt=ye(),g=m({accommodationId:"all",from:at,to:nt}),fe=m("30days"),be=m("30days"),k=m(null),re=m([]),ke=m(!1),Ee=m(""),A=m(null),Ie=m(!1),lt=m(""),ue=m(!1),T=m({REVIEW:{data:null,loading:!1,error:""},THEME:{data:null,loading:!1,error:""},DEMAND:{data:null,loading:!1,error:""}}),we=m({}),p=a=>{const e=Number(a);return Number.isFinite(e)?new Intl.NumberFormat("ko-KR").format(e):"0"},Dt=a=>`${p(a)}원`,Rt=a=>{if(!a)return"-";const e=String(a).replace(/\[[^\]]+]/g,"").replace(/(\.\d{3})\d+/g,"$1").trim(),t=new Date(e);if(Number.isNaN(t.getTime()))return"-";const i=d=>String(d).padStart(2,"0");return`${t.getFullYear()}.${i(t.getMonth()+1)}.${i(t.getDate())} ${i(t.getHours())}:${i(t.getMinutes())}`},Mt=a=>{const e=Number(a);return Number.isFinite(e)?e.toFixed(1):"-"},ot=a=>{if(!a)return null;const e=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return`${e}-${t}-${i}`},it=a=>{if(!a)return null;const e=new Date(`${a}T00:00:00`);return Number.isNaN(e.getTime())?null:e},rt=(a,e)=>{const t=it(a),i=it(e);if(!t||!i||i<t)return null;const d=Math.round((i-t)/(1e3*60*60*24)),y=new Date(t);y.setDate(y.getDate()-1);const w=new Date(y);return w.setDate(w.getDate()-d),{from:ot(w),to:ot(y)}},ut=a=>{const e=Number(a?.reviewCount??0);if(!e)return null;const t=a?.ratingDistribution??{};return(Number(t?.[1]??0)+Number(t?.[2]??0)+Number(t?.[3]??0))/e},q=(a,e,t)=>{const i=Number(a),d=Number(e);if(!Number.isFinite(i)||!Number.isFinite(d))return null;if(t==="count"){const y=i-d,w=y>0?"+":"",N=d>0?`${w}${(y/d*100).toFixed(1)}%`:null,ne=`${w}${p(y)}`;return N?`${ne} (${N})`:ne}if(t==="rating"){const y=i-d;return`${y>0?"+":""}${y.toFixed(1)}`}if(t==="ratio"){const y=(i-d)*100;return`${y>0?"+":""}${y.toFixed(1)}%p`}return null},$=u(()=>T.value.REVIEW.data),G=u(()=>T.value.THEME.data),P=u(()=>T.value.DEMAND.data),Nt=u(()=>$.value?Array.isArray($.value?.sections)&&$.value.sections.length>0:!1),h=m({accommodationId:"all",from:at,to:nt,metric:"reservations"}),De=m(!1),Re=m(""),dt=m(null),_=m({accommodationId:"all",target:"reservations",horizonDays:30,historyDays:180}),Me=m(!1),Ne=m(""),z=m(null),x=m("table"),de=m(!1),We=u(()=>Is(ie.value)),Ae=u(()=>We.value.gateState==="APPROVED"),At=u(()=>!Ae.value&&We.value.hostState!=="loading"),B=u(()=>ws(We.value)),$t=u(()=>{const a=k.value?.ratingDistribution||{},e=(k.value?.reviewCount??0)||0;return[5,4,3,2,1].map(t=>{const i=a[t]??0,d=e>0?Math.round(i/e*100):0;return{rating:t,count:i,percent:d}})}),Ct=u(()=>(k.value?.reviewCount??0)>0),L=m({review:null,theme:null,demand:null}),O=m(""),Fe={status:"OK",canGenerate:!0,disabledReason:"",warningMessage:"",current:0,minRequired:0,recommended:0,unitLabel:""},H=a=>{const e=f(a);return e?.data?.meta?e.data.meta:a==="REVIEW"?L.value.review??Fe:a==="THEME"?L.value.theme??Fe:L.value.demand??Fe},E=a=>H(a).status==="WARN",Le=a=>H(a).status==="BLOCKED",Pe=a=>H(a).canGenerate&&!f(a).loading,ze=u(()=>rt(g.value.from,g.value.to)),Vt=u(()=>ze.value?`직전 기간 ${ze.value.from} ~ ${ze.value.to}`:""),Oe=u(()=>ut(k.value)),$e=u(()=>ut(A.value)),X=u(()=>({reviewCount:A.value?q(k.value?.reviewCount,A.value?.reviewCount,"count"):null,avgRating:A.value?q(k.value?.avgRating,A.value?.avgRating,"rating"):null,lowRatio:Oe.value==null||$e.value==null?null:q(Oe.value,$e.value,"ratio")})),Ue=u(()=>{if(!A.value)return[];const a=[];return X.value.reviewCount&&a.push({label:"리뷰 수",value:X.value.reviewCount}),X.value.avgRating&&a.push({label:"평균 평점",value:X.value.avgRating}),X.value.lowRatio&&a.push({label:"저평점 비율(3점 이하)",value:X.value.lowRatio}),a}),ct=u(()=>Ue.value.length>0||Ie.value),St=u(()=>{const a=k.value?.reviewCount,e=k.value?.avgRating,t=Oe.value,i=Q.value;return[{label:"리뷰 수",value:Number.isFinite(Number(a))?`${p(a)}건`:"-",delta:A.value?q(a,A.value?.reviewCount,"count"):null},{label:"평균 평점",value:Mt(e),delta:A.value?q(e,A.value?.avgRating,"rating"):null},{label:"저평점 비율(3점 이하)",tooltip:"선택 기간 리뷰 중 평점 3점 이하 비율(= 3점 이하 리뷰 수 / 전체 리뷰 수)",value:t==null?"-":`${(t*100).toFixed(1)}%`,delta:$e.value==null?null:q(t,$e.value,"ratio")},{label:"대표 태그",value:i&&i!=="데이터 없음"?i:"-",delta:null}]}),Ye=({periodLabel:a,basisLabel:e,generatedAt:t})=>{const i=[];return a&&i.push(a),e&&i.push(e),t?i.push(`생성 ${Rt(t)}`):i.push("생성 전"),i},Tt=u(()=>{const a=g.value.from&&g.value.to?`기간 ${g.value.from} ~ ${g.value.to}`:"",t=`리뷰 ${p(k.value?.reviewCount??0)}건 기준`;return Ye({periodLabel:a,basisLabel:t,generatedAt:$.value?.generatedAt})}),xt=u(()=>{const a=h.value.from&&h.value.to?`기간 ${h.value.from} ~ ${h.value.to}`:"",e=h.value.metric==="revenue"?`매출 ${p(me.value.revenue)}원 기준`:`예약 ${p(me.value.reservations)}건 기준`;return Ye({periodLabel:a,basisLabel:e,generatedAt:G.value?.generatedAt})}),Ht=u(()=>{const a=`기간 향후 ${p(_.value.horizonDays)}일`,e=z.value?.forecastSummary?.predictedTotal??0,t=_.value.target==="revenue"?`매출 ${p(e)}원 기준`:`예약 ${p(e)}건 기준`;return Ye({periodLabel:a,basisLabel:t,generatedAt:P.value?.generatedAt})}),Wt=u(()=>["저평점(3점 이하) 리뷰 추이 주 1회 점검","청결/소음/응대 관련 키워드 급증 여부 확인","이상 징후 발생 시 대응 프로세스 공유"]),f=a=>T.value[a],Ft=a=>{const e=f(a)?.data;return Array.isArray(e?.sections)&&e.sections.length>0},Ge=a=>f(a)?.loading?"생성 중...":Ft(a)?"AI 요약 재생성":"AI 요약 생성",Lt=a=>Array.isArray(a?.sections)?a.sections:[],Z=(a,e)=>Lt(a).find(i=>i.title===e)?.items??[],vt=(a,e)=>Z(a,e).map((i,d)=>{const y=Ce(i),w=d===0?"즉시":d<=2?"이번주":"상시",N=d===0?"urgent":d<=2?"recommended":"improve";return{text:i,priority:w,tone:N,main:y.main,evidence:y.evidence,showEvidence:y.showEvidence}}),Pt=u(()=>vt($.value,"다음 액션")),zt=u(()=>vt(G.value,"다음 액션")),mt=u(()=>Z($.value,"주의·리스크")),Ot=u(()=>mt.value.length===0?!0:mt.value.every(a=>a.includes("유의미한 리스크 없음")||a.includes("데이터 부족")||a.includes("특이 징후 없음")||a.includes("이슈 징후 낮음"))),Be=u(()=>Ot.value),Ut=a=>{if(!a)return{main:"-",evidence:""};const e=String(a);if(e.includes("||")){const[i,d]=e.split("||");return{main:i.trim(),evidence:d?.trim()??""}}const t="— 근거:";if(e.includes(t)){const[i,d]=e.split(t);return{main:i.trim(),evidence:d?.trim()??""}}return{main:e.trim(),evidence:""}},pt=a=>a?String(a).replace(/부정 키워드 미감지/g,"불만 신호 낮음").replace(/유의미한 부정 신호 없음/g,"불만 신호 낮음").replace(/리스크 없음/g,"특이 징후 없음").replace(/유의미한 리스크 없음/g,"특이 징후 없음").replace(/저평점 리뷰 키워드 주간 모니터링/g,"저평점(3점 이하) 리뷰 추이 주 1회 점검").replace(/데이터 부족/g,"표본이 적어 신뢰도 낮음").trim():"",D=()=>"근거",Yt=(a,e)=>{if(!e)return!1;const t=String(e).trim();if(!t||["데이터 부족","데이터 없음","리스크 없음","특이 징후 없음","이슈 징후 낮음"].some(N=>t.includes(N)))return!1;const d=String(a).trim();if(!d)return!0;if(d===t||d.includes(t))return!1;const y=d.match(/\d+(?:\.\d+)?/g)??[],w=t.match(/\d+(?:\.\d+)?/g)??[];return!(w.length>0&&w.every(N=>y.includes(N)))},Gt=(a,e,t)=>{const i=Z(a,e);return Number.isFinite(t)?i.slice(0,t):i},Ce=a=>{const e=Ut(a);return{key:a,main:pt(e.main),evidence:pt(e.evidence),showEvidence:Yt(e.main,e.evidence)}},C=(a,e,t)=>Gt(a,e,t).map(Ce),Ve={"핵심 요약":2,강점:2,"개선 포인트":2,모니터링:2},je={"핵심 요약":2,"해석 포인트":2,"개선 포인트":2},ce=m(!1),Ke=u(()=>Z(P.value,"모니터링")),Bt=u(()=>ce.value?Ke.value:Ke.value.slice(0,2)),jt=u(()=>{const a=Z(P.value,"운영 액션");return(a.length>0?a:Z(P.value,"운영 액션 제안")).map(Ce)}),W=u(()=>dt.value?.rows??[]),ve=m(!1),qe=u(()=>de.value?8:5),ht=u(()=>ve.value?W.value:W.value.slice(0,qe.value)),me=u(()=>W.value.reduce((a,e)=>(a.reservations+=Number(e.reservationCount??0),a.revenue+=Number(e.revenueSum??0),a),{reservations:0,revenue:0})),Kt=u(()=>{if(W.value.length===0||(me.value.reservations??0)===0)return null;const a=h.value.metric==="revenue"?"revenueSum":"reservationCount";return W.value.reduce((e,t)=>{const i=Number(t[a]??0);return e?i>Number(e[a]??0)?t:e:t},null)}),qt=u(()=>[{label:"기간 예약수",value:`${p(me.value.reservations)}건`},{label:"기간 매출",value:`${p(me.value.revenue)}원`},{label:"Top 테마",value:Kt.value?.themeName??"데이터 없음"}]),U=m("cards"),Xe=a=>Number(a??0)===0,J=u(()=>z.value?.forecastDaily??[]),Ze=u(()=>J.value.length?J.value.reduce((a,e)=>{const t=Number(e.predictedValue??0);if(!a)return e;const i=Number(a.predictedValue??0);return t>i?e:a},null):null),Q=u(()=>{const a=k.value?.topTags??[];return a.length>0?`${a[0].tagName}`:"데이터 없음"}),j=a=>_.value.target==="revenue"?Dt(a):`${p(a)}건`,Xt=u(()=>_.value.target==="revenue"?"예측 매출(원)":"예측 예약(건)"),Zt=u(()=>_.value.target==="revenue"?"예측 범위(원)":"예측 범위(건)"),_t=u(()=>{const a=z.value?.explain,e=z.value?.diagnostics?.mape,t=[];return a&&t.push(a),Number.isFinite(e)&&t.push(`백테스트 MAPE ${p(e)}%`),t.join(" · ")}),Je=a=>{if(!a||!a.low&&!a.high||Number(a.low)===0&&Number(a.high)===0)return"-";const e=p(a.low??0),t=p(a.high??0);return`${e} ~ ${t}`},Jt=a=>{if(!a)return"";const e=String(a),t=e.split("-");return t.length!==3?e:`${t[1]}-${t[2]}`},ee=u(()=>J.value.map(a=>({date:a.date,label:Jt(a.date),predicted:Number(a.predictedValue??0),low:Number(a.low??0),high:Number(a.high??0)}))),te=u(()=>{const a=ee.value;if(!a.length)return null;const e=1e3,t=200,i=30,d=20,y=Math.min(...a.map(R=>R.low??R.predicted)),w=Math.max(...a.map(R=>R.high??R.predicted)),N=Number.isFinite(y)?y:0,ne=Number.isFinite(w)?w:0,os=ne-N||1,is=a.length>1?(e-i*2)/(a.length-1):0,et=R=>i+is*R,tt=R=>{const K=Math.max(N,Math.min(ne,R));return t-d-(K-N)/os*(t-d*2)},rs=a.map((R,K)=>`${et(K)},${tt(R.predicted)}`).join(" "),us=a.map((R,K)=>`${et(K)},${tt(R.high)}`).join(" "),ds=a.map((R,K)=>`${et(K)},${tt(R.low)}`).reverse().join(" "),cs=`M ${us} L ${ds} Z`;return{width:e,height:t,linePoints:rs,areaPath:cs,minY:N,maxY:ne}}),Qt=u(()=>{const a=p(k.value?.reviewCount??0),e=k.value?.avgRating??0,t=Q.value&&Q.value!=="데이터 없음"?` · 대표태그 ${Q.value}`:"";return`기간 ${g.value.from} ~ ${g.value.to} · 리뷰 ${a} · 평점 ${e}${t}`}),es=a=>{if(a==="7days")return{from:He(7),to:ye()};if(a==="30days")return{from:He(30),to:ye()};const e=new Date;return{from:new Date(e.getFullYear(),e.getMonth(),1).toISOString().slice(0,10),to:ye()}},gt=(a,e)=>{const t=es(e);a.value={...a.value,...t}},Se=a=>{fe.value=a,gt(g,a)},Qe=a=>{be.value=a,gt(h,a)},ts=async()=>{xe.value=!0,ge.value="";const a=await Es();if(a.ok){const e=a.data;ie.value=Array.isArray(e)?e:e?.items??e?.content??e?.data??[]}else ge.value="숙소 목록을 불러오지 못했습니다.";xe.value=!1},yt=async()=>{if(!Ae.value)return;ke.value=!0,Ee.value="",A.value=null,lt.value="";const a={from:g.value.from,to:g.value.to};g.value.accommodationId!=="all"&&(a.accommodationId=g.value.accommodationId);const[e,t]=await Promise.all([It(a),Ms({accommodationId:a.accommodationId,months:6})]);if(e.ok){k.value=e.data;const i=rt(a.from,a.to);if(i){Ie.value=!0;const d={from:i.from,to:i.to};a.accommodationId&&(d.accommodationId=a.accommodationId);const y=await It(d);y.ok?A.value=y.data:lt.value="비교 데이터 없음",Ie.value=!1}}else Ee.value="리뷰 리포트를 불러오지 못했습니다.";t.ok?re.value=Array.isArray(t.data)?t.data:[]:re.value=[],ke.value=!1},ss=a=>{we.value[a]=!we.value[a]},as=()=>{const a=new Date,e=Number(_.value.historyDays??180),t=Number(_.value.horizonDays??30),i=new Date(a);i.setDate(i.getDate()-e);const d=new Date(a);return d.setDate(d.getDate()+t),{from:i.toISOString().slice(0,10),to:d.toISOString().slice(0,10)}},ns=a=>{const e={tab:a};return a==="REVIEW"?(e.from=g.value.from,e.to=g.value.to,g.value.accommodationId!=="all"&&(e.accommodationId=g.value.accommodationId)):a==="THEME"?(e.from=h.value.from,e.to=h.value.to,e.metric=h.value.metric,h.value.accommodationId!=="all"&&(e.accommodationId=h.value.accommodationId)):a==="DEMAND"&&(e.historyDays=_.value.historyDays,_.value.accommodationId!=="all"&&(e.accommodationId=_.value.accommodationId)),e},se=async a=>{const e=await Cs(ns(a));if(e.ok){const t=e.data??{};t.review&&(L.value.review=t.review),t.theme&&(L.value.theme=t.theme),t.demand&&(L.value.demand=t.demand),O.value="";return}O.value="자격 정보를 불러오지 못했어요. 생성 시 서버에서 다시 확인합니다."},ls=async()=>{await Promise.all([se("REVIEW"),se("THEME"),se("DEMAND")])},ae=async(a,e=!1)=>{const t=f(a);if(t.loading)return;if(!H(a).canGenerate){t.error="",t.data=null;return}t.loading=!0,t.error="";const i={tab:a,forceRefresh:e};if(a==="REVIEW")i.from=g.value.from,i.to=g.value.to,g.value.accommodationId!=="all"&&(i.accommodationId=g.value.accommodationId);else if(a==="THEME")i.from=h.value.from,i.to=h.value.to,i.metric=h.value.metric,h.value.accommodationId!=="all"&&(i.accommodationId=h.value.accommodationId);else if(a==="DEMAND"){const y=as();i.from=y.from,i.to=y.to,i.target=_.value.target,i.horizonDays=_.value.horizonDays,i.historyDays=_.value.historyDays,_.value.accommodationId!=="all"&&(i.accommodationId=_.value.accommodationId)}const d=await $s(i);d.ok?(t.data=d.data,d.data?.meta&&(a==="REVIEW"&&(L.value.review=d.data.meta),a==="THEME"&&(L.value.theme=d.data.meta),a==="DEMAND"&&(L.value.demand=d.data.meta))):(t.error="AI 인사이트를 불러오지 못했습니다.",t.data=null),t.loading=!1},ft=async()=>{if(!Ae.value)return;De.value=!0,Re.value="";const a={from:h.value.from,to:h.value.to,metric:h.value.metric};h.value.accommodationId!=="all"&&(a.accommodationId=h.value.accommodationId);const e=await Ns(a);e.ok?dt.value=e.data:Re.value="테마 리포트를 불러오지 못했습니다.",De.value=!1},bt=async()=>{if(!Ae.value)return;Me.value=!0,Ne.value="";const a={target:_.value.target,horizonDays:_.value.horizonDays,historyDays:_.value.historyDays};_.value.accommodationId!=="all"&&(a.accommodationId=_.value.accommodationId);const e=await As(a);e.ok?z.value=e.data:Ne.value="수요 예측을 불러오지 못했습니다.",Me.value=!1};return hs(async()=>{if(S.value){if(!wt.value&&gs()){const e=await kt();e.ok&&e.data&&(Et(e.data),S.value=e.data)}}else{const e=await kt();if(!e.ok||!e.data){Y.replace("/login");return}Et(e.data),S.value=e.data}if(typeof window<"u"){const e=window.matchMedia("(min-width: 768px)"),t=()=>{de.value=e.matches,ce.value=e.matches};t(),e.addEventListener?.("change",t),e.addListener?.(t)}const a=typeof window<"u"?window.localStorage.getItem("hostForecastViewMode"):null;(a==="table"||a==="cards")&&(x.value=a),st.value=!0,await ts(),yt(),ft(),bt(),ls()}),Te(x,a=>{typeof window<"u"&&window.localStorage.setItem("hostForecastViewMode",a)}),Te(g,()=>{F.value==="reviews"&&(yt(),T.value.REVIEW.data=null,T.value.REVIEW.error=""),se("REVIEW")},{deep:!0}),Te(h,()=>{ft(),T.value.THEME.data=null,T.value.THEME.error="",ve.value=!1,se("THEME")},{deep:!0}),Te(_,()=>{F.value==="forecast"&&bt(),T.value.DEMAND.data=null,T.value.DEMAND.error="",se("DEMAND")},{deep:!0}),(a,e)=>st.value?(n(),l("section",Vs,[At.value?(n(),ys(Ds,{key:0,title:B.value.title,description:B.value.description,reason:B.value.reason,"primary-text":B.value.primaryText,"primary-to":B.value.primaryTo,"secondary-text":B.value.secondaryText,"secondary-to":B.value.secondaryTo},null,8,["title","description","reason","primary-text","primary-to","secondary-text","secondary-to"])):(n(),l(c,{key:1},[s("header",Ss,[e[31]||(e[31]=s("div",null,[s("h2",{class:"host-title"},"AI 리포트"),s("p",{class:"host-subtitle"},"AI가 리뷰/테마/수요를 요약해 운영 포인트를 제공합니다.")],-1)),xe.value?(n(),l("p",Ts,"숙소 불러오는 중...")):ge.value?(n(),l("p",xs,o(ge.value),1)):r("",!0)]),s("div",Hs,[s("p",Ws,o(Qt.value),1),s("div",Fs,[Q.value!=="데이터 없음"?(n(),l("span",Ls,"대표 태그: "+o(Q.value),1)):r("",!0),s("span",Ps,"기간: "+o(g.value.from)+" ~ "+o(g.value.to),1)])]),s("div",zs,[(n(),l(c,null,v(oe,t=>s("button",{key:t.id,type:"button",class:b(["report-tab",{active:F.value===t.id}]),onClick:i=>F.value=t.id},o(t.label),11,Os)),64))]),F.value==="reviews"?(n(),l("section",Us,[s("div",Ys,[e[36]||(e[36]=s("div",{class:"filter-title"},"필터",-1)),s("div",Gs,[s("label",null,[e[33]||(e[33]=I(" 숙소 ",-1)),V(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>g.value.accommodationId=t)},[e[32]||(e[32]=s("option",{value:"all"},"전체 숙소",-1)),(n(!0),l(c,null,v(ie.value,t=>(n(),l("option",{key:t.accommodationsId,value:t.accommodationsId},o(t.accommodationsName),9,Bs))),128))],512),[[pe,g.value.accommodationId]])]),s("div",js,[s("button",{type:"button",class:b({active:fe.value==="7days"}),onClick:e[1]||(e[1]=t=>Se("7days"))},"7일",2),s("button",{type:"button",class:b({active:fe.value==="30days"}),onClick:e[2]||(e[2]=t=>Se("30days"))},"30일",2),s("button",{type:"button",class:b({active:fe.value==="thisMonth"}),onClick:e[3]||(e[3]=t=>Se("thisMonth"))},"이번달",2)]),s("label",null,[e[34]||(e[34]=I(" 시작일 ",-1)),V(s("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=t=>g.value.from=t)},null,512),[[le,g.value.from]])]),s("label",null,[e[35]||(e[35]=I(" 종료일 ",-1)),V(s("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=t=>g.value.to=t)},null,512),[[le,g.value.to]])])])]),ke.value?(n(),l("div",Ks,[s("div",qs,[(n(),l(c,null,v(4,t=>s("div",{key:`kpi-skel-${t}`,class:"kpi-card skeleton-card"},[...e[37]||(e[37]=[s("div",{class:"skeleton-line short"},null,-1),s("div",{class:"skeleton-line long"},null,-1),s("div",{class:"skeleton-line mini"},null,-1)])])),64))]),s("div",Xs,[(n(),l(c,null,v(6,t=>s("span",{key:`tag-skel-${t}`,class:"skeleton-chip"})),64))]),e[38]||(e[38]=s("div",{class:"skeleton-panels"},[s("div",{class:"skeleton-panel"}),s("div",{class:"skeleton-panel"})],-1))])):Ee.value?(n(),l("div",Zs,o(Ee.value),1)):(n(),l("div",Js,[s("div",Qs,[(n(!0),l(c,null,v(St.value,t=>(n(),l("div",{key:t.label,class:"kpi-card"},[s("p",ea,[I(o(t.label)+" ",1),t.tooltip?(n(),l("span",{key:0,class:"kpi-help",title:t.tooltip},"?",8,ta)):r("",!0)]),s("strong",sa,o(t.value),1),t.delta?(n(),l("span",aa,"Δ "+o(t.delta),1)):r("",!0)]))),128))]),ct.value?(n(),l("div",na,[ue.value?(n(),l("p",la,o(Vt.value),1)):r("",!0),s("button",{type:"button",class:"ghost-btn",onClick:e[6]||(e[6]=t=>ue.value=!ue.value)},o(ue.value?"비교 숨기기":"전 기간 비교"),1)])):r("",!0),ct.value?(n(),l("div",{key:1,class:b(["kpi-compare",{hidden:!ue.value}])},[Ie.value?(n(),l("div",oa,[...e[39]||(e[39]=[s("span",{class:"skeleton-line mini"},null,-1),s("span",{class:"skeleton-line mini"},null,-1),s("span",{class:"skeleton-line mini"},null,-1)])])):Ue.value.length?(n(),l("div",ia,[(n(!0),l(c,null,v(Ue.value,t=>(n(),l("span",{key:t.label},[I(o(t.label)+" ",1),s("strong",null,o(t.value),1)]))),128))])):r("",!0)],2)):r("",!0),Ct.value?(n(),l("div",ua,[s("div",da,[e[40]||(e[40]=s("h3",null,"별점 분포",-1)),s("ul",ca,[(n(!0),l(c,null,v($t.value,t=>(n(),l("li",{key:t.rating},[s("span",va,o(t.rating)+"점",1),s("div",ma,[s("span",{class:"rating-fill",style:bs({width:t.percent+"%"})},null,4)]),s("span",pa,o(p(t.count))+"건",1),s("span",ha,o(t.percent)+"%",1)]))),128))])]),s("div",_a,[e[41]||(e[41]=s("h3",null,"TOP 태그",-1)),e[42]||(e[42]=s("p",{class:"muted"},"자주 언급된 키워드를 모았어요.",-1)),s("div",ga,[(k.value?.topTags??[]).length===0?(n(),l("span",ya,"태그 데이터가 없습니다.")):r("",!0),(n(!0),l(c,null,v(k.value?.topTags,t=>(n(),l("span",{key:t.tagName,class:"tag-chip tag-chip-static",title:`${t.tagName} ${p(t.count)}건`},[I(o(t.tagName)+" ",1),s("span",ba,o(p(t.count)),1)],8,fa))),128))])])])):(n(),l("div",ra,[s("p",null,"데이터가 부족합니다 (리뷰 "+o(p(k.value?.reviewCount??0))+"건).",1),s("button",{type:"button",class:"ghost-btn",onClick:e[7]||(e[7]=t=>Se("30days"))},"최근 30일 보기")])),s("div",ka,[s("div",Ea,[s("div",null,[e[43]||(e[43]=s("p",{class:"ai-kicker"},"AI 리뷰 인사이트",-1)),e[44]||(e[44]=s("h3",null,"AI 요약",-1)),e[45]||(e[45]=s("p",{class:"muted"},"선택 기간 리뷰 데이터를 기반으로 핵심 포인트를 정리합니다.",-1)),E("REVIEW")?(n(),l("p",Ia,o(H("REVIEW").warningMessage),1)):r("",!0),O.value?(n(),l("p",wa,o(O.value),1)):r("",!0)]),s("div",Da,[s("button",{type:"button",class:"primary-btn ai-btn",disabled:!Pe("REVIEW")||ke.value,"aria-busy":f("REVIEW").loading?"true":"false",onClick:e[8]||(e[8]=t=>ae("REVIEW",!0))},[f("REVIEW").loading?(n(),l("span",Ma)):r("",!0),I(" "+o(Ge("REVIEW")),1)],8,Ra),s("div",Na,[(n(!0),l(c,null,v(Tt.value,t=>(n(),l("span",{key:t,class:"ai-chip"},o(t),1))),128))])])]),Le("REVIEW")?(n(),l("div",Aa,o(H("REVIEW").disabledReason),1)):f("REVIEW").loading?(n(),l("div",$a,[...e[46]||(e[46]=[s("div",{class:"skeleton-card"},null,-1),s("div",{class:"skeleton-card"},null,-1),s("div",{class:"skeleton-card"},null,-1)])])):f("REVIEW").error?(n(),l("div",Ca,[s("p",null,o(f("REVIEW").error),1),s("button",{type:"button",class:"link-btn",onClick:e[9]||(e[9]=t=>ae("REVIEW",!0))},"다시 시도")])):$.value&&!Nt.value?(n(),l("div",Va,"AI 요약 대상 리뷰가 없습니다.")):$.value?(n(),l("div",Sa,[s("div",Ta,[s("div",xa,[e[47]||(e[47]=s("h4",null,"총평",-1)),E("REVIEW")?(n(),l("span",Ha,"참고용")):r("",!0)]),s("ul",Wa,[(n(!0),l(c,null,v(C($.value,"총평",2),t=>(n(),l("li",{key:t.key},[s("span",Fa,o(t.main),1),t.showEvidence?(n(),l("span",La,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",Pa,[s("div",za,[e[48]||(e[48]=s("h4",null,"좋았던 점",-1)),E("REVIEW")?(n(),l("span",Oa,"참고용")):r("",!0)]),s("ul",Ua,[(n(!0),l(c,null,v(C($.value,"좋았던 점",2),t=>(n(),l("li",{key:t.key},[s("span",Ya,o(t.main),1),t.showEvidence?(n(),l("span",Ga,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",Ba,[s("div",ja,[e[49]||(e[49]=s("h4",null,"개선 포인트",-1)),E("REVIEW")?(n(),l("span",Ka,"참고용")):r("",!0)]),s("ul",qa,[(n(!0),l(c,null,v(C($.value,"개선 포인트",2),t=>(n(),l("li",{key:t.key},[s("span",Xa,o(t.main),1),t.showEvidence?(n(),l("span",Za,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",{class:b(["ai-block ai-card ai-card--actions",{"ai-wide":Be.value}])},[s("div",Ja,[e[50]||(e[50]=s("h4",null,"다음 액션",-1)),E("REVIEW")?(n(),l("span",Qa,"참고용")):r("",!0)]),s("ul",en,[(n(!0),l(c,null,v(Pt.value,t=>(n(),l("li",{key:t.text,class:"action-item"},[s("span",{class:b(["action-badge",t.tone])},o(t.priority),3),s("span",tn,o(t.main),1),t.showEvidence?(n(),l("span",sn,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))]),Be.value?(n(),l("div",an,[e[51]||(e[51]=s("h5",null,"특이 징후 없음 · 모니터링 포인트",-1)),s("ul",null,[(n(!0),l(c,null,v(Wt.value,t=>(n(),l("li",{key:t},o(t),1))),128))])])):r("",!0)],2),Be.value?r("",!0):(n(),l("div",nn,[s("div",ln,[e[52]||(e[52]=s("h4",null,"주의·리스크",-1)),E("REVIEW")?(n(),l("span",on,"참고용")):r("",!0)]),s("ul",rn,[(n(!0),l(c,null,v(C($.value,"주의·리스크",2),t=>(n(),l("li",{key:t.key},[s("span",un,o(t.main),1),t.showEvidence?(n(),l("span",dn,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]))])):(n(),l("div",cn,"AI 요약을 생성해보세요."))]),s("div",vn,[e[53]||(e[53]=s("h3",null,"최근 리뷰",-1)),(k.value?.recentReviews??[]).length===0?(n(),l("div",mn,"리뷰가 없습니다.")):(n(),l("div",pn,[(n(!0),l(c,null,v(k.value?.recentReviews,t=>(n(),l("article",{key:t.reviewId,class:"review-card"},[s("div",hn,[s("div",null,[s("strong",null,o(t.accommodationName),1),s("p",_n,o(t.authorName)+" · "+o(t.rating)+"점",1)]),s("span",gn,o(ks(Rs)(t.createdAt,!0)),1)]),s("p",{class:b(["review-content",{expanded:we.value[t.reviewId]}])},o(t.content),3),t.content&&t.content.length>120?(n(),l("button",{key:0,type:"button",class:"link-btn",onClick:i=>ss(t.reviewId)},o(we.value[t.reviewId]?"접기":"더보기"),9,yn)):r("",!0)]))),128))]))]),re.value.length?(n(),l("div",fn,[e[55]||(e[55]=s("h3",null,"리뷰 추이",-1)),s("table",bn,[e[54]||(e[54]=s("thead",null,[s("tr",null,[s("th",null,"월"),s("th",null,"리뷰수"),s("th",null,"평균 평점")])],-1)),s("tbody",null,[(n(!0),l(c,null,v(re.value,t=>(n(),l("tr",{key:t.period},[s("td",null,o(t.period),1),s("td",null,o(p(t.reviewCount)),1),s("td",null,o(t.avgRating),1)]))),128))])]),s("div",kn,[(n(!0),l(c,null,v(re.value,t=>(n(),l("div",{key:t.period,class:"report-card"},[s("div",En,[s("strong",null,o(t.period),1),s("span",null,o(p(t.reviewCount))+"건",1)]),s("p",In,"평균 평점 "+o(t.avgRating),1)]))),128))])])):r("",!0)]))])):F.value==="themes"?(n(),l("section",wn,[s("div",Dn,[s("div",Rn,[s("aside",Mn,[e[62]||(e[62]=s("div",{class:"filter-title"},"필터",-1)),s("div",Nn,[s("label",null,[e[57]||(e[57]=I(" 숙소 ",-1)),V(s("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>h.value.accommodationId=t)},[e[56]||(e[56]=s("option",{value:"all"},"전체 숙소",-1)),(n(!0),l(c,null,v(ie.value,t=>(n(),l("option",{key:t.accommodationsId,value:t.accommodationsId},o(t.accommodationsName),9,An))),128))],512),[[pe,h.value.accommodationId]])]),s("div",$n,[s("button",{type:"button",class:b({active:be.value==="7days"}),onClick:e[11]||(e[11]=t=>Qe("7days"))},"7일",2),s("button",{type:"button",class:b({active:be.value==="30days"}),onClick:e[12]||(e[12]=t=>Qe("30days"))},"30일",2),s("button",{type:"button",class:b({active:be.value==="thisMonth"}),onClick:e[13]||(e[13]=t=>Qe("thisMonth"))},"이번달",2)]),s("label",null,[e[58]||(e[58]=I(" 시작일 ",-1)),V(s("input",{type:"date","onUpdate:modelValue":e[14]||(e[14]=t=>h.value.from=t)},null,512),[[le,h.value.from]])]),s("label",null,[e[59]||(e[59]=I(" 종료일 ",-1)),V(s("input",{type:"date","onUpdate:modelValue":e[15]||(e[15]=t=>h.value.to=t)},null,512),[[le,h.value.to]])]),s("label",null,[e[61]||(e[61]=I(" 지표 ",-1)),V(s("select",{"onUpdate:modelValue":e[16]||(e[16]=t=>h.value.metric=t)},[...e[60]||(e[60]=[s("option",{value:"reservations"},"예약수",-1),s("option",{value:"revenue"},"매출",-1)])],512),[[pe,h.value.metric]])])])]),s("div",Cn,[s("div",Vn,[(n(!0),l(c,null,v(qt.value,t=>(n(),l("div",{key:t.label,class:"kpi-card"},[s("div",null,[s("p",null,o(t.label),1),s("strong",null,o(t.value),1)])]))),128))]),s("div",Sn,[s("div",Tn,[s("div",null,[e[63]||(e[63]=s("p",{class:"ai-kicker"},"AI 테마 인사이트",-1)),e[64]||(e[64]=s("h3",null,"AI 요약",-1)),e[65]||(e[65]=s("p",{class:"muted"},"테마 성과를 기반으로 운영 포인트를 정리합니다.",-1)),E("THEME")?(n(),l("p",xn,o(H("THEME").warningMessage),1)):r("",!0),O.value?(n(),l("p",Hn,o(O.value),1)):r("",!0)]),s("div",Wn,[s("button",{type:"button",class:"primary-btn ai-btn",disabled:!Pe("THEME")||De.value,"aria-busy":f("THEME").loading?"true":"false",onClick:e[17]||(e[17]=t=>ae("THEME",!0))},[f("THEME").loading?(n(),l("span",Ln)):r("",!0),I(" "+o(Ge("THEME")),1)],8,Fn),s("div",Pn,[(n(!0),l(c,null,v(xt.value,t=>(n(),l("span",{key:t,class:"ai-chip"},o(t),1))),128))])])]),Le("THEME")?(n(),l("div",zn,o(H("THEME").disabledReason),1)):f("THEME").loading?(n(),l("div",On,[...e[66]||(e[66]=[s("div",{class:"skeleton-card"},null,-1),s("div",{class:"skeleton-card"},null,-1),s("div",{class:"skeleton-card"},null,-1)])])):f("THEME").error?(n(),l("div",Un,[s("p",null,o(f("THEME").error),1),s("button",{type:"button",class:"link-btn",onClick:e[18]||(e[18]=t=>ae("THEME",!0))},"다시 시도")])):G.value?(n(),l("div",Yn,[s("div",Gn,[s("div",Bn,[e[67]||(e[67]=s("h4",null,"핵심 요약",-1)),E("THEME")?(n(),l("span",jn,"참고용")):r("",!0)]),s("ul",Kn,[(n(!0),l(c,null,v(C(G.value,"핵심 요약",Ve["핵심 요약"]),t=>(n(),l("li",{key:t.key},[s("span",qn,o(t.main),1),t.showEvidence?(n(),l("span",Xn,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",Zn,[s("div",Jn,[e[68]||(e[68]=s("h4",null,"강점",-1)),E("THEME")?(n(),l("span",Qn,"참고용")):r("",!0)]),s("ul",el,[(n(!0),l(c,null,v(C(G.value,"강점",Ve.강점),t=>(n(),l("li",{key:t.key},[s("span",tl,o(t.main),1),t.showEvidence?(n(),l("span",sl,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",al,[s("div",nl,[e[69]||(e[69]=s("h4",null,"개선 포인트",-1)),E("THEME")?(n(),l("span",ll,"참고용")):r("",!0)]),s("ul",ol,[(n(!0),l(c,null,v(C(G.value,"개선 포인트",Ve["개선 포인트"]),t=>(n(),l("li",{key:t.key},[s("span",il,o(t.main),1),t.showEvidence?(n(),l("span",rl,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",ul,[s("div",dl,[e[70]||(e[70]=s("h4",null,"다음 액션",-1)),E("THEME")?(n(),l("span",cl,"참고용")):r("",!0)]),s("ul",vl,[(n(!0),l(c,null,v(zt.value,t=>(n(),l("li",{key:t.text,class:"action-item"},[s("span",{class:b(["action-badge",t.tone])},o(t.priority),3),s("span",ml,o(t.main),1),t.showEvidence?(n(),l("span",pl,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",hl,[s("div",_l,[e[71]||(e[71]=s("h4",null,"모니터링",-1)),E("THEME")?(n(),l("span",gl,"참고용")):r("",!0)]),s("ul",yl,[(n(!0),l(c,null,v(C(G.value,"모니터링",Ve.모니터링),t=>(n(),l("li",{key:t.key},[s("span",fl,o(t.main),1),t.showEvidence?(n(),l("span",bl,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])])])):(n(),l("div",kl," 테마 데이터가 충분하지 않으면 인사이트가 제한될 수 있습니다. "))]),s("div",El,[s("div",Il,[e[72]||(e[72]=s("div",null,[s("h4",null,"테마 인기 결과"),s("p",{class:"muted"},"선택 기간 기준으로 테마별 성과를 보여줍니다.")],-1)),s("div",wl,[s("button",{type:"button",role:"tab","aria-selected":U.value==="cards",class:b({active:U.value==="cards"}),onClick:e[19]||(e[19]=t=>U.value="cards")},"카드",10,Dl),s("button",{type:"button",role:"tab","aria-selected":U.value==="table",class:b({active:U.value==="table"}),onClick:e[20]||(e[20]=t=>U.value="table")},"테이블",10,Rl)])]),s("div",Ml,[De.value?(n(),l("div",Nl,"테마 리포트 로딩 중...")):Re.value?(n(),l("div",Al,o(Re.value),1)):(n(),l("div",$l,[W.value.length===0?(n(),l("div",Cl,"선택한 기간에 테마 데이터가 없습니다.")):(n(),l("div",Vl,[U.value==="cards"?(n(),l("div",Sl,[(n(!0),l(c,null,v(ht.value,t=>(n(),l("article",{key:t.themeId,class:"theme-card"},[s("div",Tl,[s("strong",null,o(t.themeName),1)]),s("div",xl,[s("div",Hl,[e[73]||(e[73]=s("span",null,"예약",-1)),s("strong",null,o(p(t.reservationCount))+"건",1)]),s("div",Wl,[e[74]||(e[74]=s("span",null,"매출",-1)),s("strong",null,o(p(t.revenueSum))+"원",1)]),s("div",Fl,[e[75]||(e[75]=s("span",null,"숙소",-1)),s("strong",null,o(p(t.accommodationCount))+"개",1)])])]))),128))])):(n(),l("div",Ll,[s("table",Pl,[e[76]||(e[76]=s("thead",null,[s("tr",null,[s("th",null,"테마"),s("th",{class:"cell-right"},"예약(건)"),s("th",{class:"cell-right"},"매출(원)"),s("th",{class:"cell-right"},"숙소(개)")])],-1)),s("tbody",null,[(n(!0),l(c,null,v(W.value,t=>(n(),l("tr",{key:t.themeId},[s("td",null,o(t.themeName),1),s("td",zl,[s("span",{class:b({"zero-value":Xe(t.reservationCount)})},o(p(t.reservationCount)),3)]),s("td",Ol,[s("span",{class:b({"zero-value":Xe(t.revenueSum)})},o(p(t.revenueSum)),3)]),s("td",Ul,[s("span",{class:b({"zero-value":Xe(t.accommodationCount)})},o(p(t.accommodationCount)),3)])]))),128))])])]))])),W.value.length?(n(),l("div",Yl,[(n(!0),l(c,null,v(ht.value,t=>(n(),l("article",{key:t.themeId,class:"theme-card"},[s("div",Gl,[s("strong",null,o(t.themeName),1)]),s("div",Bl,[s("div",jl,[e[77]||(e[77]=s("span",null,"예약",-1)),s("strong",null,o(p(t.reservationCount))+"건",1)]),s("div",Kl,[e[78]||(e[78]=s("span",null,"매출",-1)),s("strong",null,o(p(t.revenueSum))+"원",1)]),s("div",ql,[e[79]||(e[79]=s("span",null,"숙소",-1)),s("strong",null,o(p(t.accommodationCount))+"개",1)])])]))),128))])):r("",!0),U.value==="cards"&&W.value.length>qe.value?(n(),l("div",Xl,[s("button",{type:"button",class:"ghost-btn",onClick:e[21]||(e[21]=t=>ve.value=!ve.value)},o(ve.value?"접기":`테마 더보기 (${W.value.length-qe.value}개)`),1)])):r("",!0)]))])])])])])])):(n(),l("section",Zl,[s("div",Jl,[e[86]||(e[86]=s("div",{class:"filter-title"},"필터",-1)),s("div",Ql,[s("label",null,[e[81]||(e[81]=I(" 숙소 ",-1)),V(s("select",{"onUpdate:modelValue":e[22]||(e[22]=t=>_.value.accommodationId=t)},[e[80]||(e[80]=s("option",{value:"all"},"전체 숙소",-1)),(n(!0),l(c,null,v(ie.value,t=>(n(),l("option",{key:t.accommodationsId,value:t.accommodationsId},o(t.accommodationsName),9,eo))),128))],512),[[pe,_.value.accommodationId]])]),s("label",null,[e[83]||(e[83]=I(" 대상 ",-1)),V(s("select",{"onUpdate:modelValue":e[23]||(e[23]=t=>_.value.target=t)},[...e[82]||(e[82]=[s("option",{value:"reservations"},"예약수",-1),s("option",{value:"revenue"},"매출",-1)])],512),[[pe,_.value.target]])]),s("label",null,[e[84]||(e[84]=I(" 예측 기간(일) ",-1)),V(s("input",{type:"number",min:"7",max:"60","onUpdate:modelValue":e[24]||(e[24]=t=>_.value.horizonDays=t)},null,512),[[le,_.value.horizonDays,void 0,{number:!0}]])]),s("label",null,[e[85]||(e[85]=I(" 과거 데이터(일) ",-1)),V(s("input",{type:"number",min:"30",max:"365","onUpdate:modelValue":e[25]||(e[25]=t=>_.value.historyDays=t)},null,512),[[le,_.value.historyDays,void 0,{number:!0}]])])])]),Me.value?(n(),l("div",to,"수요 예측 계산 중...")):Ne.value?(n(),l("div",so,o(Ne.value),1)):(n(),l("div",ao,[s("div",no,[s("div",lo,[s("p",null,"최근 7일 평균"+o(_.value.target==="revenue"?"(원/일)":"(건/일)"),1),s("strong",null,o(j(z.value?.baseline?.recentAvg7??0)),1)]),s("div",oo,[s("p",null,"최근 28일 평균"+o(_.value.target==="revenue"?"(원/일)":"(건/일)"),1),s("strong",null,o(j(z.value?.baseline?.recentAvg28??0)),1)]),s("div",io,[e[87]||(e[87]=s("p",null,"예측 합계",-1)),s("strong",null,o(j(z.value?.forecastSummary?.predictedTotal??0)),1)]),s("div",ro,[e[88]||(e[88]=s("p",null,"최고 예측일",-1)),s("strong",null,o(Ze.value?`${Ze.value.date} · ${j(Ze.value.predictedValue)}`:"-"),1)])]),_t.value?(n(),l("p",uo,o(_t.value),1)):r("",!0),s("div",co,[s("div",vo,[s("div",null,[e[89]||(e[89]=s("p",{class:"ai-kicker"},"AI 수요 인사이트",-1)),e[90]||(e[90]=s("h3",null,"AI 요약",-1)),e[91]||(e[91]=s("p",{class:"muted"},"예측 결과를 기반으로 운영 포인트를 정리합니다.",-1)),E("DEMAND")?(n(),l("p",mo,o(H("DEMAND").warningMessage),1)):r("",!0),O.value?(n(),l("p",po,o(O.value),1)):r("",!0)]),s("div",ho,[s("button",{type:"button",class:"primary-btn ai-btn",disabled:!Pe("DEMAND")||Me.value,"aria-busy":f("DEMAND").loading?"true":"false",onClick:e[26]||(e[26]=t=>ae("DEMAND",!0))},[f("DEMAND").loading?(n(),l("span",go)):r("",!0),I(" "+o(Ge("DEMAND")),1)],8,_o),s("div",yo,[(n(!0),l(c,null,v(Ht.value,t=>(n(),l("span",{key:t,class:"ai-chip"},o(t),1))),128))])])]),Le("DEMAND")?(n(),l("div",fo,o(H("DEMAND").disabledReason),1)):f("DEMAND").loading?(n(),l("div",bo,[...e[92]||(e[92]=[s("div",{class:"skeleton-card"},null,-1),s("div",{class:"skeleton-card"},null,-1),s("div",{class:"skeleton-card"},null,-1)])])):f("DEMAND").error?(n(),l("div",ko,[s("p",null,o(f("DEMAND").error),1),s("button",{type:"button",class:"link-btn",onClick:e[27]||(e[27]=t=>ae("DEMAND",!0))},"다시 시도")])):P.value?(n(),l("div",Eo,[s("div",Io,[s("div",wo,[e[93]||(e[93]=s("h4",null,"핵심 요약",-1)),E("DEMAND")?(n(),l("span",Do,"참고용")):r("",!0)]),s("ul",Ro,[(n(!0),l(c,null,v(C(P.value,"핵심 요약",je["핵심 요약"]),t=>(n(),l("li",{key:t.key},[s("span",Mo,o(t.main),1),t.showEvidence?(n(),l("span",No,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",Ao,[s("div",$o,[e[94]||(e[94]=s("h4",null,"해석 포인트",-1)),E("DEMAND")?(n(),l("span",Co,"참고용")):r("",!0)]),s("ul",Vo,[(n(!0),l(c,null,v(C(P.value,"해석 포인트",je["해석 포인트"]),t=>(n(),l("li",{key:t.key},[s("span",So,o(t.main),1),t.showEvidence?(n(),l("span",To,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",xo,[s("div",Ho,[e[95]||(e[95]=s("h4",null,"운영 액션",-1)),E("DEMAND")?(n(),l("span",Wo,"참고용")):r("",!0)]),s("ul",Fo,[(n(!0),l(c,null,v(jt.value,t=>(n(),l("li",{key:t.key},[s("span",Lo,o(t.main),1),t.showEvidence?(n(),l("span",Po,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",zo,[s("div",Oo,[e[96]||(e[96]=s("h4",null,"개선 포인트",-1)),E("DEMAND")?(n(),l("span",Uo,"참고용")):r("",!0)]),s("ul",Yo,[(n(!0),l(c,null,v(C(P.value,"개선 포인트",je["개선 포인트"]),t=>(n(),l("li",{key:t.key},[s("span",Go,o(t.main),1),t.showEvidence?(n(),l("span",Bo,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])]),s("div",jo,[s("div",Ko,[e[97]||(e[97]=s("h4",null,"모니터링",-1)),E("DEMAND")?(n(),l("span",qo,"참고용")):r("",!0),Ke.value.length>2?(n(),l("button",{key:1,type:"button",class:"ghost-btn ai-toggle",onClick:e[28]||(e[28]=t=>ce.value=!ce.value)},o(ce.value?"접기":"펼치기"),1)):r("",!0)]),s("ul",Xo,[(n(!0),l(c,null,v(Bt.value.map(Ce),t=>(n(),l("li",{key:t.key},[s("span",Zo,o(t.main),1),t.showEvidence?(n(),l("span",Jo,o(D())+": "+o(t.evidence),1)):r("",!0)]))),128))])])])):(n(),l("div",Qo," 예측 데이터가 충분하지 않으면 인사이트가 제한될 수 있습니다. "))]),J.value.length===0?(n(),l("div",ei,"예측 데이터가 없습니다.")):(n(),l("div",ti,[de.value?(n(),l("div",si,[s("div",ai,[s("button",{type:"button",role:"tab","aria-selected":x.value==="table",class:b({active:x.value==="table"}),onClick:e[29]||(e[29]=t=>x.value="table")},"테이블",10,ni),s("button",{type:"button",role:"tab","aria-selected":x.value==="cards",class:b({active:x.value==="cards"}),onClick:e[30]||(e[30]=t=>x.value="cards")},"카드",10,li)])])):r("",!0),de.value&&x.value==="table"?(n(),l("div",oi,[te.value?(n(),l("div",ii,[e[98]||(e[98]=fs('<div class="forecast-chart__legend" data-v-a9ce3bb0><span class="legend-item" data-v-a9ce3bb0><span class="legend-dot" data-v-a9ce3bb0></span>예측</span><span class="legend-item" data-v-a9ce3bb0><span class="legend-band" data-v-a9ce3bb0></span>범위</span></div>',1)),(n(),l("svg",ri,[s("path",{class:"forecast-chart__band",d:te.value.areaPath},null,8,ui),s("polyline",{class:"forecast-chart__line",points:te.value.linePoints},null,8,di),s("g",ci,[(n(!0),l(c,null,v(ee.value,(t,i)=>(n(),l("circle",{key:t.date,cx:30+940/Math.max(1,ee.value.length-1)*i,cy:180-(t.predicted-te.value.minY)/(te.value.maxY-te.value.minY||1)*160,r:"3"},[s("title",null,o(t.date)+" · "+o(j(t.predicted))+" · "+o(Je(t)),1)],8,vi))),128))])])),s("div",mi,[s("span",null,o(ee.value[0]?.label),1),s("span",null,o(ee.value[ee.value.length-1]?.label),1)])])):(n(),l("div",pi,"예측 데이터가 없습니다.")),s("table",hi,[s("thead",null,[s("tr",null,[e[99]||(e[99]=s("th",null,"날짜",-1)),e[100]||(e[100]=s("th",null,"요일",-1)),s("th",_i,o(Xt.value),1),s("th",gi,o(Zt.value),1)])]),s("tbody",null,[(n(!0),l(c,null,v(J.value,t=>(n(),l("tr",{key:t.date,class:b([{"forecast-weekend":t.isWeekend},{"forecast-holiday":t.isHoliday}])},[s("td",null,o(t.date),1),s("td",null,o(t.dowLabel),1),s("td",yi,o(j(t.predictedValue)),1),s("td",fi,o(Je(t)),1)],2))),128))])])])):r("",!0),!de.value||x.value==="cards"?(n(),l("div",bi,[(n(!0),l(c,null,v(J.value,t=>(n(),l("div",{key:t.date,class:"report-card"},[s("div",ki,[s("strong",null,o(t.date),1),s("span",null,o(j(t.predictedValue)),1)]),s("p",Ei,o(t.dowLabel)+o(t.isHoliday?" · 공휴일":t.isWeekend?" · 주말":""),1),s("p",Ii,"예측 범위 "+o(Je(t)),1)]))),128))])):r("",!0)]))]))]))],64))])):(n(),l("section",wi,[...e[101]||(e[101]=[s("div",{class:"loading-box"},"권한을 확인하는 중입니다...",-1)])]))}},Ci=ms(Di,[["__scopeId","data-v-a9ce3bb0"]]);export{Ci as default};
