import{_ as U,r as v,q as u,b as I,y as F,c as r,e as o,C as W,I as M,d as g,F as O,f as P,t as y,l as C,k as H,o as n}from"./index-D-t2vnuJ.js";import{a as K}from"./reportExport-BKny35g8.js";import{A as T}from"./AdminStatCard-BRXY_H91.js";import{A as G}from"./AdminBarChart-BZ3506Za.js";import{c as Q}from"./adminApi-DEH9EAim.js";import{a as X,t as S,b as j,f as z}from"./chartSeries-o4DA8yhq.js";import"./AdminBadge-DlcxCZoH.js";const J={class:"admin-page"},Y={class:"admin-page__header"},Z={class:"admin-inline-actions admin-inline-actions--nowrap"},ee={class:"admin-grid"},ae={key:0,class:"admin-status"},te={key:1,class:"admin-status"},se={class:"admin-card admin-report-card"},oe={class:"admin-card__head"},ne={class:"admin-card__title"},le={key:0,class:"admin-chip admin-chip--muted"},ue={class:"admin-chart-area"},re={key:0,class:"admin-status"},ie={__name:"AdminWeeklyReportView",setup(ce){const l=v(7),a=v(null),p=v(!1),c=v(""),w=H(),D=e=>X(e),m=(e,t="건")=>`${Number(e??0).toLocaleString()}${t}`,_=e=>`${Number(e??0).toLocaleString()}명`,h=e=>`${Number(e??0).toLocaleString()}개`,N=e=>e?String(e).slice(0,10):"",b=async()=>{p.value=!0,c.value="";const e=await Q({days:l.value});e.ok&&e.data?a.value=e.data:c.value="주간 리포트를 불러오지 못했습니다.",p.value=!1},R=u(()=>{if(!a.value)return[];const{from:e,to:t}=k(),s=e&&t?{from:e,to:t}:{};return[{label:"예약 생성",value:m(a.value.reservationCount),sub:"예약 생성(선택 기간)",tone:"primary",to:{path:"/admin/bookings",query:s}},{label:"결제 성공",value:m(a.value.paymentSuccessCount),sub:"결제 성공(완료 기준)",tone:"success",to:{path:"/admin/payments",query:{status:"SUCCESS",...s}}},{label:"취소",value:m(a.value.cancelCount),sub:"예약 취소(완료 기준)",tone:"neutral",to:{path:"/admin/bookings",query:{status:"canceled",...s}}},{label:"환불",value:m(a.value.refundCount),sub:`환불 금액 ${D(a.value.refundAmount)}`,tone:"warning",to:{path:"/admin/payments",query:{status:"REFUNDED",type:"REFUND",...s}}},{label:"신규 가입자",value:_(a.value.newUsers),sub:"신규 가입(전체 계정)",tone:"accent",to:{path:"/admin/users",query:s}},{label:"신규 숙소",value:h(a.value.newAccommodations),sub:"숙소 등록(완료 기준)",tone:"primary",to:{path:"/admin/accommodations",query:s}},{label:"승인 대기 숙소",value:h(a.value.pendingAccommodations),sub:"승인 대기(심사 기준)",tone:"warning",to:{path:"/admin/accommodations",query:{status:"PENDING",...s}}},{label:"신규 호스트",value:_(a.value.newHosts),sub:"호스트 전환(승인 기준)",tone:"success",to:{path:"/admin/users",query:{role:"HOST",...s}}}]}),k=()=>{if(a.value?.from&&a.value?.to)return{from:a.value.from,to:a.value.to};const e=new Date,t=new Date;return t.setDate(e.getDate()-(Number(l.value??7)-1)),{from:S(t),to:S(e)}},d=u(()=>{if(!a.value)return[];const e=a.value.revenueSeries??[],{from:t,to:s}=k(),f=j(t,s),E=z(f,e,i=>N(i.date),i=>i.value);return f.map((i,L)=>({date:i,value:E[L]}))}),x=u(()=>d.value.some(e=>Number(e.value??0)>0)),A=u(()=>d.value.map(e=>e.date)),q=u(()=>d.value.map(e=>Number(e.value??0))),V=u(()=>Number(l.value)>10?8:7),$=()=>{if(!a.value)return;const e=d.value.map(t=>({date:t.date,revenue:t.value??0}));K({filename:`weekly-report_${a.value.from}_${a.value.to}.csv`,sheets:[{name:"일별 매출",columns:[{key:"date",label:"날짜"},{key:"revenue",label:"매출(원)"}],rows:e}]})};I(b),F(l,b);const B=e=>{e?.to&&w.push(e.to)};return(e,t)=>(n(),r("section",J,[o("header",Y,[t[2]||(t[2]=o("div",null,[o("h1",{class:"admin-title"},"주간 리포트"),o("p",{class:"admin-subtitle"},"선택 기간의 KPI와 매출 추이를 요약합니다.")],-1)),o("div",Z,[W(o("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),class:"admin-select"},[...t[1]||(t[1]=[o("option",{value:7},"최근 7일",-1),o("option",{value:30},"최근 30일",-1)])],512),[[M,l.value]]),o("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:$},"CSV 다운로드")])]),o("div",ee,[(n(!0),r(O,null,P(R.value,s=>(n(),C(T,{key:s.label,label:s.label,value:s.value,sub:s.sub,tone:s.tone,clickable:!!s.to,onClick:f=>B(s)},null,8,["label","value","sub","tone","clickable","onClick"]))),128)),p.value?(n(),r("div",ae,"불러오는 중...")):c.value?(n(),r("div",te,[o("span",null,y(c.value),1),o("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:b},"다시 시도")])):g("",!0)]),o("div",se,[o("div",oe,[o("div",null,[t[3]||(t[3]=o("p",{class:"admin-card__eyebrow"},"일별 매출(원)",-1)),o("h3",ne,y(a.value?.from??"-")+" ~ "+y(a.value?.to??"-"),1)]),a.value&&!a.value.statsReady?(n(),r("span",le,"통계 데이터 준비 중")):g("",!0)]),o("div",ue,[x.value?(n(),C(G,{key:1,labels:A.value,values:q.value,height:260,format:"currency","tooltip-label":"매출","max-x-ticks":V.value},null,8,["labels","values","max-x-ticks"])):(n(),r("div",re,"표시할 데이터가 없습니다."))])])]))}},_e=U(ie,[["__scopeId","data-v-bb7e7fed"]]);export{_e as default};
