import{_ as v,r as p,b as f,a0 as _,k,c as a,e as s,t as R,o as c}from"./index-Br9ce33d.js";const T={class:"oauth2-redirect-page"},S={class:"redirect-container"},y={key:0,class:"loading-state"},I={key:1,class:"error-state"},b={key:2,class:"success-state"},U={__name:"OAuth2RedirectHandler",setup(w){const d=k(),u=p(!0),i=p(null),g=t=>{try{const n=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(n).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(o)}catch(e){return console.error("JWT 디코딩 실패:",e),null}};return f(async()=>{try{const t=new URLSearchParams(window.location.search),e=t.get("accessToken"),n=t.get("refreshToken"),o=t.get("redirect"),r=sessionStorage.getItem("postLoginRedirect");if(!e||!n)throw new Error("토큰을 받지 못했습니다.");sessionStorage.setItem("accessToken",e),sessionStorage.setItem("refreshToken",n);const l=g(e);if(l){const h={email:l.sub,role:l.authorities?.[0]?.replace("ROLE_","")||"USER"};_(h)}const m=(o&&o.startsWith("/")?o:"")||(r&&r.startsWith("/")?r:"")||"/";sessionStorage.removeItem("postLoginRedirect"),setTimeout(()=>{d.push(m)},1e3)}catch(t){console.error("OAuth2 로그인 처리 중 오류:",t),i.value=t.message||"소셜 로그인에 실패했습니다.",setTimeout(()=>{sessionStorage.removeItem("postLoginRedirect"),d.push("/login")},3e3)}finally{u.value=!1}}),(t,e)=>(c(),a("div",T,[s("div",S,[u.value?(c(),a("div",y,[...e[0]||(e[0]=[s("div",{class:"spinner"},null,-1),s("h2",null,"로그인 처리 중...",-1),s("p",null,"잠시만 기다려주세요",-1)])])):i.value?(c(),a("div",I,[e[1]||(e[1]=s("div",{class:"error-icon"},"✕",-1)),e[2]||(e[2]=s("h2",null,"로그인 실패",-1)),s("p",null,R(i.value),1),e[3]||(e[3]=s("p",{class:"redirect-info"},"로그인 페이지로 이동합니다...",-1))])):(c(),a("div",b,[...e[4]||(e[4]=[s("div",{class:"success-icon"},"✓",-1),s("h2",null,"로그인 성공!",-1),s("p",null,"메인 페이지로 이동합니다...",-1)])]))])]))}},O=v(U,[["__scopeId","data-v-80da574e"]]);export{O as default};
