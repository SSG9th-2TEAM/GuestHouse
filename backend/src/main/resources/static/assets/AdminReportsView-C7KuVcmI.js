import{_ as N,r as l,b as M,s as P,q as T,y as z,c as r,e as t,m as S,F as A,f as E,C,E as F,H as V,G as H,k as Q,o as i,l as X,d as K,t as m}from"./index-CdO51RKj.js";import{A as U}from"./AdminStatCard-BEzKxgvf.js";import{A as W}from"./AdminBadge-CFvNxkPV.js";import{A as O}from"./AdminTableCard-Dt-NU9S4.js";import{e as j,a as G}from"./reportExport-BKny35g8.js";import{s as J}from"./adminApi-D_lB5XN3.js";import{e as Y,a as Z,t as L}from"./adminData-ZmZ3C3cR.js";const tt={class:"admin-page"},et={class:"admin-grid"},at={class:"admin-filter-bar"},st={class:"admin-filter-group"},nt={class:"admin-filter-group"},lt={class:"admin-filter-group"},ot={class:"admin-dropdown"},it={class:"admin-dropdown__menu"},ut={class:"admin-table--nowrap admin-table--tight"},rt={class:"admin-strong"},dt={class:"admin-strong"},mt={key:0,class:"admin-status"},pt={key:1,class:"admin-status"},vt={key:2,class:"admin-status"},ct={class:"admin-pagination"},bt=["disabled"],yt=["disabled"],gt={__name:"AdminReportsView",setup(ft){const x=l([]),p=l([]),u=l(""),o=l("all"),k=l("all"),n=l(0),D=l(20),_=l(0),$=l(0),h=l(!1),y=l(""),v=P(),q=Q(),c=async()=>{h.value=!0,y.value="";const s=await J({status:o.value,keyword:u.value||void 0,page:n.value,size:D.value,sort:"latest"});if(s.ok&&s.data){const e=s.data;p.value=Y(e);const a=Z(e);n.value=a.page,D.value=a.size,_.value=a.totalPages,$.value=a.totalElements;const d=p.value.filter(b=>b.status==="WAIT").length,g=p.value.filter(b=>b.status==="CHECKED").length,f=p.value.filter(b=>b.status==="BLINDED").length;x.value=[{label:"대기중",value:`${d}건`,sub:"현재 페이지 기준",tone:"warning"},{label:"처리완료",value:`${g}건`,sub:"현재 페이지 기준",tone:"success"},{label:"블라인드",value:`${f}건`,sub:"현재 페이지 기준",tone:"accent"}]}else y.value="신고 목록을 불러오지 못했습니다.";h.value=!1},B=s=>{const e={...v.query,...s},a=L(e),d=L(v.query);Object.keys({...a,...d}).every(f=>String(a[f]??"")===String(d[f]??""))||q.replace({query:a})};M(()=>{o.value=v.query.status??"all",u.value=v.query.keyword??"",n.value=Number(v.query.page??0),c()});const R=s=>s==="CHECKED"?"success":s==="BLINDED"?"danger":s==="WAIT"?"warning":"neutral",w=T(()=>{const s=u.value.trim().toLowerCase();return p.value.filter(e=>{const a=!s||String(e.reportId??"").includes(s)||(e.title??"").toLowerCase().includes(s),d=o.value==="all"||e.status===o.value,g=k.value==="all";return a&&d&&g})});z([u,o],()=>{n.value=0,B({status:o.value,keyword:u.value||void 0,page:n.value}),c()});const I=s=>{const e=new Date().toISOString().slice(0,10),a=[{name:"신고 목록",columns:[{key:"id",label:"신고ID"},{key:"reporter",label:"신고자"},{key:"target",label:"피신고자"},{key:"reason",label:"사유"},{key:"summary",label:"요약"},{key:"createdAt",label:"신고 일시"},{key:"priority",label:"우선순위"},{key:"status",label:"상태"},{key:"assignee",label:"담당자"}],rows:w.value}];if(s==="xlsx"){j({filename:`admin-reports-${e}.xlsx`,sheets:a});return}G({filename:`admin-reports-${e}.csv`,sheets:a})};return(s,e)=>(i(),r("section",tt,[e[15]||(e[15]=t("header",{class:"admin-page__header"},[t("div",null,[t("h1",{class:"admin-title"},"신고 관리"),t("p",{class:"admin-subtitle"},"신고 접수 현황과 처리 단계를 추적합니다.")])],-1)),t("div",et,[(i(!0),r(A,null,E(x.value,a=>(i(),X(U,{key:a.label,label:a.label,value:a.value,sub:a.sub,tone:a.tone},null,8,["label","value","sub","tone"]))),128))]),t("div",at,[t("div",st,[e[7]||(e[7]=t("span",{class:"admin-chip"},"검색",-1)),C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),class:"admin-input",type:"search",placeholder:"신고ID, 신고자, 피신고자, 사유"},null,512),[[F,u.value]])]),t("div",nt,[e[10]||(e[10]=t("span",{class:"admin-chip"},"필터",-1)),C(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a),class:"admin-select"},[...e[8]||(e[8]=[t("option",{value:"all"},"전체 상태",-1),t("option",{value:"WAIT"},"대기",-1),t("option",{value:"CHECKED"},"처리완료",-1),t("option",{value:"BLINDED"},"블라인드",-1)])],512),[[V,o.value]]),C(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>k.value=a),class:"admin-select"},[...e[9]||(e[9]=[t("option",{value:"all"},"전체 우선순위",-1),t("option",{value:"높음"},"높음",-1),t("option",{value:"중간"},"중간",-1),t("option",{value:"낮음"},"낮음",-1)])],512),[[V,k.value]])]),e[12]||(e[12]=t("div",{class:"admin-filter-group"},[t("span",{class:"admin-chip"},"작업"),t("button",{class:"admin-btn admin-btn--ghost",type:"button"},"담당자 재배정"),t("button",{class:"admin-btn admin-btn--primary",type:"button"},"보고서 생성")],-1)),t("div",lt,[t("details",ot,[e[11]||(e[11]=t("summary",{class:"admin-btn admin-btn--ghost"},"다운로드",-1)),t("div",it,[t("button",{class:"admin-btn admin-btn--ghost admin-dropdown__item",type:"button",onClick:e[3]||(e[3]=a=>I("csv"))},"CSV"),t("button",{class:"admin-btn admin-btn--primary admin-dropdown__item",type:"button",onClick:e[4]||(e[4]=a=>I("xlsx"))},"XLSX")])])])]),S(O,{title:"신고 목록"},{default:H(()=>[t("table",ut,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",null,"신고ID"),t("th",null,"신고 사유"),t("th",null,"신고 일시"),t("th",null,"처리 상태"),t("th",null,"관리")])],-1)),t("tbody",null,[(i(!0),r(A,null,E(w.value,a=>(i(),r("tr",{key:a.reportId},[t("td",rt,"#"+m(a.reportId),1),t("td",dt,m(a.title),1),t("td",null,m(a.createdAt?.slice?.(0,10)??"-"),1),t("td",null,[S(W,{text:a.status,variant:R(a.status)},null,8,["text","variant"])]),e[13]||(e[13]=t("td",null,[t("div",{class:"admin-inline-actions admin-inline-actions--nowrap"},[t("button",{class:"admin-btn admin-btn--ghost",type:"button"},"상세"),t("button",{class:"admin-btn admin-btn--muted",type:"button"},"메모"),t("button",{class:"admin-btn admin-btn--primary",type:"button"},"처리")])],-1))]))),128))])]),h.value?(i(),r("div",mt,"불러오는 중...")):y.value?(i(),r("div",pt,[t("span",null,m(y.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:c},"다시 시도")])):w.value.length?K("",!0):(i(),r("div",vt,"데이터가 없습니다.")),t("div",ct,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:n.value<=0,onClick:e[5]||(e[5]=a=>{n.value=n.value-1,c()})}," 이전 ",8,bt),t("span",null,m(n.value+1)+" / "+m(Math.max(_.value,1)),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:n.value+1>=_.value,onClick:e[6]||(e[6]=a=>{n.value=n.value+1,c()})}," 다음 ",8,yt)])]),_:1})]))}},It=N(gt,[["__scopeId","data-v-1d8bf21c"]]);export{It as default};
