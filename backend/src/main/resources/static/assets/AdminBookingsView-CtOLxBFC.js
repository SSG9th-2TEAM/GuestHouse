import{_ as it,r as o,b as dt,s as rt,q as B,y as vt,c as u,e as t,m as A,d as $,C as H,E as ct,I as mt,F as D,f as q,p as k,H as pt,t as l,k as bt,o as i}from"./index-Ds_d9er1.js";import{A as C}from"./AdminBadge-Dt6qF2kO.js";import{A as gt}from"./AdminTableCard-DWOzhsTb.js";import{e as yt,a as ft}from"./reportExport-DvZZ7m0X.js";import{j as _t,k as kt,l as St}from"./adminApi-DO0pPYdn.js";import{e as ht,a as wt,t as K}from"./adminData-ZmZ3C3cR.js";import{c as At,r as It,a as xt,b as Rt}from"./adminReservationPolicy-DT_2QSAw.js";const Nt={0:"임시",1:"요청",2:"확정",3:"체크인 완료",9:"취소"},Ct={0:"neutral",1:"warning",2:"success",3:"success",9:"danger"},Lt={0:"미결제",1:"결제 완료",2:"결제 실패",3:"환불 완료"},Tt={0:"neutral",1:"success",2:"danger",3:"warning"},Et=[{value:"all",label:"전체 상태"},{value:"requested",label:"요청"},{value:"confirmed",label:"확정"},{value:"checkedin",label:"체크인 완료"},{value:"canceled",label:"취소"}],Vt=v=>{const d=Number(v);return Number.isFinite(d)?Nt[d]??`알 수 없음(${v})`:"알 수 없음"},Pt=v=>{const d=Number(v);return Ct[d]??"neutral"},F=v=>{const d=Number(v);return Number.isFinite(d)?Lt[d]??`알 수 없음(${v})`:"알 수 없음"},J=v=>{const d=Number(v);return Tt[d]??"neutral"},Bt={class:"admin-page"},$t={class:"admin-filter-bar"},Dt={class:"admin-filter-group"},qt={class:"admin-filter-group"},Ft=["value"],Ot={class:"admin-filter-group"},Qt={class:"admin-dropdown"},Ut={class:"admin-dropdown__menu"},Mt={class:"booking-cards"},zt={class:"booking-card__row booking-card__row--top"},Xt={class:"booking-card__id"},jt={class:"booking-card__row"},Yt={class:"booking-card__title"},Gt={class:"booking-card__sub"},Ht={class:"booking-card__row booking-card__row--dates"},Kt={class:"booking-card__row booking-card__row--bottom"},Jt={class:"booking-card__amount"},Wt=["onClick"],Zt={class:"admin-table--nowrap admin-table--tight admin-table--stretch booking-table"},tn={class:"admin-strong"},nn=["title"],en=["title"],an={class:"admin-align-right"},ln={class:"admin-inline-actions admin-inline-actions--nowrap"},sn=["onClick"],on=["disabled","title"],un=["disabled","title"],dn={key:0,class:"admin-status"},rn={key:1,class:"admin-status"},vn={key:2,class:"admin-status"},cn={class:"admin-pagination"},mn=["disabled"],pn=["disabled"],bn={key:0,class:"admin-modal"},gn={class:"admin-modal__panel",role:"dialog","aria-modal":"true"},yn={class:"admin-modal__header"},fn={class:"admin-modal__title"},_n={key:0,class:"admin-status"},kn={key:1,class:"admin-status"},Sn={key:2,class:"admin-modal__body"},hn={class:"admin-modal__section"},wn={class:"admin-detail-grid"},An={class:"admin-modal__section admin-modal__note"},In={key:3,class:"admin-modal__actions"},xn=["disabled"],Rn=["disabled"],Nn={__name:"AdminBookingsView",setup(v){const d=o([]),b=o(""),m=o("all"),r=o(0),O=o(20),L=o(0),W=o(0),T=o(!1),I=o(""),E=o(!1),x=o(!1),S=o(""),s=o(null),R=o(null),g=o(!1),y=o(""),p=o(null),h=rt(),Z=bt(),w=async()=>{T.value=!0,I.value="";const a=await _t({status:m.value,sort:m.value==="checkin"?"checkin":"latest",page:r.value,size:O.value});if(a.ok&&a.data){const n=a.data;d.value=ht(n);const e=wt(n);r.value=e.page,O.value=e.size,L.value=e.totalPages,W.value=e.totalElements}else I.value="예약 목록을 불러오지 못했습니다.";T.value=!1},tt=a=>{const n={...h.query,...a},e=K(n),_=K(h.query);Object.keys({...e,..._}).every(G=>String(e[G]??"")===String(_[G]??""))||Z.replace({query:e})},nt=a=>a?a==="pending"?"requested":a:"all";dt(()=>{m.value=nt(h.query.status)??"all",b.value=h.query.keyword??"",r.value=Number(h.query.page??0),w()});const et=a=>a==="confirmed"?"2":a==="pending"||a==="requested"?"1":a==="checkedin"?"3":a==="canceled"?"9":a,N=B(()=>{const a=b.value.trim().toLowerCase();return d.value.filter(n=>{const e=!a||String(n.reservationId??"").includes(a)||String(n.accommodationsId??"").includes(a)||String(n.userId??"").includes(a),_=m.value==="all"||String(n.reservationStatus)===et(m.value);return e&&_})});vt([b,m],()=>{r.value=0,tt({status:m.value,keyword:b.value||void 0,page:r.value}),w()});const Q=a=>{const n=new Date().toISOString().slice(0,10),e=[{name:"예약 목록",columns:[{key:"id",label:"예약번호"},{key:"accommodation",label:"숙소"},{key:"host",label:"호스트"},{key:"guest",label:"게스트"},{key:"checkIn",label:"체크인"},{key:"checkOut",label:"체크아웃"},{key:"people",label:"인원"},{key:"price",label:"금액"},{key:"status",label:"상태"},{key:"paymentStatus",label:"결제"},{key:"channel",label:"채널"},{key:"createdAt",label:"등록일"}],rows:N.value}];if(a==="xlsx"){yt({filename:`admin-bookings-${n}.xlsx`,sheets:e});return}ft({filename:`admin-bookings-${n}.csv`,sheets:e})},V=async a=>{if(!a?.reservationId)return;R.value=a.reservationId,E.value=!0,x.value=!0,S.value="",g.value=!0,y.value="",p.value=null;const n=await kt(a.reservationId);n.ok&&n.data?s.value=n.data:S.value="예약 상세 정보를 불러오지 못했습니다.",x.value=!1,await lt(a.reservationId)},U=()=>{E.value=!1,S.value="",s.value=null,R.value=null,g.value=!1,y.value="",p.value=null},at=async()=>{R.value&&await V({reservationId:R.value})},lt=async a=>{if(!a)return;g.value=!0,y.value="";const n=await St(a);n.ok&&n.data?p.value=n.data:y.value=n?.data?.message||"환불 계산 불가",g.value=!1},st=B(()=>{if(g.value)return"계산 중...";if(y.value)return"계산 불가";if(!p.value)return"-";const a=Number(p.value.daysBefore),n=Number.isFinite(a)?`D-${a}`:"-";return`${p.value.refundRate}% (${n})`}),ot=B(()=>g.value?"계산 중...":y.value||!p.value?"-":f(p.value.refundAmount)),f=a=>a==null?"-":`₩${Number(a).toLocaleString()}`,c=a=>a?String(a).slice(0,10):"-",P=(a,n)=>Number(n)===3?"환불 완료":Vt(a),M=(a,n)=>Number(n)===3?"warning":Pt(a),z=a=>xt(a??{}),X=a=>Rt(a??{}),j=a=>At(a??{}),Y=a=>It(a??{}),ut=a=>{const n=Number(a);return Number.isFinite(n)?n===0?"요청":n===1?"완료":n===2?"실패":`알 수 없음(${a})`:"-"};return(a,n)=>(i(),u("section",Bt,[n[37]||(n[37]=t("header",{class:"admin-page__header"},[t("div",null,[t("h1",{class:"admin-title"},"예약 관리"),t("p",{class:"admin-subtitle"},"예약 상태와 체크인 현황을 확인합니다.")])],-1)),t("div",$t,[t("div",Dt,[n[6]||(n[6]=t("span",{class:"admin-chip"},"검색",-1)),H(t("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>b.value=e),class:"admin-input",type:"search",placeholder:"예약번호, 숙소 ID, 게스트 ID"},null,512),[[ct,b.value]])]),t("div",qt,[n[7]||(n[7]=t("span",{class:"admin-chip"},"필터",-1)),H(t("select",{"onUpdate:modelValue":n[1]||(n[1]=e=>m.value=e),class:"admin-select"},[(i(!0),u(D,null,q(k(Et),e=>(i(),u("option",{key:e.value,value:e.value},l(e.label),9,Ft))),128))],512),[[mt,m.value]])]),n[9]||(n[9]=t("div",{class:"admin-filter-group"},[t("span",{class:"admin-chip"},"작업"),t("button",{class:"admin-btn admin-btn--primary",type:"button"},"체크인 확인")],-1)),t("div",Ot,[t("details",Qt,[n[8]||(n[8]=t("summary",{class:"admin-btn admin-btn--ghost"},"다운로드",-1)),t("div",Ut,[t("button",{class:"admin-btn admin-btn--ghost admin-dropdown__item",type:"button",onClick:n[2]||(n[2]=e=>Q("csv"))},"CSV"),t("button",{class:"admin-btn admin-btn--primary admin-dropdown__item",type:"button",onClick:n[3]||(n[3]=e=>Q("xlsx"))},"XLSX")])])])]),A(gt,{title:"예약 목록"},{default:pt(()=>[t("div",Mt,[(i(!0),u(D,null,q(N.value,e=>(i(),u("article",{key:e.reservationId,class:"booking-card"},[t("div",zt,[t("span",Xt,"#"+l(e.reservationId),1),A(C,{text:P(e.reservationStatus,e.paymentStatus),variant:M(e.reservationStatus,e.paymentStatus)},null,8,["text","variant"])]),t("div",jt,[t("span",Yt,"숙소 #"+l(e.accommodationsId??"-"),1),t("span",Gt,"게스트 #"+l(e.userId??"-"),1)]),t("div",Ht,[t("span",null,l(c(e.checkin)),1),n[10]||(n[10]=t("span",null,"~",-1)),t("span",null,l(c(e.checkout)),1)]),t("div",Kt,[t("span",Jt,l(f(e.finalPaymentAmount)),1),A(C,{text:k(F)(e.paymentStatus),variant:k(J)(e.paymentStatus)},null,8,["text","variant"]),t("button",{class:"admin-btn admin-btn--ghost booking-card__action",type:"button",onClick:_=>V(e)},"상세",8,Wt)])]))),128))]),t("table",Zt,[n[12]||(n[12]=t("colgroup",null,[t("col",{style:{width:"110px"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"110px"}}),t("col",{style:{width:"110px"}}),t("col",{style:{width:"70px"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"110px"}}),t("col",{style:{width:"110px"}}),t("col",{style:{width:"110px"}}),t("col",{style:{width:"190px"}})],-1)),n[13]||(n[13]=t("thead",null,[t("tr",null,[t("th",null,"예약번호"),t("th",null,"숙소"),t("th",null,"게스트"),t("th",null,"체크인"),t("th",null,"체크아웃"),t("th",null,"인원"),t("th",null,"금액"),t("th",null,"상태"),t("th",null,"결제"),t("th",null,"등록일"),t("th",null,"관리")])],-1)),t("tbody",null,[(i(!0),u(D,null,q(N.value,e=>(i(),u("tr",{key:e.reservationId},[t("td",tn,"#"+l(e.reservationId),1),t("td",{class:"admin-ellipsis",title:e.accommodationsId},l(e.accommodationsId),9,nn),t("td",{class:"admin-ellipsis",title:e.userId},l(e.userId),9,en),t("td",null,l(c(e.checkin)),1),t("td",null,l(c(e.checkout)),1),n[11]||(n[11]=t("td",{class:"admin-nowrap"},"-",-1)),t("td",an,l(f(e.finalPaymentAmount)),1),t("td",null,[A(C,{text:P(e.reservationStatus,e.paymentStatus),variant:M(e.reservationStatus,e.paymentStatus)},null,8,["text","variant"])]),t("td",null,[A(C,{text:k(F)(e.paymentStatus),variant:k(J)(e.paymentStatus)},null,8,["text","variant"])]),t("td",null,l(c(e.createdAt)),1),t("td",null,[t("div",ln,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:_=>V(e)},"상세",8,sn),t("button",{class:"admin-btn admin-btn--muted",type:"button",disabled:!z(e),title:j(e)}," 변경 ",8,on),t("button",{class:"admin-btn admin-btn--danger",type:"button",disabled:!X(e),title:Y(e)}," 환불 ",8,un)])])]))),128))])]),T.value?(i(),u("div",dn,"불러오는 중...")):I.value?(i(),u("div",rn,[t("span",null,l(I.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:w},"다시 시도")])):N.value.length?$("",!0):(i(),u("div",vn,"조건에 맞는 예약이 없습니다.")),t("div",cn,[t("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:r.value<=0,onClick:n[4]||(n[4]=e=>{r.value=r.value-1,w()})}," 이전 ",8,mn),t("span",null,l(r.value+1)+" / "+l(Math.max(L.value,1)),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:r.value+1>=L.value,onClick:n[5]||(n[5]=e=>{r.value=r.value+1,w()})}," 다음 ",8,pn)])]),_:1}),E.value?(i(),u("div",bn,[t("div",{class:"admin-modal__backdrop",onClick:U}),t("div",gn,[t("div",yn,[t("div",null,[n[14]||(n[14]=t("p",{class:"admin-modal__eyebrow"},"예약 상세",-1)),t("h2",fn,"#"+l(s.value?.reservationId??"-"),1)]),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:U},"닫기")]),x.value?(i(),u("div",_n,"불러오는 중...")):S.value?(i(),u("div",kn,[t("span",null,l(S.value),1),t("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:at},"다시 시도")])):(i(),u("div",Sn,[t("div",hn,[n[36]||(n[36]=t("h3",null,"예약 정보",-1)),t("div",wn,[t("div",null,[n[15]||(n[15]=t("span",null,"숙소",-1)),t("strong",null,l(s.value?.accommodationName??"-")+" (#"+l(s.value?.accommodationsId??"-")+")",1)]),t("div",null,[n[16]||(n[16]=t("span",null,"호스트 ID",-1)),t("strong",null,l(s.value?.hostUserId??"-"),1)]),t("div",null,[n[17]||(n[17]=t("span",null,"게스트",-1)),t("strong",null,"#"+l(s.value?.userId??"-")+" "+l(s.value?.guestEmail??""),1)]),t("div",null,[n[18]||(n[18]=t("span",null,"게스트 연락처",-1)),t("strong",null,l(s.value?.guestPhone??"-"),1)]),t("div",null,[n[19]||(n[19]=t("span",null,"체크인",-1)),t("strong",null,l(c(s.value?.checkin)),1)]),t("div",null,[n[20]||(n[20]=t("span",null,"체크아웃",-1)),t("strong",null,l(c(s.value?.checkout)),1)]),t("div",null,[n[21]||(n[21]=t("span",null,"인원",-1)),t("strong",null,l(s.value?.guestCount??"-"),1)]),t("div",null,[n[22]||(n[22]=t("span",null,"금액",-1)),t("strong",null,l(f(s.value?.finalPaymentAmount)),1)]),t("div",null,[n[23]||(n[23]=t("span",null,"예약 상태",-1)),t("strong",null,l(P(s.value?.reservationStatus,s.value?.paymentStatus)),1)]),t("div",null,[n[24]||(n[24]=t("span",null,"결제 상태",-1)),t("strong",null,l(k(F)(s.value?.paymentStatus)),1)]),t("div",null,[n[25]||(n[25]=t("span",null,"결제 금액",-1)),t("strong",null,l(f(s.value?.approvedAmount??s.value?.finalPaymentAmount)),1)]),t("div",null,[n[26]||(n[26]=t("span",null,"결제일시",-1)),t("strong",null,l(c(s.value?.approvedAt)),1)]),t("div",null,[n[27]||(n[27]=t("span",null,"환불율",-1)),t("strong",null,l(st.value),1)]),t("div",null,[n[28]||(n[28]=t("span",null,"예상 환불액",-1)),t("strong",null,l(ot.value),1)]),t("div",null,[n[29]||(n[29]=t("span",null,"주문번호",-1)),t("strong",null,l(s.value?.orderId??"-"),1)]),t("div",null,[n[30]||(n[30]=t("span",null,"PG 키",-1)),t("strong",null,l(s.value?.pgPaymentKey??"-"),1)]),t("div",null,[n[31]||(n[31]=t("span",null,"환불 상태",-1)),t("strong",null,l(ut(s.value?.refundStatus)),1)]),t("div",null,[n[32]||(n[32]=t("span",null,"환불 금액",-1)),t("strong",null,l(f(s.value?.refundAmount)),1)]),t("div",null,[n[33]||(n[33]=t("span",null,"환불일시",-1)),t("strong",null,l(c(s.value?.refundApprovedAt)),1)]),t("div",null,[n[34]||(n[34]=t("span",null,"환불 사유",-1)),t("strong",null,l(s.value?.refundReason??"-"),1)]),t("div",null,[n[35]||(n[35]=t("span",null,"생성일",-1)),t("strong",null,l(c(s.value?.createdAt)),1)])])]),t("div",An,[t("p",null,"변경: "+l(j(s.value)),1),t("p",null,"환불: "+l(Y(s.value)),1)])])),x.value?$("",!0):(i(),u("div",In,[t("button",{class:"admin-btn admin-btn--muted",type:"button",disabled:!z(s.value)},"변경",8,xn),t("button",{class:"admin-btn admin-btn--danger",type:"button",disabled:!X(s.value)},"환불",8,Rn)]))])])):$("",!0)]))}},Dn=it(Nn,[["__scopeId","data-v-704f4c9d"]]);export{Dn as default};
