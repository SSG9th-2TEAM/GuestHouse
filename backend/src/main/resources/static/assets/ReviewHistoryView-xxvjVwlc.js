import{_ as D,r as g,b as R,c as o,e as a,p as S,k as U,t as l,F as f,f as v,o as n,d as m,n as x}from"./index-GmEodlcO.js";import{a as F,d as V}from"./reviewApi-Bz8FhJb7.js";const B={class:"review-page container"},P={class:"page-header"},T={key:0,class:"loading-state"},E={key:1,class:"error-state"},H={key:2,class:"empty-state"},L={key:3,class:"review-list"},z={class:"review-top"},Y={class:"info-left"},j=["src"],q={class:"review-info"},G=["onClick"],J={class:"rating-row"},K={class:"stars"},O={class:"date"},Q={class:"review-actions-menu"},W=["onClick"],X={key:0,class:"menu-dropdown"},Z=["onClick"],w=["onClick"],tt={key:0,class:"review-images"},st=["src"],at={class:"review-content"},et={key:1,class:"review-tags"},ot={key:2,class:"host-reply"},nt={class:"reply-content"},ct={key:0,class:"reply-date"},it={__name:"ReviewHistoryView",setup(lt){const _=U(),u=g([]),y=g(!1),p=g(""),h=g(null),C=t=>{h.value=h.value===t?null:t},r=t=>{if(!t)return"";const e=new Date(t);if(Number.isNaN(e.getTime()))return"";const s=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${s}.${i}.${d}`},N=t=>{const s=(Array.isArray(t?.images)?t.images:[]).map(c=>c?.imageUrl??c).filter(c=>typeof c=="string"&&c.trim()),d=(Array.isArray(t?.tags)?t.tags:[]).map(c=>c?.reviewTagName??c?.name??c).filter(c=>typeof c=="string"&&c.trim()),b=Number(t?.rating);return{id:t?.reviewId??t?.id,accommodationId:t?.accommodationsId,accommodationName:t?.accommodationName??"",accommodationImage:t?.accommodationImage,visitDate:t?.visitDate,checkin:t?.checkin,checkout:t?.checkout,rating:Number.isFinite(b)?Math.round(b):0,date:r(t?.createdAt),stayPeriod:t?.checkin&&t?.checkout?`${r(t.checkin)} ~ ${r(t.checkout)}`:t?.visitDate||r(t?.createdAt),content:t?.content??"",images:s,tags:d,replyContent:t?.replyContent??"",replyUpdatedAt:r(t?.replyUpdatedAt)}},k=async()=>{y.value=!0,p.value="";try{const t=await F();u.value=Array.isArray(t)?t.map(N):[]}catch(t){console.error("내 리뷰 조회 실패:",t),p.value=t.message||"리뷰를 불러오는데 실패했습니다.",u.value=[]}finally{y.value=!1}},A=t=>{_.push(`/room/${t}`)},I=t=>{const e=Math.min(Math.max(Number(t)||0,0),5);return"★".repeat(e)+"☆".repeat(5-e)},M=t=>{_.push({name:"write-review",state:{mode:"edit",reservationData:{accommodationId:t.accommodationId,accommodationName:t.accommodationName,dates:t.stayPeriod,image:t.accommodationImage}}})},$=async t=>{if(confirm("정말로 리뷰를 삭제하시겠습니까?"))try{await V(t),await k()}catch(e){console.error("리뷰 삭제 실패:",e),alert(e.message||"리뷰 삭제 중 오류가 발생했습니다.")}};return R(k),(t,e)=>(n(),o("div",B,[a("div",P,[a("button",{class:"back-btn",onClick:e[0]||(e[0]=s=>S(_).back())},"←"),e[1]||(e[1]=a("h1",null,"리뷰 내역",-1))]),y.value?(n(),o("div",T,[...e[2]||(e[2]=[a("p",null,"리뷰를 불러오는 중...",-1)])])):p.value?(n(),o("div",E,[a("p",null,l(p.value),1),a("button",{class:"retry-btn",onClick:k},"다시 시도")])):u.value.length===0?(n(),o("div",H,[...e[3]||(e[3]=[a("div",{class:"empty-icon"},"☆",-1),a("h2",null,"아직 작성한 리뷰가 없어요",-1),a("p",null,"숙소를 이용한 후 리뷰를 남겨보세요.",-1),a("p",null,"다른 여행자들에게 도움이 될 수 있어요.",-1)])])):(n(),o("div",L,[(n(!0),o(f,null,v(u.value,s=>(n(),o("div",{key:s.id,class:"review-card"},[a("div",z,[a("div",Y,[a("img",{src:s.accommodationImage||"https://via.placeholder.com/60",class:"review-thumb"},null,8,j),a("div",q,[a("h3",{class:"acc-name",onClick:i=>A(s.accommodationId)},l(s.accommodationName),9,G),a("div",J,[a("span",K,l(I(s.rating)),1),a("span",O,l(s.stayPeriod),1)])])]),a("div",Q,[a("button",{class:"more-btn",onClick:x(i=>C(s.id),["stop"])},"⋮",8,W),h.value===s.id?(n(),o("div",X,[a("button",{class:"menu-item",onClick:i=>M(s)},"수정",8,Z),a("button",{class:"menu-item delete",onClick:i=>$(s.id)},"삭제",8,w)])):m("",!0)])]),s.images&&s.images.length>0?(n(),o("div",tt,[(n(!0),o(f,null,v(s.images,(i,d)=>(n(),o("img",{key:d,src:i,class:"review-img"},null,8,st))),128))])):m("",!0),a("p",at,l(s.content),1),s.tags&&s.tags.length>0?(n(),o("div",et,[(n(!0),o(f,null,v(s.tags,i=>(n(),o("span",{key:i,class:"tag"},l(i),1))),128))])):m("",!0),s.replyContent?(n(),o("div",ot,[e[4]||(e[4]=a("p",{class:"reply-title"},"호스트 답글",-1)),a("p",nt,l(s.replyContent),1),s.replyUpdatedAt?(n(),o("p",ct,l(s.replyUpdatedAt),1)):m("",!0)])):m("",!0)]))),128))]))]))}},mt=D(it,[["__scopeId","data-v-05f49fd2"]]);export{mt as default};
