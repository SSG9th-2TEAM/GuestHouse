import{_ as Q,r as o,b as Y,k as Z,c as n,e as s,d as U,p as ee,t as f,F as R,f as M,C as L,E as se,M as ae,n as te,z as A,A as z,s as oe,o as i}from"./index-CetC7qP8.js";import{b as le,a as ne,u as ie,c as re}from"./reviewApi-maTNw_lL.js";const ce=[{name:"ì„œë¹„ìŠ¤ Â· ì§ì› ì‘ëŒ€",tagNames:["ì¹œì ˆí•´ìš”","ë§¤ë„ˆíƒ€ì„ì´ ì˜ ì§€ì¼œì ¸ìš”","í”½ì—…ì„œë¹„ìŠ¤ê°€ í¸í•´ìš”","ë£¸ì„œë¹„ìŠ¤ê°€ ì˜ ë˜ì–´ìˆì–´ìš”"]},{name:"ì²­ê²° Â· ìœ„ìƒ",tagNames:["ê¹¨ë—í•´ìš”","í™”ì¥ì‹¤ì´ ì˜ ë˜ì–´ìˆì–´ìš”","ë²Œë ˆ ê±±ì • ì—†ì–´ìš”","ê³µìš©ì‹œì„¤ ê´€ë¦¬ê°€ ì˜ë¼ìš”","ë§¤ì¥ì´ ì²­ê²°í•´ìš”","ì¬ë£Œê°€ ì‹ ì„ í•´ìš”"]},{name:"ê°ì‹¤ Â· ì‹œì„¤ í’ˆì§ˆ",tagNames:["ì¹¨êµ¬ê°€ ì¢‹ì•„ìš”","ë°©ìŒì´ ì˜ë¼ìš”","ëƒ‰ë‚œë°©ì´ ì˜ë¼ìš”","ì „ê¸° ì‚¬ìš©ì´ í¸í•´ìš”","ì˜¨ìˆ˜ê°€ ì˜ ë‚˜ì™€ìš”","ìˆ˜ì˜ì¥ì´ ì˜ ë˜ì–´ìˆì–´ìš”","ê°œìˆ˜ëŒ€ê°€ ì˜ ë˜ì–´ìˆì–´ìš”"]},{name:"í¸ì˜ì‹œì„¤ Â· ì¸í”„ë¼",tagNames:["í¸ì˜ì‹œì„¤ì´ ì˜ ë˜ì–´ìˆì–´ìš”","ì£¼ì°¨í•˜ê¸° í¸í•´ìš”","ëŒ€ì¤‘êµí†µì´ í¸í•´ìš”","ë§ˆíŠ¸ ì´ìš©ì´ í¸í•´ìš”","ê·¼ì²˜ì— ê°ˆ ê³³ì´ ë§ì•„ìš”"]},{name:"ë¶„ìœ„ê¸° Â· ê°ì„±",tagNames:["ì¸í…Œë¦¬ì–´ê°€ ë©‹ì ¸ìš”","ì»¨ì…‰ì´ ë…íŠ¹í•´ìš”","ë·°ê°€ ì¢‹ì•„ìš”","ì‚¬ì§„ì´ ì˜ ë‚˜ì™€ìš”","ì°¨ë¶„í•œ ë¶„ìœ„ê¸°ì—ìš”","ì•„ëŠ‘í•´ìš”","ìˆ™ì†Œê°€ ë„“ì–´ìš”","ì‹ ë‚˜ëŠ” ë¶„ìœ„ê¸°ì—ìš”","ì‚¬ì¥ë‹˜ì´ ì¬ë°Œìœ¼ì„¸ìš”","ì†”ë¡œíƒˆì¶œ í•˜ê¸° ì¢‹ì•„ìš”"]},{name:"ì•¡í‹°ë¹„í‹° Â· ì¦ê¸¸ ê±°ë¦¬",tagNames:["íŒŒí‹°ê°€ ì¬ë°Œì–´ìš”","íŒŒí‹°í•˜ê¸° ì¢‹ì•„ìš”","ì–´ìš¸ë ¤ ë†€ê¸° ì¢‹ì•„ìš”","ì¦ê¸¸ ê±°ë¦¬ê°€ ë§ì•„ìš”","ë¬¼ë†€ì´í•˜ê¸° ì¢‹ì•„ìš”","ë°”ë¹„í í•´ë¨¹ê¸° ì¢‹ì•„ìš”","ë‹¨ì²´ëª¨ì„ í•˜ê¸° ì¢‹ì•„ìš”","í˜¸ìº‰ìŠ¤í•˜ê¸° ì¢‹ì•„ìš”"]}];function ue(_){if(!Array.isArray(_)||_.length===0)return[];const g=new Map(_.map(r=>[r.reviewTagName,r])),c=new Set,d=ce.map(r=>{const x=r.tagNames.map(w=>{const v=g.get(w);return v&&c.add(w),v}).filter(Boolean);return{name:r.name,tags:x}}).filter(r=>r.tags.length>0),b=_.filter(r=>!c.has(r.reviewTagName));return b.length>0&&d.push({name:"ê¸°íƒ€",tags:b}),d.length===0?[{name:"ë¦¬ë·° íƒœê·¸",tags:_}]:d}const de={class:"write-review-page container"},ve={class:"page-header"},me={class:"info-section"},ge={class:"info-row"},pe={class:"value"},fe={class:"info-row"},we={class:"value"},he={class:"rating-section"},_e={class:"stars"},ye=["onClick"],be={class:"content-section"},ke={class:"photo-section"},Te={class:"photo-list"},Ce=["src"],Ie=["onClick"],Re={class:"tags-section"},Me={class:"category-name"},Ne={class:"tags-grid"},xe=["onClick"],De={class:"notice-box"},Se={class:"agree-label"},Ue=["disabled"],Ae={class:"modal-content"},Ee={key:0},Ve={key:1},Be={key:2},Fe={class:"modal-message"},Le={key:1,class:"modal-overlay"},N=5,ze={__name:"WriteReviewView",setup(_){const g=Z();oe();const c=o({accommodationId:null,accommodationName:"ì‚°ì† ë…ì±„ ìˆ™ì†Œ",dates:"2025-11-20 ~ 2025-11-22"}),d=o(!1),b=o(null);Y(async()=>{history.state&&(history.state.reservationData&&(c.value=history.state.reservationData),history.state.mode==="edit"&&(d.value=!0,await x()));try{const a=await le();E.value=ue(a),d.value&&r.value.length>0&&(h.value=[...r.value])}catch(a){console.error("íƒœê·¸ ë¡œë“œ ì‹¤íŒ¨:",a)}});const r=o([]),x=async()=>{try{const e=(await ne()).find(t=>t.accommodationsId===c.value.accommodationId);e?(b.value=e.reviewId,v.value=e.rating,y.value=e.content,e.images&&e.images.length>0&&(p.value=e.images.map(t=>({preview:t.imageUrl,base64:t.imageUrl,isExisting:!0}))),e.tags&&(r.value=e.tags.map(t=>t.reviewTagId)),w.value=!0):u("ë¦¬ë·° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","error",()=>g.back())}catch(a){console.error("ë¦¬ë·° ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",a),u("ë¦¬ë·° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","error")}},w=o(!1),v=o(0),y=o(""),h=o([]),k=o(!1),E=o([]),p=o([]),V=o(null),O=()=>{V.value?.click()},$=a=>new Promise((e,t)=>{const l=new FileReader;l.readAsDataURL(a),l.onload=()=>e(l.result),l.onerror=m=>t(m)}),W=async a=>{const e=a.target.files;if(!e||e.length===0)return;const t=N-p.value.length;if(t<=0){u(`ìµœëŒ€ ${N}ì¥ê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.`,"error");return}const l=Array.from(e).slice(0,t);for(const m of l){if(!m.type.startsWith("image/")){u("ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.","error");continue}if(m.size>5*1024*1024){u("ì´ë¯¸ì§€ í¬ê¸°ëŠ” 5MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.","error");continue}try{const S=await $(m);p.value.push({file:m,preview:URL.createObjectURL(m),base64:S})}catch(S){console.error("ì´ë¯¸ì§€ ë³€í™˜ ì‹¤íŒ¨:",S)}}a.target.value=""},G=a=>{const e=p.value[a];e.preview&&!e.isExisting&&URL.revokeObjectURL(e.preview),p.value.splice(a,1)},D=o(!1),B=o(""),T=o("info"),C=o(null),I=o(!1),P=()=>{I.value=!1,g.push("/reviews")},j=()=>{I.value=!1,g.push("/coupons")},u=(a,e="info",t=null)=>{B.value=a,T.value=e,C.value=t,D.value=!0},F=()=>{D.value=!1,C.value&&(C.value(),C.value=null)},X=a=>{const e=h.value.indexOf(a);e===-1?h.value.push(a):h.value.splice(e,1)},q=a=>h.value.includes(a),H=a=>{v.value=a},J=()=>{const e=(c.value.dates||"").split(" ~ ")[0];return e?e.replace(/\./g,"-"):new Date().toISOString().split("T")[0]},K=async()=>{if(!w.value){u("ë¦¬ë·° ì‘ì„±ì— ë™ì˜í•´ì£¼ì„¸ìš”.","error");return}if(v.value===0){u("ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.","error");return}if(!y.value.trim()){u("ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.","error");return}if(!c.value.accommodationId){u("ìˆ™ì†Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.","error");return}k.value=!0;try{const a=p.value.map(e=>e.base64);if(d.value){const e={content:y.value.trim(),imageUrls:a,rating:v.value,tagIds:h.value};await ie(b.value,e),u("ë¦¬ë·°ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!","success",()=>g.push("/reviews"))}else{const e={accommodationsId:c.value.accommodationId,rating:v.value,content:y.value.trim(),visitDate:J(),tagIds:h.value,imageUrls:a},t=await re(e);t&&t.couponIssued?I.value=!0:u("ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!","success",()=>g.push("/reviews"))}}catch(a){console.error("ë¦¬ë·° ì „ì†¡ ì‹¤íŒ¨:",a),u(a.message||"ë¦¬ë·° ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","error")}finally{k.value=!1}};return(a,e)=>(i(),n("div",de,[s("div",ve,[s("button",{class:"back-btn",onClick:e[0]||(e[0]=t=>ee(g).back())},"â†"),s("h1",null,f(d.value?"ë¦¬ë·° ìˆ˜ì •":"ë¦¬ë·° ì‘ì„±"),1)]),s("div",me,[s("div",ge,[e[3]||(e[3]=s("span",{class:"label"},"ìˆ™ì†Œ ì´ë¦„:",-1)),s("span",pe,f(c.value.accommodationName||c.value.title),1)]),s("div",fe,[e[4]||(e[4]=s("span",{class:"label"},"ì²´í¬ì¸/ì•„ì›ƒ:",-1)),s("span",we,f(c.value.dates||c.value.date),1)])]),s("div",he,[e[5]||(e[5]=s("span",{class:"label"},"ë³„ì :",-1)),s("div",_e,[(i(),n(R,null,M(5,t=>s("span",{key:t,class:A(["star",{active:t<=v.value}]),onClick:l=>H(t)},"â˜…",10,ye)),64))])]),s("div",be,[e[6]||(e[6]=s("label",{class:"label"},"ë¦¬ë·° ë‚´ìš©:",-1)),L(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),placeholder:"ìˆ™ì†Œì— ëŒ€í•œ ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”."},null,512),[[se,y.value]])]),s("div",ke,[s("span",{class:"label"},"ì‚¬ì§„ ì²¨ë¶€ (ìµœëŒ€ "+f(N)+"ì¥)"),s("div",Te,[(i(!0),n(R,null,M(p.value,(t,l)=>(i(),n("div",{key:l,class:"photo-item"},[s("img",{src:t.preview,alt:"ë¦¬ë·° ì´ë¯¸ì§€"},null,8,Ce),s("button",{class:"remove-btn",onClick:m=>G(l)},"Ã—",8,Ie)]))),128)),p.value.length<N?(i(),n("div",{key:0,class:"photo-placeholder",onClick:O},[...e[7]||(e[7]=[s("span",{class:"plus-icon"},"+",-1),s("span",{class:"add-text"},"ì‚¬ì§„ ì¶”ê°€",-1)])])):U("",!0)]),s("input",{ref_key:"fileInput",ref:V,type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:W},null,544)]),s("div",Re,[e[8]||(e[8]=s("span",{class:"section-title"},"ë¦¬ë·° íƒœê·¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”",-1)),(i(!0),n(R,null,M(E.value,t=>(i(),n("div",{key:t.name,class:"tag-category"},[s("h3",Me,f(t.name),1),s("div",Ne,[(i(!0),n(R,null,M(t.tags,l=>(i(),n("button",{key:l.reviewTagId,class:A(["tag-btn",{selected:q(l.reviewTagId)}]),onClick:m=>X(l.reviewTagId)},f(l.reviewTagName),11,xe))),128))])]))),128))]),s("div",De,[e[10]||(e[10]=s("h3",null,"ë¦¬ë·° ì‘ì„± ì „ í™•ì¸í•´ ì£¼ì„¸ìš”.",-1)),e[11]||(e[11]=s("ul",null,[s("li",null,"ê°œì¸ì •ë³´(ì‹¤ëª…, ì–¼êµ´ì‚¬ì§„ ë“±)ì™€ í—ˆìœ„Â·ë¹„ë°© ë‚´ìš©ì€ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),s("li",null,"ë¦¬ë·°ì™€ ì‚¬ì§„ì€ ì„œë¹„ìŠ¤ ë…¸ì¶œ ë° ìš´ì˜ ëª©ì ì— í™œìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."),s("li",null,"ë¶€ì • ë¦¬ë·°(ë³´ìƒ ëª©ì , ë°©ë¬¸ ì´ë ¥ ì—†ìŒ ë“±)ëŠ” ì œí•œë˜ë©° ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")],-1)),s("label",Se,[L(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t)},null,512),[[ae,w.value]]),e[9]||(e[9]=s("span",null,"ìœ„ ë‚´ìš©ì„ í™•ì¸í•˜ê³  ë¦¬ë·° ì‘ì„±ì— ë™ì˜í•©ë‹ˆë‹¤.",-1))])]),s("button",{class:"submit-btn",onClick:K,disabled:k.value},f(k.value?d.value?"ìˆ˜ì • ì¤‘...":"ë“±ë¡ ì¤‘...":d.value?"ë¦¬ë·° ìˆ˜ì •":"ë¦¬ë·° ì œì¶œ"),9,Ue),D.value?(i(),n("div",{key:0,class:"modal-overlay",onClick:te(F,["self"])},[s("div",Ae,[s("div",{class:A(["modal-icon",T.value])},[T.value==="success"?(i(),n("span",Ee,"âœ“")):T.value==="error"?(i(),n("span",Ve,"!")):(i(),n("span",Be,"i"))],2),s("p",Fe,f(B.value),1),s("button",{class:"modal-btn",onClick:F},"í™•ì¸")])])):U("",!0),I.value?(i(),n("div",Le,[s("div",{class:"coupon-modal-content"},[s("button",{class:"coupon-modal-close",onClick:P},"Ã—"),e[12]||(e[12]=s("div",{class:"coupon-modal-icon"},[s("span",null,"ğŸ‰")],-1)),e[13]||(e[13]=s("h2",{class:"coupon-modal-title"},"ì¿ í°ì´ ë°œê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!",-1)),e[14]||(e[14]=s("p",{class:"coupon-modal-message"},[z("ë¦¬ë·° ì‘ì„± ê°ì‚¬ ì¿ í°ì´ ë°œê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤."),s("br"),z("ì¿ í°í•¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”!")],-1)),s("button",{class:"coupon-modal-btn",onClick:j},"ì¿ í°í•¨ìœ¼ë¡œ ê°€ê¸°")])])):U("",!0)]))}},We=Q(ze,[["__scopeId","data-v-cc2e449e"]]);export{We as default};
