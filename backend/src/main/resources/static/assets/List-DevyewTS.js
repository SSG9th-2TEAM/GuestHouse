import{G as H}from"./GuesthouseCard-BTGTWKN_.js";import{F as J}from"./FilterModal-Dkq1De7G.js";import{_ as X,u as Y,r as l,q as B,b as ee,s as te,v as W,x as se,y as S,c as u,e as o,d as T,m as re,t as ae,z as oe,F as ne,f as le,p as g,k as ie,o as i,l as ue,i as ce}from"./index-B9EiY-js.js";import{s as de}from"./list-CI8o55QH.js";import{u as pe}from"./useListingFilters-D332_I9b.js";import{f as ve,r as fe,a as ye}from"./wishlist-CRixwXBP.js";import"./theme-4T4Q2fdr.js";const me={class:"container main-content"},ge={class:"header"},he={key:0},we={key:1},ke={key:0,class:"list-container"},xe={key:1,class:"empty-state"},_e={key:0,class:"load-more-status"},be=16,Ce={__name:"List",setup(Fe){const A=ie(),a=te(),r=Y(),{applyRouteFilters:V,buildFilterQuery:z}=pe(),h=l([]),c=l(new Set),w=l(0),P=l(1),O=l(0),p=l(!1),v=l(!1),k=l(null);let f=null;const y=l(!1),D=e=>{const s=e.accommodationsId??e.accommodationId??e.id,t=e.accommodationsName??e.accommodationName??e.title??"",n=e.shortDescription??e.description??"",N=e.rating??null,C=e.reviewCount??e.review_count??null,F=[e.city,e.district,e.township].filter(Boolean).join(" "),d=Number(e.minPrice??e.price??0),m=e.imageUrl||"https://placehold.co/400x300",L=Number(e.maxGuests??e.capacity??e.maxGuest??0),q=Number.isFinite(L)?L:0;return{id:s,title:t,description:n,rating:N,reviewCount:C,location:F,price:d,imageUrl:m,maxGuests:q}},E=()=>{const e=a.query.keyword;return Array.isArray(e)?e[0]??"":e??""},R=()=>{const e=E();e!==r.keyword&&r.setKeyword(e)},K=async()=>{try{const e=await ve();e.status===200&&Array.isArray(e.data)&&(c.value=new Set(e.data))}catch(e){console.error("Failed to load wishlist",e)}},U=async e=>{if(!ce()){confirm(`ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ìž…ë‹ˆë‹¤.
ë¡œê·¸ì¸ íŽ˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)&&A.push("/login");return}if(c.value.has(e)){c.value.delete(e);try{await fe(e)}catch(t){c.value.add(e),console.error(t)}}else{c.value.add(e);try{await ye(e)}catch(t){c.value.delete(e),console.error(t)}}},x=async({themeIds:e=r.themeIds,keyword:s=r.keyword,checkin:t=r.startDate,checkout:n=r.endDate,guestCount:N=r.guestCount,page:C=0,reset:F=!1}={})=>{if(!(p.value||v.value)){F?(p.value=!0,w.value=0):v.value=!0;try{const d=await de({themeIds:e,keyword:s,checkin:t,checkout:n,guestCount:N,page:C,size:be});if(d.ok){const m=d.data,q=(Array.isArray(m?.items)?m.items:[]).map(D);F?h.value=q:h.value=[...h.value,...q];const I=m?.page;I&&(w.value=I.number??C,P.value=I.totalPages??P.value,O.value=I.totalElements??0)}else console.error("Failed to load list",d.status)}catch(d){console.error("Failed to load list",d)}finally{p.value=!1,v.value=!1}}},_=B(()=>{const e=r.minPrice,s=r.maxPrice,t=r.guestCount;return h.value.filter(n=>!(e!==null&&n.price<e||s!==null&&n.price>s||t>0&&n.maxGuests<t))}),$=({min:e,max:s,themeIds:t=[],guestCount:n=1})=>{r.setPriceRange(e,s),r.setThemeIds(t),r.setGuestCount(n),y.value=!1,x({themeIds:t,reset:!0})},j=()=>{A.push({path:"/map",query:z()})},b=B(()=>w.value+1<P.value),Q=()=>{if(!b.value||p.value||v.value)return;const e=w.value+1;x({page:e})},M=()=>{f&&(f.disconnect(),f=null)},Z=()=>{typeof window>"u"||!("IntersectionObserver"in window)||(M(),f=new IntersectionObserver(e=>{e.length&&e[0].isIntersecting&&Q()},{root:null,rootMargin:"200px",threshold:.1}),k.value&&f.observe(k.value))},G=async()=>{if(!b.value){M();return}await W(),Z()};return ee(async()=>{K(),V(a.query),R(),x({reset:!0}),await W(),G()}),se(()=>{M()}),S(()=>[a.query.keyword,a.query.themeIds,a.query.min,a.query.max,a.query.minPrice,a.query.maxPrice,a.query.guestCount,a.query.checkin,a.query.checkout],()=>{V(a.query),R(),x({reset:!0})}),S(()=>b.value,()=>{G()}),S(()=>k.value,()=>{G()}),(e,s)=>(i(),u("main",me,[o("div",ge,[_.value.length>0?(i(),u("h1",he,"ê²€ìƒ‰ê²°ê³¼ "+ae(O.value)+"ê±´",1)):(i(),u("h1",we,"ìˆ™ì†Œ ëª©ë¡")),o("button",{class:"filter-btn",onClick:s[0]||(s[0]=t=>y.value=!y.value)},[...s[2]||(s[2]=[o("span",{class:"icon"},"ðŸ”",-1),oe("í•„í„°",-1)])])]),_.value.length>0?(i(),u("div",ke,[(i(!0),u(ne,null,le(_.value,t=>(i(),ue(H,{key:t.id,id:t.id,title:t.title,description:t.description,rating:t.rating,"review-count":t.reviewCount,location:t.location,price:t.price,"image-url":t.imageUrl,"is-favorite":c.value.has(t.id),onToggleFavorite:U,onClick:n=>g(A).push(`/room/${t.id}`),class:"list-item"},null,8,["id","title","description","rating","review-count","location","price","image-url","is-favorite","onClick"]))),128))])):!p.value&&_.value.length===0?(i(),u("div",xe,[...s[3]||(s[3]=[o("div",{class:"empty-icon-wrapper"},[o("span",{class:"empty-icon"},"ðŸ§")],-1),o("h2",{class:"empty-title"},"ì¡°ê±´ì— ë§žëŠ” ìˆ™ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”",-1),o("p",{class:"empty-description"},[o("span",null,"ì ìš©í•œ í•„í„°ë¥¼ ë³€ê²½í•˜ê±°ë‚˜"),o("span",null,"ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.")],-1)])])):T("",!0),b.value?(i(),u("div",{key:2,ref_key:"loadMoreTrigger",ref:k,class:"list-footer list-footer--observer"},[v.value?(i(),u("span",_e,"ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...")):T("",!0)],512)):T("",!0),o("div",{class:"map-btn-wrapper"},[o("button",{class:"map-floating-btn",onClick:j},[...s[4]||(s[4]=[o("span",{class:"text"},"ì§€ë„ì—ì„œ ë³´ê¸°",-1)])])]),re(J,{"is-open":y.value,"current-min":g(r).minPrice,"current-max":g(r).maxPrice,"current-themes":g(r).themeIds,"current-guest-count":g(r).guestCount,onClose:s[1]||(s[1]=t=>y.value=!1),onApply:$},null,8,["is-open","current-min","current-max","current-themes","current-guest-count"])]))}},Le=X(Ce,[["__scopeId","data-v-a66f3f6f"]]);export{Le as default};
