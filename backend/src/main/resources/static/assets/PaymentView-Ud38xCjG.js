const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/reservationApi-Dgi-lN1d.js","assets/index-B9EiY-js.js","assets/index-CMHUjmj9.css"])))=>i.map(i=>d[i]);
import{_ as h,q as R,s as b,r,b as I,c as d,e,d as y,t as n,j as T,k as N,o as v}from"./index-B9EiY-js.js";import{getReservation as $}from"./reservationApi-Dgi-lN1d.js";import{g as A}from"./userClient-B8pl-uCw.js";const C={class:"payment-page"},S={key:0,class:"container"},U={key:0,class:"reservation-summary"},D={class:"info-row"},K={class:"info-row"},L={class:"info-row"},M={class:"info-row"},x={class:"info-row"},O={class:"info-row"},V={class:"info-row total"},B={key:1,class:"error-message"},W={class:"payment-action"},j=["disabled"],q={key:1,class:"loading"},G="test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm",z={__name:"PaymentView",setup(F){const w=N(),g=b(),l=R(()=>g.params.reservationId),a=r(null),u=r(null),p=r(!0),c=r(!1),o=r(""),i=r(null);r(null);const _=()=>{const s=Date.now();return`ORDER_${l.value}_${s}`};I(async()=>{try{a.value=await $(l.value);const s=await A();s.ok&&s.data&&(u.value=s.data),await f(),P()}catch(s){console.error("초기화 실패:",s),o.value="결제 페이지를 불러오는데 실패했습니다."}finally{p.value=!1}});const f=()=>new Promise((s,t)=>{if(window.TossPayments){s();return}const m=document.createElement("script");m.src="https://js.tosspayments.com/v2/standard",m.onload=s,m.onerror=t,document.head.appendChild(m)}),P=async()=>{try{const s=window.TossPayments(G);i.value=s.widgets({customerKey:`CUSTOMER_${a.value.userId||"GUEST"}`}),await i.value.setAmount({currency:"KRW",value:a.value.finalPaymentAmount}),await i.value.renderPaymentMethods({selector:"#payment-method",variantKey:"DEFAULT"}),await i.value.renderAgreement({selector:"#agreement",variantKey:"AGREEMENT"})}catch(s){console.error("위젯 초기화 실패:",s),o.value="결제 위젯을 불러오는데 실패했습니다."}},k=async()=>{if(!i.value){o.value="결제 위젯이 초기화되지 않았습니다.";return}c.value=!0,o.value="";try{const s=_();await i.value.requestPayment({orderId:s,orderName:`${a.value.accommodationName||"게스트하우스"} 예약`,successUrl:`${window.location.origin}/payment/success?reservationId=${l.value}`,failUrl:`${window.location.origin}/payment/fail?reservationId=${l.value}`,customerEmail:u.value?.email||"guest@example.com",customerName:u.value?.email||a.value.reserverName||"예약자",customerMobilePhone:u.value?.phone?.replace(/-/g,"")||"01000000000"})}catch(s){console.error("결제 요청 실패:",s),o.value=s.message||"결제 요청에 실패했습니다."}finally{c.value=!1}},E=async()=>{if(l.value&&a.value?.reservationStatus===0)try{const{deletePendingReservation:s}=await T(async()=>{const{deletePendingReservation:t}=await import("./reservationApi-Dgi-lN1d.js");return{deletePendingReservation:t}},__vite__mapDeps([0,1,2]));await s(l.value)}catch(s){console.error("대기 예약 삭제 실패:",s)}w.back()};return(s,t)=>(v(),d("div",C,[e("header",{class:"header"},[e("button",{class:"icon-btn",onClick:E},"←"),t[0]||(t[0]=e("h1",null,"결제하기",-1))]),p.value?(v(),d("div",q,[...t[11]||(t[11]=[e("p",null,"결제 페이지를 불러오는 중...",-1)])])):(v(),d("div",S,[a.value?(v(),d("div",U,[t[8]||(t[8]=e("h3",null,"예약 정보",-1)),e("div",D,[t[1]||(t[1]=e("span",null,"체크인",-1)),e("span",null,n(a.value.checkin?.split("T")[0]),1)]),e("div",K,[t[2]||(t[2]=e("span",null,"체크아웃",-1)),e("span",null,n(a.value.checkout?.split("T")[0]),1)]),e("div",L,[t[3]||(t[3]=e("span",null,"숙박",-1)),e("span",null,n(a.value.stayNights)+"박",1)]),e("div",M,[t[4]||(t[4]=e("span",null,"인원",-1)),e("span",null,n(a.value.guestCount)+"명",1)]),t[9]||(t[9]=e("div",{class:"divider"},null,-1)),e("div",x,[t[5]||(t[5]=e("span",null,"예약자 이름",-1)),e("span",null,n(a.value.reserverName||"-"),1)]),e("div",O,[t[6]||(t[6]=e("span",null,"예약자 연락처",-1)),e("span",null,n(u.value?.phone||a.value.reserverPhone||"-"),1)]),e("div",V,[t[7]||(t[7]=e("span",null,"결제 금액",-1)),e("span",null,"₩"+n(a.value.finalPaymentAmount?.toLocaleString()),1)])])):y("",!0),t[10]||(t[10]=e("div",{class:"payment-widget-container"},[e("div",{id:"payment-method"}),e("div",{id:"agreement"})],-1)),o.value?(v(),d("div",B,n(o.value),1)):y("",!0),e("div",W,[e("button",{class:"pay-btn",disabled:c.value,onClick:k},n(c.value?"처리 중...":`₩${a.value?.finalPaymentAmount?.toLocaleString()} 결제하기`),9,j)])]))]))}},X=h(z,[["__scopeId","data-v-c79191be"]]);export{X as default};
