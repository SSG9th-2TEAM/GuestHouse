import{_ as z,r as c,b as A,x as F,c as s,e as o,p as N,k as B,t as i,F as P,f as R,o as a,z as H,d as E,G as Y}from"./index-CMhx5Eqk.js";import{g as j,a as q,i as G}from"./couponApi-DkwWg2ZM.js";const U={class:"event-page container"},J={class:"page-header"},K={class:"coupon-section"},O={class:"section-header"},Q={key:0,class:"coupon-state"},W={key:1,class:"coupon-state error"},X={key:2,class:"coupon-state empty"},Z={key:3,class:"coupon-grid"},tt={class:"coupon-body"},et={class:"coupon-chip-group"},nt={key:0,class:"coupon-chip coupon-chip--flash"},ot={class:"coupon-meta"},st={class:"coupon-card__footer"},at=["disabled","onClick"],lt={key:0},rt={key:1},ct={key:2},it={key:0,class:"flash-countdown"},d="DAILY_FLASH50",ut={__name:"EventView",setup(dt){const I=B(),p=c([]),m=c(!1),v=c(null),y=c("00:00:00"),f=c(null),b=c(new Set),u=c({}),_=t=>t==null?null:String(t),g=async()=>{m.value=!0,v.value=null;try{const t=await j(0),e=(Array.isArray(t)?t:[]).slice().sort((l,r)=>{const h=l.code===d?-1:0,D=r.code===d?-1:0;return h!==D?h-D:0});p.value=e}catch(t){console.error("쿠폰 데이터 조회 실패:",t),p.value=[],v.value=t?.message||"쿠폰을 불러오지 못했습니다."}finally{m.value=!1}},k=async()=>{try{const t=await q(),n=new Set((t||[]).map(e=>_(e)).filter(e=>e!==null));b.value=n}catch(t){console.error("내 쿠폰 조회 실패:",t)}},w=()=>{f.value&&(clearInterval(f.value),f.value=null)},$=()=>{w(),f.value=setInterval(M,1e3)},M=async()=>{const t=new Date,n=new Date(t);n.setHours(24,0,0,0);const e=n.getTime()-t.getTime();if(e<=0){y.value="00:00:00",w(),await g(),await k(),$();return}const l=Math.floor(e/(1e3*60*60)),r=Math.floor(e%(1e3*60*60)/(1e3*60)),h=Math.floor(e%(1e3*60)/1e3);y.value=[String(l).padStart(2,"0"),String(r).padStart(2,"0"),String(h).padStart(2,"0")].join(":")},C=t=>{const n=_(t);return!!(n&&u.value[n])},S=t=>{const n=_(t);return n?b.value.has(n):!1},x=async t=>{if(!Y()){alert("로그인이 필요한 서비스입니다."),I.push({path:"/login",query:{redirect:"/events"}});return}if(!t?.couponId||C(t.couponId)||S(t.couponId))return;const n=_(t.couponId);u.value={...u.value,[n]:!0};try{await G(t.couponId),await k(),alert("쿠폰이 발급되었습니다. 쿠폰함에서 확인하세요.")}catch(e){const l=e?.message||"쿠폰 발급에 실패했습니다.";alert(l)}finally{const e={...u.value};delete e[n],u.value=e}},L=t=>t.discountType==="PERCENT"?`${t.discountValue??0}% 할인`:`${(t.discountValue??0).toLocaleString()}원 할인`,T=t=>!t||Number(t)===0?"제한 없음":`${Number(t).toLocaleString()}원 이상 사용 시`,V=(t,n)=>{if(!t&&!n)return"상시 진행";const e=l=>{const r=new Date(l);return`${r.getFullYear()}.${String(r.getMonth()+1).padStart(2,"0")}.${String(r.getDate()).padStart(2,"0")}`};return t&&n?`${e(t)} ~ ${e(n)}`:n?`${e(n)}까지`:"상시 진행"};return A(async()=>{await g(),await k(),await M(),$()}),F(()=>{w()}),(t,n)=>(a(),s("div",U,[o("div",J,[o("button",{class:"back-btn",onClick:n[0]||(n[0]=e=>t.$router.back())},"←"),n[2]||(n[2]=o("div",null,[o("h1",null,"이벤트 & 프로모션"),o("p",null,"지금이곳에서 진행 중인 다양한 혜택을 한눈에 확인해보세요.")],-1))]),o("section",K,[o("div",O,[n[3]||(n[3]=o("div",null,[o("h2",null,"지금 다운로드 가능한 쿠폰"),o("p",null,"사이트 공용 쿠폰은 모든 숙소에서 사용할 수 있어요.")],-1)),o("button",{class:"link-btn",onClick:n[1]||(n[1]=e=>N(I).push("/coupons"))}," 내 쿠폰함으로 이동 ")]),m.value?(a(),s("div",Q," 쿠폰을 불러오는 중입니다... ")):v.value?(a(),s("div",W,[o("p",null,i(v.value),1),o("button",{onClick:g},"다시 시도")])):p.value.length===0?(a(),s("div",X," 현재 다운로드 가능한 쿠폰이 없습니다. 잠시 후 다시 확인해주세요. ")):(a(),s("div",Z,[(a(!0),s(P,null,R(p.value,e=>(a(),s("article",{key:e.couponId,class:H(["coupon-card",{"coupon-card--flash":e.code===d}])},[o("div",tt,[o("div",et,[n[4]||(n[4]=o("span",{class:"coupon-chip"},"다운로드형 쿠폰",-1)),e.code===d?(a(),s("span",nt," 선착순 50장 ")):E("",!0)]),o("h3",null,i(e.name),1),o("p",null,i(e.description||"상세 설명이 제공되지 않은 쿠폰입니다."),1),o("ul",ot,[o("li",null,i(L(e)),1),o("li",null,i(T(e.minPrice)),1),o("li",null,i(V(e.validFrom,e.validTo)),1)])]),o("div",st,[o("button",{class:"coupon-cta",disabled:C(e.couponId)||S(e.couponId),onClick:l=>x(e)},[S(e.couponId)?(a(),s("span",lt,"발급 완료")):C(e.couponId)?(a(),s("span",rt,"발급 중...")):(a(),s("span",ct,"즉시 발급"))],8,at),e.code===d?(a(),s("span",it," 리셋 "+i(y.value),1)):E("",!0)])],2))),128))]))])]))}},ft=z(ut,[["__scopeId","data-v-f7fbe614"]]);export{ft as default};
