import{_ as j,q as p,r as f,y as Z,c as o,e,d as y,w as de,D as Se,n as Q,F as $,f as R,t as r,o as a,z as ne,A as Y,b as Re,v as lt,a as Me,u as it,s as rt,x as ct,l as ut,m as ie,p as re,k as dt,i as vt}from"./index-Br9ce33d.js";import{u as mt}from"./useListingFilters-B-WPBZ4G.js";import{f as gt}from"./theme-CkU94YWc.js";import{f as pt,a as ht}from"./accommodation-B0CbHFXA.js";import{g as yt}from"./reviewApi-BD903SOn.js";import{g as kt,a as xe,i as ft}from"./couponApi-FW6EOuf0.js";const _t={class:"image-grid"},bt={class:"sub-imgs"},wt=["onClick","onKeydown"],Dt={class:"image-modal-body"},Ct=["src","alt"],It={class:"image-modal-caption"},$t="https://placehold.co/800x600",St={__name:"ImageGallery",props:{images:{type:Array,default:()=>[]},name:{type:String,default:""}},setup(G){const b=G,i=p(()=>{const I=Array.isArray(b.images)?b.images.filter(Boolean):[];return I.length?I:[$t]}),l=p(()=>i.value.slice(1,5)),S=f(!1),D=f(0),K=p(()=>i.value[D.value]||i.value[0]),E=I=>{const N=Math.max(0,i.value.length-1);D.value=Math.min(Math.max(I,0),N),S.value=!0},F=()=>{S.value=!1},q=()=>{const I=i.value.length;I&&(D.value=(D.value-1+I)%I)},P=()=>{const I=i.value.length;I&&(D.value=(D.value+1)%I)};return Z(()=>b.images,()=>{D.value=0,S.value=!1}),(I,N)=>(a(),o($,null,[e("section",_t,[e("div",{class:"main-img",style:Se({backgroundImage:`url(${i.value[0]})`}),role:"button",tabindex:"0",onClick:N[0]||(N[0]=U=>E(0)),onKeydown:N[1]||(N[1]=de(Q(U=>E(0),["prevent"]),["enter"]))},null,36),e("div",bt,[(a(!0),o($,null,R(l.value,(U,z)=>(a(),o("div",{key:`sub-${z}`,class:"sub-img",style:Se({backgroundImage:`url(${U})`}),role:"button",tabindex:"0",onClick:C=>E(z+1),onKeydown:de(Q(C=>E(z+1),["prevent"]),["enter"])},null,44,wt))),128))])]),S.value?(a(),o("div",{key:0,class:"image-modal",onClick:F},[e("div",{class:"image-modal-content",onClick:N[2]||(N[2]=Q(()=>{},["stop"]))},[e("div",{class:"image-modal-header"},[e("button",{type:"button",class:"image-modal-close",onClick:F},"닫기")]),e("div",Dt,[i.value.length>1?(a(),o("button",{key:0,type:"button",class:"image-modal-nav prev",onClick:q,"aria-label":"이전 사진"}," ‹ ")):y("",!0),e("img",{src:K.value,alt:G.name,class:"image-modal-image"},null,8,Ct),i.value.length>1?(a(),o("button",{key:1,type:"button",class:"image-modal-nav next",onClick:P,"aria-label":"다음 사진"}," › ")):y("",!0)]),e("div",It,r(D.value+1)+" / "+r(i.value.length),1)])])):y("",!0)],64))}},Mt=j(St,[["__scopeId","data-v-be3197d2"]]),xt={class:"section reviews-section"},At={key:0,class:"review-tag-summary"},Rt={class:"review-tag-summary-header"},Nt={class:"review-tag-list"},Tt={class:"tag-count"},Et={key:1,class:"review-empty"},Lt={key:2,class:"review-list"},Ft={class:"review-header"},Pt={class:"author"},Bt={class:"date"},qt={class:"stars"},Ut={key:0,class:"review-images"},Vt=["src","onClick","onKeydown"],Gt=["onClick"],zt={key:2,class:"review-tags"},Ht={key:3,class:"review-reply"},Kt={class:"review-reply__content"},Yt={key:0,class:"review-reply__date"},Zt={key:3,class:"review-pagination"},Wt=["disabled"],Qt={class:"review-page-list"},Jt={key:0,class:"review-page-ellipsis"},Xt=["aria-current","onClick"],Ot=["disabled"],jt={class:"image-modal-body"},es=["src","alt"],ts={class:"image-modal-caption"},ce=5,ss={__name:"ReviewSection",props:{reviews:{type:Array,default:()=>[]},name:{type:String,default:""}},setup(G){const b=G,i=f(!1),l=f(1),S=f([]),D=p(()=>{const v=new Map;return b.reviews.forEach(m=>{(Array.isArray(m?.tags)?m.tags:[]).forEach(x=>{if(!x)return;const A=String(x).trim();A&&v.set(A,(v.get(A)||0)+1)})}),Array.from(v.entries()).map(([m,c])=>({name:m,count:c})).sort((m,c)=>c.count-m.count)}),K=p(()=>i.value?D.value:D.value.slice(0,4)),E=p(()=>D.value.length>4),F=p(()=>Math.ceil(b.reviews.length/ce)||1),q=p(()=>{const v=(l.value-1)*ce;return b.reviews.slice(v,v+ce)}),P=p(()=>{const v=F.value,m=l.value;return v<=5?Array.from({length:v},(c,x)=>x+1):m<=2?[1,2,3,"ellipsis",v]:m===3?[1,2,3,4,"ellipsis",v]:m>=v-1?[1,"ellipsis",v-2,v-1,v]:[1,"ellipsis",m-1,m,m+1,"ellipsis",v]}),I=()=>{i.value=!i.value},N=v=>{const m=Math.min(Math.max(v,1),F.value);l.value=m},U=v=>S.value.includes(v),z=v=>{if(U(v)){S.value=S.value.filter(m=>m!==v);return}S.value=[...S.value,v]},C=v=>String(v??"").length>120,w=v=>{const m=Math.min(Math.max(Number(v)||0,0),5);return"★".repeat(m)+"☆".repeat(5-m)},d=f(!1),g=f(0),h=f([]),L=p(()=>h.value[g.value]||""),B=(v,m)=>{const c=Array.isArray(v)?v:[];if(!c.length)return;const x=Math.max(0,c.length-1);h.value=c,g.value=Math.min(Math.max(m,0),x),d.value=!0},V=()=>{d.value=!1},H=()=>{const v=h.value.length;v&&(g.value=(g.value-1+v)%v)},J=()=>{const v=h.value.length;v&&(g.value=(g.value+1)%v)};return Z(()=>b.reviews,()=>{l.value=1,S.value=[],i.value=!1,d.value=!1}),Z(()=>b.reviews.length,()=>{l.value>F.value&&(l.value=F.value)}),(v,m)=>(a(),o($,null,[e("section",xt,[m[4]||(m[4]=e("h2",null,"리뷰",-1)),D.value.length?(a(),o("div",At,[e("div",Rt,[e("div",Nt,[(a(!0),o($,null,R(K.value,c=>(a(),o("span",{key:c.name,class:"tag review-tag summary-tag"},[ne(r(c.name)+" ",1),e("span",Tt,r(c.count),1)]))),128))]),E.value?(a(),o("button",{key:0,type:"button",class:"review-tag-toggle",onClick:I},r(i.value?"접기":"더보기"),1)):y("",!0)])])):y("",!0),G.reviews.length?(a(),o("div",Lt,[(a(!0),o($,null,R(q.value,c=>(a(),o("div",{key:c.id,class:"review-item"},[e("div",Ft,[e("span",Pt,r(c.author),1),e("span",Bt,r(c.date),1)]),e("div",qt,r(w(c.rating)),1),c.images&&c.images.length?(a(),o("div",Ut,[(a(!0),o($,null,R(c.images.slice(0,5),(x,A)=>(a(),o("img",{key:`${c.id}-img-${A}`,src:x,class:"review-img",loading:"lazy",role:"button",tabindex:"0",onClick:ee=>B(c.images,A),onKeydown:de(Q(ee=>B(c.images,A),["prevent"]),["enter"])},null,40,Vt))),128))])):y("",!0),e("p",{class:Y(["review-content",{clamped:!U(c.id)}])},r(c.content),3),C(c.content)?(a(),o("button",{key:1,type:"button",class:"review-content-toggle",onClick:x=>z(c.id)},r(U(c.id)?"접기":"더보기"),9,Gt)):y("",!0),c.tags&&c.tags.length?(a(),o("div",zt,[(a(!0),o($,null,R(c.tags,x=>(a(),o("span",{key:x,class:"tag review-tag"},r(x),1))),128))])):y("",!0),c.replyContent?(a(),o("div",Ht,[m[3]||(m[3]=e("p",{class:"review-reply__title"},"호스트 답글",-1)),e("p",Kt,r(c.replyContent),1),c.replyUpdatedAt?(a(),o("p",Yt,r(c.replyUpdatedAt),1)):y("",!0)])):y("",!0)]))),128))])):(a(),o("p",Et,"작성된 리뷰가 없습니다.")),F.value>1?(a(),o("div",Zt,[e("button",{type:"button",class:"review-page-btn nav",disabled:l.value===1,onClick:m[0]||(m[0]=c=>N(l.value-1))}," 이전 ",8,Wt),e("div",Qt,[(a(!0),o($,null,R(P.value,c=>(a(),o($,{key:`page-${c}`},[c==="ellipsis"?(a(),o("span",Jt,"…")):(a(),o("button",{key:1,type:"button",class:Y(["review-page-btn number",{active:c===l.value}]),"aria-current":c===l.value?"page":null,onClick:x=>N(c)},r(c),11,Xt))],64))),128))]),e("button",{type:"button",class:"review-page-btn nav",disabled:l.value===F.value,onClick:m[1]||(m[1]=c=>N(l.value+1))}," 다음 ",8,Ot)])):y("",!0)]),d.value?(a(),o("div",{key:0,class:"image-modal",onClick:V},[e("div",{class:"image-modal-content",onClick:m[2]||(m[2]=Q(()=>{},["stop"]))},[e("div",{class:"image-modal-header"},[e("button",{type:"button",class:"image-modal-close",onClick:V},"닫기")]),e("div",jt,[h.value.length>1?(a(),o("button",{key:0,type:"button",class:"image-modal-nav prev",onClick:H,"aria-label":"이전 사진"}," ‹ ")):y("",!0),e("img",{src:L.value,alt:G.name,class:"image-modal-image"},null,8,es),h.value.length>1?(a(),o("button",{key:1,type:"button",class:"image-modal-nav next",onClick:J,"aria-label":"다음 사진"}," › ")):y("",!0)]),e("div",ts,r(g.value+1)+" / "+r(h.value.length),1)])])):y("",!0)],64))}},ns=j(ss,[["__scopeId","data-v-b7a245dc"]]),as={class:"section map-section"},os={key:1,class:"map-placeholder"},ls={class:"map-info"},is={__name:"MapSection",props:{latitude:{type:[Number,String],default:null},longitude:{type:[Number,String],default:null},address:{type:String,default:""},transportInfo:{type:String,default:""}},setup(G){const b=G,i=f(null),l=f(!1),S=f(null),D=p(()=>(b.address||"").trim()),K=p(()=>{const C=b.latitude,w=b.longitude;return C==null||w==null||C===""||w===""?!1:Number.isFinite(Number(C))&&Number.isFinite(Number(w))}),E=p(()=>K.value||D.value.length>0),F=p(()=>b.transportInfo||"교통 정보가 없습니다.");let q=null,P=null,I=null;const N=()=>window.kakao?.maps?.load?Promise.resolve():I||(I=new Promise((C,w)=>{const d=()=>{if(window.kakao?.maps?.load){C();return}w(new Error("Kakao map sdk not ready"))};if(window.kakao?.maps){d();return}const g="edff5897f4250925f0de3f4ca22d615f",h=document.createElement("script");h.src=`//dapi.kakao.com/v2/maps/sdk.js?appkey=${g}&libraries=services&autoload=false`,h.async=!0,h.onload=d,h.onerror=w,document.head.appendChild(h)}),I),U=async()=>{const C=b.latitude,w=b.longitude;if(C!=null&&w!=null&&C!==""&&w!==""){const h=Number(C),L=Number(w);if(Number.isFinite(h)&&Number.isFinite(L))return{latitude:h,longitude:L}}if(!D.value)return null;if(S.value)return S.value;if(!window.kakao?.maps?.services?.Geocoder)return null;const d=new window.kakao.maps.services.Geocoder,g=await new Promise(h=>{d.addressSearch(D.value,(L,B)=>{if(B===window.kakao.maps.services.Status.OK&&Array.isArray(L)&&L.length){const V=Number(L[0].y),H=Number(L[0].x);if(Number.isFinite(V)&&Number.isFinite(H)){h({latitude:V,longitude:H});return}}h(null)})});return g&&(S.value=g),g},z=async()=>{if(l.value=!1,!!E.value){try{await N()}catch(C){console.error("Kakao map load failed",C),l.value=!0;return}await lt(),!(!i.value||!window.kakao?.maps?.load)&&window.kakao.maps.load(async()=>{const C=await U();if(!C){l.value=!0;return}const w=new window.kakao.maps.LatLng(C.latitude,C.longitude);!q||typeof q.getContainer=="function"&&q.getContainer()!==i.value?(q=new window.kakao.maps.Map(i.value,{center:w,level:3}),P=new window.kakao.maps.Marker({position:w}),P.setMap(q)):(q.setCenter(w),P?.setPosition(w))})}};return Re(()=>{z()}),Z(()=>[b.latitude,b.longitude,D.value],()=>{S.value=null,z()}),(C,w)=>(a(),o("section",as,[w[1]||(w[1]=e("h2",null,"숙소 위치",-1)),E.value&&!l.value?(a(),o("div",{key:0,ref_key:"kakaoMapRef",ref:i,class:"map-container"},null,512)):(a(),o("div",os,[...w[0]||(w[0]=[e("div",{class:"map-text"},"위치 정보가 없습니다.",-1)])])),e("p",ls,r(F.value),1)]))}},rs=j(is,[["__scopeId","data-v-7b810832"]]),cs={class:"detail-skeleton"},us={class:"skeleton-amenity-section"},ds={class:"skeleton-tags"},vs={class:"skeleton-room-section"},ms={class:"skeleton-room-list"},gs={__name:"DetailSkeleton",setup(G){return(b,i)=>(a(),o("div",cs,[i[4]||(i[4]=Me('<div class="skeleton-gallery shimmer" data-v-3c02c7b7></div><section class="skeleton-info-section" data-v-3c02c7b7><div class="skeleton-title shimmer" data-v-3c02c7b7></div><div class="skeleton-meta" data-v-3c02c7b7><div class="skeleton-rating shimmer" data-v-3c02c7b7></div><div class="skeleton-location shimmer" data-v-3c02c7b7></div></div><div class="skeleton-description" data-v-3c02c7b7><div class="skeleton-text shimmer" data-v-3c02c7b7></div><div class="skeleton-text shimmer" style="width:80%;" data-v-3c02c7b7></div><div class="skeleton-text shimmer" style="width:60%;" data-v-3c02c7b7></div></div></section>',2)),e("section",us,[i[0]||(i[0]=e("div",{class:"skeleton-section-title shimmer"},null,-1)),e("div",ds,[(a(),o($,null,R(5,l=>e("div",{key:l,class:"skeleton-tag shimmer"})),64))])]),i[5]||(i[5]=e("hr",{class:"skeleton-hr"},null,-1)),e("section",vs,[i[2]||(i[2]=e("div",{class:"skeleton-section-title shimmer"},null,-1)),i[3]||(i[3]=e("div",{class:"skeleton-picker shimmer"},null,-1)),e("div",ms,[(a(),o($,null,R(2,l=>e("div",{key:l,class:"skeleton-room-card"},[...i[1]||(i[1]=[Me('<div class="skeleton-room-image shimmer" data-v-3c02c7b7></div><div class="skeleton-room-content" data-v-3c02c7b7><div class="skeleton-room-name shimmer" data-v-3c02c7b7></div><div class="skeleton-room-desc shimmer" data-v-3c02c7b7></div><div class="skeleton-room-price shimmer" data-v-3c02c7b7></div></div>',2)])])),64))])])]))}},ps=j(gs,[["__scopeId","data-v-3c02c7b7"]]),hs={class:"room-detail container"},ys={class:"section info-section"},ks={class:"meta"},fs={class:"rating"},_s={class:"location"},bs={class:"description-row"},ws={key:0,class:"transport-info"},Ds={key:1,class:"contact-info"},Cs={class:"section amenity-section"},Is={class:"tag-list amenity-list"},$s=["innerHTML"],Ss={class:"amenity-text"},Ms={key:0,class:"tag empty"},xs={class:"tag-list theme-tag-list"},As=["src","alt"],Rs={key:1,class:"theme-tag__icon theme-tag__icon--empty"},Ns={class:"theme-tag__label"},Ts={key:0,class:"tag empty"},Es={class:"section extra-info-section"},Ls={class:"info-list"},Fs={class:"info-row"},Ps={class:"info-row"},Bs={class:"info-row"},qs={class:"info-row"},Us=["href","aria-label"],Vs={key:0,viewBox:"0 0 24 24",class:"sns-icon","aria-hidden":"true"},Gs={key:1,viewBox:"0 0 24 24",class:"sns-icon","aria-hidden":"true"},zs={key:2,viewBox:"0 0 24 24",class:"sns-icon","aria-hidden":"true"},Hs={key:3,viewBox:"0 0 24 24",class:"sns-icon","aria-hidden":"true"},Ks={key:4,viewBox:"0 0 24 24",class:"sns-icon","aria-hidden":"true"},Ys={class:"sns-text"},Zs={key:1},Ws={class:"section room-selection"},Qs={class:"room-selection-header"},Js={class:"picker-box"},Xs={class:"picker-row"},Os=["aria-expanded"],js={key:0,class:"calendar-popup"},en={class:"calendar-container"},tn={class:"calendar-month"},sn={class:"calendar-month-title"},nn={class:"calendar-weekdays"},an={class:"calendar-days"},on=["onClick"],ln={class:"calendar-month"},rn={class:"calendar-month-title"},cn={class:"calendar-weekdays"},un={class:"calendar-days"},dn=["onClick"],vn={class:"picker-field"},mn={class:"guest-control"},gn=["disabled"],pn={key:0,class:"room-empty"},hn={key:1,class:"room-list"},yn=["onClick"],kn={class:"room-media"},fn=["src","alt"],_n={key:0,class:"room-unavailable-badge"},bn={class:"room-content"},wn={class:"room-info"},Dn={class:"capacity"},Cn={class:"room-action"},In={class:"price"},$n=["disabled"],Sn={key:2,class:"room-toggle-row"},Mn={class:"bottom-bar"},xn={class:"selection-summary"},An={key:0},Rn={key:1},Nn={key:2,class:"total-price"},Tn=["disabled"],En={key:0,class:"booking-hint"},Ln={class:"modal-content coupon-modal"},Fn={class:"coupon-list-container"},Pn={key:0,class:"coupon-list"},Bn={class:"coupon-info"},qn={class:"coupon-name"},Un={class:"coupon-desc"},Vn={class:"coupon-meta"},Gn={key:0},zn=["disabled","onClick"],Hn={key:1,class:"no-coupon"},ue="https://placehold.co/800x600",Ae="https://picsum.photos/seed/host/100/100",Kn={__name:"RoomDetailView",setup(G){const b=dt(),i=rt(),l=it(),{applyRouteFilters:S}=mt(),D=(n,t=0)=>{const s=Number(n);return Number.isFinite(s)?s:t},K=n=>n?["guestCount","checkin","checkout","checkIn","checkOut","min","max","minPrice","maxPrice","themeIds","keyword"].some(s=>n[s]!==void 0):!1,E=()=>{const n=Number(i.params.id);return Number.isFinite(n)?n:null},F=()=>{const n={},t=i.query.min??i.query.minPrice,s=i.query.max??i.query.maxPrice;return t!==void 0&&(n.min=String(t)),s!==void 0&&(n.max=String(s)),i.query.themeIds&&(n.themeIds=String(i.query.themeIds)),i.query.guestCount&&(n.guestCount=String(i.query.guestCount)),i.query.checkin&&(n.checkin=String(i.query.checkin)),i.query.checkout&&(n.checkout=String(i.query.checkout)),n},q=()=>{if(i.query.from==="map"){b.push({path:"/map",query:F()});return}b.back()},P=(n=null)=>({id:n,name:"",rating:"-",reviewCount:0,address:"",description:"",minPrice:null,checkInTime:"",checkOutTime:"",transportInfo:"",parkingInfo:"",sns:"",phone:"",latitude:null,longitude:null,amenities:[],themes:[],host:{name:"호스트",joined:"",image:Ae},images:[ue],rooms:[],reviews:[]}),I=n=>[n?.city,n?.district,n?.township,n?.addressDetail].filter(Boolean).join(" "),N=(n,t)=>Array.isArray(n)?n.filter(s=>s?.roomStatus===1).map(s=>{const u=D(s?.price??s?.weekendPrice??t,t),k=s?.roomStatus,T=k==null?!0:k===1,M=s?.mainImageUrl||ue,_=M;return{id:s?.roomId??s?.id,name:s?.roomName??s?.name??"",desc:s?.roomDescription??s?.description??"",capacity:D(s?.maxGuests??s?.capacity??0,0),price:u,available:T,imageUrl:M,thumbnailUrl:_}}):[],U=n=>Array.isArray(n?.amenityDetails)?n.amenityDetails.map(t=>({name:t?.amenityName??t?.name??"",icon:t?.amenityIcon??t?.icon??""})).filter(t=>t.name):Array.isArray(n?.amenities)?n.amenities.map(t=>({name:t,icon:""})).filter(t=>t.name):[],z=n=>{if(!n)return"";const t=new Date(n);if(Number.isNaN(t.getTime()))return"";const s=t.getFullYear(),u=String(t.getMonth()+1).padStart(2,"0"),k=String(t.getDate()).padStart(2,"0");return`${s}.${u}.${k}`},C=n=>Array.isArray(n)?n.map(t=>{const s=Number(t?.rating),u=Number.isFinite(s)?Math.round(s):0,T=(Array.isArray(t?.images)?t.images:[]).map(_=>_?.imageUrl??_).filter(_=>typeof _=="string"&&_.trim()),M=Array.isArray(t?.tags)?t.tags:[];return{id:t?.reviewId??t?.id,author:t?.authorName??t?.reviewerEmail??t?.author??"",date:z(t?.createdAt??t?.date),rating:u,content:t?.content??"",image:T[0]??null,images:T,tags:M.map(_=>_?.reviewTagName??_?.name??_).filter(_=>typeof _=="string"&&_.trim())}}):[],w=n=>{const t=Array.isArray(n?.images)?n.images.map(T=>T?.imageUrl).filter(Boolean):[],s=D(n?.minPrice??0,0),u=Number(n?.rating),k=C(n?.reviews);return{id:n?.accommodationsId??null,name:n?.accommodationsName??"",rating:Number.isFinite(u)?u.toFixed(2):"-",reviewCount:D(n?.reviewCount??k.length,0),address:I(n),description:n?.accommodationsDescription??n?.shortDescription??"",minPrice:n?.minPrice??null,checkInTime:n?.checkInTime??"",checkOutTime:n?.checkOutTime??"",transportInfo:n?.transportInfo??"",parkingInfo:n?.parkingInfo??"",sns:n?.sns??"",phone:n?.phone??"",latitude:n?.latitude??null,longitude:n?.longitude??null,amenities:U(n),themes:Array.isArray(n?.themes)?n.themes:[],host:{name:"호스트",joined:"",image:Ae},images:t.length?t:[ue],rooms:N(n?.rooms,s),reviews:k}},d=f(P(E())),g=f(null),h=f(null),L=f(!1),B=f(!1),V=f(!1),H=f(!1),J=f(new Date),v=f(null);let m=0;const c=f([]),x=f(!1),A=f(new Set),ee=f([]),ae=f(!1),te=f(!0),oe=p(()=>!!(g.value&&l.startDate&&l.endDate)),ve=p(()=>!!(l.startDate&&l.endDate)),se=p(()=>{const n=d.value.rooms||[],t=l.guestCount,s=t>0,u=ve.value&&h.value instanceof Set;return n.filter(k=>!(s&&k.capacity<t||u&&!h.value.has(k.id)))}),Ne=p(()=>{const n=se.value;return H.value?n:n.slice(0,4)}),Te=p(()=>se.value.length>4),Ee=p(()=>(ve.value||l.guestCount>0)&&!L.value&&se.value.length===0),me=["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],ge=["일","월","화","수","목","금","토"],X=p(()=>J.value.getFullYear()),O=p(()=>J.value.getMonth()),pe=p(()=>new Date(X.value,O.value+1,1)),he=p(()=>pe.value.getFullYear()),ye=p(()=>pe.value.getMonth()),Le=p(()=>(d.value.description||"").length>120),le=(n,t)=>n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate(),Fe=n=>{if(!l.startDate||!l.endDate)return!1;const t=n.getTime();return t>l.startDate.getTime()&&t<l.endDate.getTime()},Pe=["2024-01-01","2024-02-09","2024-02-10","2024-02-11","2024-02-12","2024-03-01","2024-04-10","2024-05-05","2024-05-06","2024-05-15","2024-06-06","2024-08-15","2024-09-16","2024-09-17","2024-09-18","2024-10-03","2024-10-09","2024-12-25","2025-01-01","2025-01-27","2025-01-28","2025-01-29","2025-01-30","2025-03-01","2025-03-03","2025-05-05","2025-05-06","2025-06-06","2025-08-15","2025-10-03","2025-10-05","2025-10-06","2025-10-07","2025-10-08","2025-10-09","2025-12-25"],Be=n=>{const t=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return Pe.includes(`${t}-${s}-${u}`)},ke=(n,t)=>{const s=new Date(n,t,1),k=new Date(n,t+1,0).getDate(),T=s.getDay(),M=[];for(let _=0;_<T;_+=1)M.push({day:"",isEmpty:!0});for(let _=1;_<=k;_+=1){const W=new Date(n,t,_),$e=W.getDay(),st=l.startDate&&le(W,l.startDate),nt=l.endDate&&le(W,l.endDate),at=Fe(W),ot=l.endDate!==null;M.push({day:_,isEmpty:!1,date:W,isToday:le(W,new Date),isSaturday:$e===6,isSunday:$e===0,isHoliday:Be(W),isStartDate:st,isEndDate:nt,isInRange:at,hasEndDate:ot})}return M},qe=p(()=>ke(X.value,O.value)),Ue=p(()=>ke(he.value,ye.value)),Ve=()=>{B.value=!B.value},Ge=()=>{J.value=new Date(X.value,O.value-1,1)},ze=()=>{J.value=new Date(X.value,O.value+1,1)},fe=n=>{if(n.isEmpty)return;const t=n.date;if(!l.startDate||l.startDate&&l.endDate){l.setStartDate(t),l.setEndDate(null);return}if(t.getTime()<l.startDate.getTime()){l.setEndDate(l.startDate),l.setStartDate(t),B.value=!1;return}l.setEndDate(t),B.value=!1},He=async()=>{const n=E();if(!n){h.value=null;return}if(!l.startDate||!l.endDate){h.value=null;return}const t=++m;L.value=!0;try{const s=await ht(n,{checkin:l.startDate,checkout:l.endDate,guestCount:l.guestCount});if(t!==m)return;s.ok&&Array.isArray(s.data?.availableRoomIds)?h.value=new Set(s.data.availableRoomIds):h.value=new Set}catch(s){console.error("Failed to load room availability",s),t===m&&(h.value=null)}finally{t===m&&(L.value=!1)}},Ke=async()=>{if(!ae.value){ae.value=!0;try{const n=await gt();n.ok&&Array.isArray(n.data)&&(ee.value=n.data)}catch(n){console.error("Failed to load theme catalog",n)}finally{ae.value=!1}}},_e=async()=>{const n=E();if(!n){d.value=P(),te.value=!1;return}te.value=!0,g.value=null,h.value=null,L.value=!1,V.value=!1,H.value=!1,d.value=P(n),A.value=new Set;try{const[t,s,u]=await Promise.all([pt(n),yt(n).catch(()=>[]),kt(n).catch(()=>[])]);if(!t.ok||!t.data){d.value=P(n);return}const k={...t.data,reviews:s};d.value=w(k),c.value=u||[];try{(await xe("ALL")).forEach(M=>{M.couponId&&A.value.add(String(M.couponId))})}catch(T){console.warn("내 쿠폰 목록 조회 실패 (비로그인 상태일 수 있음):",T)}}catch(t){console.error("Failed to load accommodation detail",t),d.value=P(n)}finally{te.value=!1}},Ye=n=>{if(g.value?.id===n?.id){g.value=null;return}g.value=n},be=n=>{if(n==null)return"-";const t=Number(n);return Number.isFinite(t)?t.toLocaleString():"-"},we=n=>{if(!n)return null;const t=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return`${t}-${s}-${u}`},Ze=(n,t)=>{const u=`${n.toLowerCase()} ${String(t).toLowerCase()}`;return u.includes("instagram")||u.includes("insta")||n.includes("인스타")?"instagram":u.includes("blog")||n.includes("블로그")||u.includes("naver")?"blog":u.includes("youtube")||n.includes("유튜브")?"youtube":u.includes("facebook")||n.includes("페이스북")?"facebook":"link"},We=(n,t)=>{if(n==="instagram")return"Instagram";if(n==="blog")return"Blog";if(n==="youtube")return"YouTube";if(n==="facebook")return"Facebook";try{return new URL(t).hostname.replace(/^www\./,"")||"링크"}catch{return"링크"}},Qe=n=>{if(!n)return[];const t=String(n).split(/\r?\n/).map(k=>k.trim()).filter(Boolean),s=[],u=new Set;return t.forEach(k=>{const T=k.match(/https?:\/\/[^\s]+/i);if(!T)return;const M=T[0];if(u.has(M))return;u.add(M);const _=Ze(k,M);s.push({url:M,type:_,label:We(_,M)})}),s},De=p(()=>Qe(d.value.sns)),Je=p(()=>{const n=new Map;return ee.value.forEach(t=>{const s=t?.themeName?String(t.themeName).trim():"";s&&n.set(s,t.themeImageUrl||"")}),n}),Ce=p(()=>{const n=Array.isArray(d.value.themes)?d.value.themes:[],t=Je.value;return n.map(s=>{const u=s==null?"":String(s).trim();return u?{name:u,imageUrl:t.get(u)||""}:null}).filter(Boolean)}),Xe=()=>{l.increaseGuest()},Oe=()=>{l.decreaseGuest()},je=()=>{if(!oe.value)return;const n=d.value.id??E();if(!n)return;if(!vt()){confirm(`로그인 후 예약 가능한 서비스입니다.
로그인 페이지로 이동할까요?`)&&b.push({path:"/login",query:{redirect:i.fullPath}});return}if(l.startDate&&l.endDate){const s=u=>{const k=u.getFullYear(),T=u.getMonth()+1,M=u.getDate();return`${k}년 ${T}월 ${M}일`};`${s(l.startDate)}${s(l.endDate)}`}const t=l.guestCount||1;b.push({path:`/booking/${n}`,query:{roomId:g.value.id,guestCount:t,checkin:we(l.startDate),checkout:we(l.endDate)}})},et=n=>{n.stopPropagation(),v.value?.scrollIntoView&&v.value.scrollIntoView({behavior:"smooth",block:"center"}),B.value=!0},Ie=n=>{n.target.closest(".date-picker-wrapper")||n.target.closest(".booking-hint")||(B.value=!1)},tt=async n=>{const t=String(n.couponId);if(!A.value.has(t)&&confirm(`${n.name}

이 쿠폰을 다운로드 하시겠습니까?`))try{await ft(n.couponId),A.value.add(t),alert("쿠폰이 발급되었습니다. 마이페이지에서 확인하세요!")}catch(s){if(s.message.includes("이미 발급")){A.value.add(t);try{(await xe("ALL")).forEach(k=>{k.couponId&&A.value.add(String(k.couponId))})}catch(u){console.warn("내 쿠폰 목록 조회 실패 (비로그인 상태일 수 있음):",u)}}alert(s.message)}};return Re(()=>{Ke(),_e(),K(i.query)&&S(i.query),document.addEventListener("click",Ie)}),ct(()=>{document.removeEventListener("click",Ie)}),Z(()=>i.params.id,_e),Z(()=>i.query,n=>{K(n)&&S(n)}),Z(()=>[i.params.id,l.startDate,l.endDate,l.guestCount],()=>{He()},{immediate:!0}),Z(se,n=>{if(!g.value)return;n.some(s=>s.id===g.value.id)||(g.value=null)}),(n,t)=>(a(),o("div",hs,[e("div",{class:"detail-header"},[e("button",{class:"back-btn",onClick:q},"← 뒤로가기")]),te.value?(a(),ut(ps,{key:0})):(a(),o($,{key:1},[ie(Mt,{images:d.value.images,name:d.value.name},null,8,["images","name"]),e("section",ys,[e("h1",null,r(d.value.name),1),e("div",ks,[e("span",fs,"★ "+r(d.value.rating)+" (리뷰 "+r(d.value.reviewCount)+"개)",1),e("span",_s,r(d.value.address),1)]),e("div",bs,[e("p",{class:Y(["description",{"description-clamped":!V.value}])},r(d.value.description),3),Le.value?(a(),o("button",{key:0,type:"button",class:"more-btn",onClick:t[0]||(t[0]=s=>V.value=!V.value)},r(V.value?"접기":"더보기"),1)):y("",!0)]),d.value.transportInfo?(a(),o("div",ws,[t[6]||(t[6]=e("h3",{class:"info-title"},[e("span",{class:"info-icon","aria-hidden":"true"},[e("svg",{viewBox:"0 0 24 24"},[e("path",{d:"M4 11.5v6.3c0 .9.7 1.7 1.6 1.7h.7v1.1c0 .6.5 1.1 1.1 1.1s1.1-.5 1.1-1.1v-1.1h7.1v1.1c0 .6.5 1.1 1.1 1.1s1.1-.5 1.1-1.1v-1.1h.7c.9 0 1.6-.7 1.6-1.7v-6.3c0-2.5-2-4.5-4.5-4.5h-6.1c-2.5 0-4.5 2-4.5 4.5Zm12.1-2.6c1.5 0 2.7 1.2 2.7 2.6v.3H5.2v-.3c0-1.5 1.2-2.6 2.7-2.6h8.2Zm-9.6 7.4c-.5 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1Zm11.1 0c-.5 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1Z"})])]),ne(" 교통 정보 ")],-1)),e("p",null,r(d.value.transportInfo),1)])):y("",!0),d.value.phone?(a(),o("div",Ds,[t[7]||(t[7]=e("h3",{class:"info-title"},[e("span",{class:"info-icon","aria-hidden":"true"},[e("svg",{viewBox:"0 0 24 24"},[e("path",{d:"M6.6 3.5c.5-.4 1.2-.4 1.7 0l2 1.7c.6.5.7 1.4.3 2.1l-1 1.8c-.2.4-.2.9.1 1.3 1 1.6 2.4 3 4 4 .4.2.9.3 1.3.1l1.8-1c.7-.4 1.6-.3 2.1.3l1.7 2c.4.5.4 1.2 0 1.7l-1.3 1.5c-.5.6-1.2.9-2 .8-2.7-.4-5.3-1.8-7.7-4.2s-3.8-5-4.2-7.7c-.1-.8.2-1.5.8-2l1.5-1.3Z"})])]),ne(" 연락처 ")],-1)),e("p",null,r(d.value.phone),1)])):y("",!0)]),e("section",Cs,[t[8]||(t[8]=e("h2",null,"편의시설",-1)),e("div",Is,[(a(!0),o($,null,R(d.value.amenities,(s,u)=>(a(),o("span",{key:s.name||u,class:"tag amenity-tag"},[s.icon?(a(),o("span",{key:0,class:"amenity-icon",innerHTML:s.icon},null,8,$s)):y("",!0),e("span",Ss,r(s.name),1)]))),128)),d.value.amenities.length?y("",!0):(a(),o("span",Ms,"등록된 정보 없음"))]),t[9]||(t[9]=e("h2",null,"테마",-1)),e("div",xs,[(a(!0),o($,null,R(Ce.value,s=>(a(),o("span",{key:s.name,class:"tag theme-tag"},[s.imageUrl?(a(),o("img",{key:0,src:s.imageUrl,alt:s.name,class:"theme-tag__icon"},null,8,As)):(a(),o("span",Rs)),e("span",Ns,r(s.name),1)]))),128)),Ce.value.length?y("",!0):(a(),o("span",Ts,"등록된 정보 없음"))])]),t[26]||(t[26]=e("hr",null,null,-1)),e("section",Es,[t[19]||(t[19]=e("h2",null,"추가 정보",-1)),e("dl",Ls,[e("div",Fs,[t[10]||(t[10]=e("dt",null,"체크인",-1)),e("dd",null,r(d.value.checkInTime||"정보 없음"),1)]),e("div",Ps,[t[11]||(t[11]=e("dt",null,"체크아웃",-1)),e("dd",null,r(d.value.checkOutTime||"정보 없음"),1)]),e("div",Bs,[t[12]||(t[12]=e("dt",null,"주차",-1)),e("dd",null,r(d.value.parkingInfo||"정보 없음"),1)]),e("div",qs,[t[18]||(t[18]=e("dt",null,"SNS",-1)),e("dd",null,[De.value.length?(a(!0),o($,{key:0},R(De.value,s=>(a(),o("a",{key:s.url,href:s.url,class:"sns-link",target:"_blank",rel:"noopener noreferrer","aria-label":s.label},[s.type==="instagram"?(a(),o("svg",Vs,[...t[13]||(t[13]=[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"5",ry:"5",fill:"none",stroke:"currentColor","stroke-width":"2"},null,-1),e("circle",{cx:"12",cy:"12",r:"3.5",fill:"none",stroke:"currentColor","stroke-width":"2"},null,-1),e("circle",{cx:"17.5",cy:"6.5",r:"1",fill:"currentColor"},null,-1)])])):s.type==="youtube"?(a(),o("svg",Gs,[...t[14]||(t[14]=[e("rect",{x:"3",y:"6",width:"18",height:"12",rx:"3",ry:"3",fill:"none",stroke:"currentColor","stroke-width":"2"},null,-1),e("path",{d:"M10 9l5 3-5 3z",fill:"currentColor"},null,-1)])])):s.type==="blog"?(a(),o("svg",zs,[...t[15]||(t[15]=[e("path",{d:"M6 3h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",fill:"none",stroke:"currentColor","stroke-width":"2"},null,-1),e("path",{d:"M14 3v5h5",fill:"none",stroke:"currentColor","stroke-width":"2"},null,-1),e("path",{d:"M8 13h8M8 17h6",fill:"none",stroke:"currentColor","stroke-width":"2"},null,-1)])])):s.type==="facebook"?(a(),o("svg",Hs,[...t[16]||(t[16]=[e("path",{d:"M15 8h3V5h-3c-2 0-4 2-4 4v3H8v3h3v6h3v-6h3l1-3h-4V9c0-.6.4-1 1-1z",fill:"currentColor"},null,-1)])])):(a(),o("svg",Ks,[...t[17]||(t[17]=[e("path",{d:"M10 13a5 5 0 0 0 7.07 0l2.83-2.83a5 5 0 0 0-7.07-7.07L11 4",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M14 11a5 5 0 0 0-7.07 0L4.1 13.83a5 5 0 0 0 7.07 7.07L13 20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])),e("span",Ys,r(s.type==="blog"&&s.label.toLowerCase().includes("naver")?"네이버 블로그 바로가기":`${s.label} 바로가기`),1)],8,Us))),128)):(a(),o("span",Zs,r(d.value.sns||"정보 없음"),1))])])])]),t[27]||(t[27]=e("hr",null,null,-1)),e("section",Ws,[e("div",Qs,[t[20]||(t[20]=e("h2",null,"객실 선택",-1)),c.value.length>0?(a(),o("button",{key:0,type:"button",class:"coupon-header-btn",onClick:t[1]||(t[1]=s=>x.value=!0)}," 쿠폰함 ")):y("",!0)]),e("div",Js,[e("div",Xs,[e("div",{ref_key:"datePickerRef",ref:v,class:"picker-field date-picker-wrapper",onClick:t[2]||(t[2]=Q(()=>{},["stop"]))},[t[21]||(t[21]=e("label",null,"체크인 / 체크아웃",-1)),e("button",{type:"button",class:"date-display","aria-expanded":B.value,onClick:Ve},r(re(l).checkInOutText),9,Os),B.value?(a(),o("div",js,[e("div",en,[e("button",{class:"calendar-nav-btn nav-prev",type:"button",onClick:Ge}," ‹ "),e("div",tn,[e("div",sn,r(X.value)+"년 "+r(me[O.value]),1),e("div",nn,[(a(),o($,null,R(ge,s=>e("span",{key:"current-"+s,class:"weekday"},r(s),1)),64))]),e("div",an,[(a(!0),o($,null,R(qe.value,(s,u)=>(a(),o("span",{key:"current-day-"+u,class:Y(["calendar-day",{empty:s.isEmpty,today:s.isToday,"weekend-sat":s.isSaturday,"weekend-sun":s.isSunday,holiday:s.isHoliday,"range-start":s.isStartDate,"range-end":s.isEndDate,"in-range":s.isInRange,"has-end":s.isStartDate&&s.hasEndDate}]),onClick:k=>fe(s)},r(s.day),11,on))),128))])]),e("div",ln,[e("div",rn,r(he.value)+"년 "+r(me[ye.value]),1),e("div",cn,[(a(),o($,null,R(ge,s=>e("span",{key:"next-"+s,class:"weekday"},r(s),1)),64))]),e("div",un,[(a(!0),o($,null,R(Ue.value,(s,u)=>(a(),o("span",{key:"next-day-"+u,class:Y(["calendar-day",{empty:s.isEmpty,today:s.isToday,"weekend-sat":s.isSaturday,"weekend-sun":s.isSunday,holiday:s.isHoliday,"range-start":s.isStartDate,"range-end":s.isEndDate,"in-range":s.isInRange,"has-end":s.isStartDate&&s.hasEndDate}]),onClick:k=>fe(s)},r(s.day),11,dn))),128))])]),e("button",{class:"calendar-nav-btn nav-next",type:"button",onClick:ze}," › ")])])):y("",!0)],512),e("div",vn,[t[22]||(t[22]=e("label",null,"투숙 인원",-1)),e("div",mn,[e("button",{onClick:Oe,disabled:re(l).guestCount<=1},"-",8,gn),e("span",null,"게스트 "+r(re(l).guestCount||1)+"명",1),e("button",{onClick:Xe},"+")])])])]),Ee.value?(a(),o("div",pn," 예약 가능한 객실이 없습니다. 날짜나 인원수를 변경해 주세요. ")):(a(),o("div",hn,[(a(!0),o($,null,R(Ne.value,s=>(a(),o("div",{key:s.id,class:Y(["room-card",{selected:g.value?.id===s.id,unavailable:!s.available}]),onClick:u=>s.available&&Ye(s)},[e("div",kn,[e("img",{src:s.thumbnailUrl,alt:s.name,loading:"lazy"},null,8,fn),s.available?y("",!0):(a(),o("span",_n,"사용 중지"))]),e("div",bn,[e("div",wn,[e("h3",null,r(s.name),1),e("p",null,r(s.desc),1),e("span",Dn,"최대 "+r(s.capacity)+"명",1)]),e("div",Cn,[e("div",In,"₩"+r(be(s.price)),1),e("button",{class:Y(["select-btn",{active:g.value?.id===s.id}]),disabled:!s.available},r(s.available?g.value?.id===s.id?"선택됨":"객실":"사용 중지"),11,$n)])])],10,yn))),128))])),Te.value?(a(),o("div",Sn,[e("button",{type:"button",class:"room-toggle-btn",onClick:t[3]||(t[3]=s=>H.value=!H.value)},r(H.value?"접기":"더보기"),1)])):y("",!0)]),t[28]||(t[28]=e("hr",null,null,-1)),ie(ns,{reviews:d.value.reviews,name:d.value.name},null,8,["reviews","name"]),ie(rs,{latitude:d.value.latitude,longitude:d.value.longitude,address:d.value.address,"transport-info":d.value.transportInfo},null,8,["latitude","longitude","address","transport-info"]),t[29]||(t[29]=e("section",{class:"section rules-section"},[e("div",{class:"rule-box"},[e("h3",null,"환불 규정"),e("ul",null,[e("li",null,"체크인 7일 전 취소: 결제 금액 100% 환불"),e("li",null,"체크인 5~6일 전 취소: 결제 금액의 90% 환불"),e("li",null,"체크인 3~4일 전 취소: 결제 금액의 70% 환불"),e("li",null,"체크인 1~2일 전 취소: 결제 금액의 50% 환불"),e("li",null,"체크인 당일 취소 또는 노쇼(No-show): 환불 불가")])])],-1)),e("div",Mn,[e("div",xn,[g.value?(a(),o("span",An,"선택한 객실: "+r(g.value.name),1)):(a(),o("span",Rn,"객실을 선택해주세요")),g.value?(a(),o("div",Nn,"₩"+r(be(g.value.price)),1)):y("",!0)]),e("button",{class:"book-btn",disabled:!oe.value,onClick:je},"예약하기",8,Tn)]),g.value&&!oe.value?(a(),o("div",En,[t[23]||(t[23]=ne(" 날짜를 선택해주세요. ",-1)),e("button",{type:"button",class:"booking-hint-btn",onClick:et}," 날짜 선택하기 ")])):y("",!0),x.value?(a(),o("div",{key:1,class:"modal-overlay",onClick:t[5]||(t[5]=Q(s=>x.value=!1,["self"]))},[e("div",Ln,[t[24]||(t[24]=e("h3",null,"사용 가능한 쿠폰",-1)),t[25]||(t[25]=e("p",{class:"modal-desc"},"이 숙소에서 사용할 수 있는 쿠폰을 다운로드하세요.",-1)),e("div",Fn,[c.value.length>0?(a(),o("ul",Pn,[(a(!0),o($,null,R(c.value,s=>(a(),o("li",{key:s.couponId,class:"coupon-item"},[e("div",Bn,[e("div",qn,r(s.name),1),e("div",Un,r(s.description),1),e("div",Vn,[e("span",null,r(s.discountType==="PERCENT"?s.discountValue+"%":s.discountValue.toLocaleString()+"원")+" 할인",1),s.minPrice?(a(),o("span",Gn,"("+r(s.minPrice.toLocaleString())+"원 이상)",1)):y("",!0)])]),e("button",{class:Y(["download-btn",{downloaded:A.value.has(String(s.couponId))}]),disabled:A.value.has(String(s.couponId)),onClick:u=>tt(s)},r(A.value.has(String(s.couponId))?"발급완료":"다운로드"),11,zn)]))),128))])):(a(),o("p",Hn,"다운로드 가능한 쿠폰이 없습니다."))]),e("button",{class:"close-modal-btn",onClick:t[4]||(t[4]=s=>x.value=!1)},"닫기")])])):y("",!0)],64))]))}},On=j(Kn,[["__scopeId","data-v-d58872f8"]]);export{On as default};
