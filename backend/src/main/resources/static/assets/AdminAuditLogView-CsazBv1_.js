import{_ as ct,r as i,b as pt,s as vt,y as mt,c as p,e,m as gt,d as T,t as o,C as _,E as I,I as Z,a as q,w as tt,n as F,H as bt,k as yt,o as v,F as _t,f as ft,z as Dt}from"./index-D-t2vnuJ.js";import{A as St}from"./AdminTableCard-CiQvKoMq.js";import{d as ht}from"./adminApi-DEH9EAim.js";import{t as et,e as wt,a as At}from"./adminData-ZmZ3C3cR.js";import{e as Tt,a as kt}from"./reportExport-BKny35g8.js";const $={ACCOMMODATIONS:"/admin/accommodations",USERS:"/admin/users",PAYMENTS:"/admin/payments",REPORTS:"/admin/reports"},Et={class:"admin-page"},Ct={class:"admin-page__header"},It={class:"admin-summary-chip"},$t={class:"admin-filter-bar"},Nt={class:"admin-filter-group"},Rt={class:"admin-preset-group"},xt={class:"admin-filter-group"},Vt={class:"admin-filter-group"},Mt={class:"admin-filter-group"},Ut=["onKeydown"],Pt=["onKeydown"],Lt={class:"admin-audit-table admin-table--nowrap"},Ot={class:"is-center"},Ft={class:"is-center"},Yt={class:"is-center"},zt=["disabled","onClick"],Bt={class:"admin-audit-reason col-reason"},Jt=["title"],Kt={class:"reason-text__content"},Ht={class:"is-center"},Xt={class:"admin-admin-cell"},Qt={class:"admin-admin-cell__name"},Wt={class:"admin-admin-cell__id"},jt={class:"is-center"},Gt=["onClick"],Zt={key:0},qt={key:0,class:"admin-status"},te={key:1,class:"admin-status"},ee={key:2,class:"admin-pagination"},ae=["disabled"],ne=["disabled"],se={class:"admin-modal__content"},oe={class:"admin-modal__body"},le={class:"admin-modal__row"},ie={class:"admin-modal__row"},de={class:"admin-modal__row"},re={class:"admin-modal__row"},ue={class:"admin-modal__row admin-modal__row--detail"},ce={key:0,class:"admin-modal__row admin-modal__row--detail"},pe={class:"admin-modal__row"},ve={class:"admin-modal__row admin-modal__row--detail"},me={class:"admin-modal__row"},ge={__name:"AdminAuditLogView",setup(be){const f=i([]),m=i("all"),g=i("all"),D=i(""),S=i(""),c=i(""),r=i(""),s=i(0),N=i(20),R=i(0),x=i(0),k=i(!1),h=i(""),w=vt(),Y=yt(),V=i(!1),d=i(null),M=a=>{if(!a)return"-";const t=new Date(a);if(Number.isNaN(t.getTime()))return String(a);const n=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),C=String(t.getDate()).padStart(2,"0"),y=String(t.getHours()).padStart(2,"0"),u=String(t.getMinutes()).padStart(2,"0");return`${n}-${l}-${C} ${y}:${u}`},z=a=>{if(!a)return"";const t=String(a).trim();return t&&/^\d+$/.test(t)?t:""},A=a=>{if(!a)return"";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0");return`${t}-${n}-${l}`},B=()=>{const a=new Date,t=new Date;t.setDate(a.getDate()-6),c.value=A(t),r.value=A(a)},b=a=>{const t={...w.query,...a},n=et(t),l=et(w.query);Object.keys({...n,...l}).every(y=>String(n[y]??"")===String(l[y]??""))||Y.replace({query:n})},J=async()=>{k.value=!0,h.value="";const a=z(D.value),t=await ht({startDate:c.value||void 0,endDate:r.value||void 0,actionType:m.value==="all"?void 0:m.value,targetType:g.value==="all"?void 0:g.value,targetIdExact:a||void 0,keyword:S.value||void 0,page:s.value,size:N.value});if(t.ok&&t.data){const n=t.data;f.value=wt(n);const l=At(n);s.value=l.page,N.value=l.size,R.value=l.totalPages,x.value=l.totalElements}else h.value="감사 로그를 불러오지 못했습니다.";k.value=!1},U=a=>{const t=new Date,n=new Date;n.setDate(t.getDate()-(a-1)),c.value=A(n),r.value=A(t),s.value=0,b({startDate:c.value,endDate:r.value,page:s.value})},at=()=>{s.value=0,b({actionType:m.value==="all"?void 0:m.value,page:s.value})},nt=()=>{s.value=0,b({targetType:g.value==="all"?void 0:g.value,page:s.value})},P=()=>{s.value=0,b({targetIdExact:z(D.value)||void 0,keyword:S.value||void 0,page:s.value})},K=()=>{s.value=0,b({startDate:c.value||void 0,endDate:r.value||void 0,page:s.value})},H=a=>{s.value=a,b({page:s.value})},E=a=>!a||String(a).trim()===""?"-":String(a),st={APPROVE:"승인",REJECT:"반려",REFUND:"환불",BAN:"정지",UNBAN:"해제",RESOLVE:"처리"},ot={APPROVE:"success",REJECT:"danger",REFUND:"accent",BAN:"warning",UNBAN:"neutral",RESOLVE:"primary"},lt={ACC:"숙소",USER:"회원",PAY:"결제",REVIEW:"리뷰"},L=a=>lt[a]??a??"-",O=a=>st[a]??a??"-",it=a=>ot[a]??"neutral",X=a=>{const t=a?.adminUsername,n=a?.adminId;return t&&n?`${t} (#${n})`:t||(n?`#${n}`:"-")},Q=a=>{const t=a?.targetId;return t?a?.targetType==="ACC"?`${$.ACCOMMODATIONS}?highlight=${t}`:a?.targetType==="USER"?`${$.USERS}?highlight=${t}`:a?.targetType==="PAY"?`${$.PAYMENTS}?highlight=${t}`:a?.targetType==="REVIEW"?`${$.REPORTS}?highlight=${t}`:null:null},dt=a=>{const t=Q(a);t&&Y.push(t)},rt=a=>{d.value=a},W=()=>{d.value=null},ut=a=>{m.value=a.actionType??"all",g.value=a.targetType??"all",D.value=a.targetIdExact??"",S.value=a.keyword??"",s.value=Number(a.page??0),N.value=Number(a.size??20),a.startDate?c.value=a.startDate:B(),a.endDate?r.value=a.endDate:r.value=r.value||A(new Date)};pt(()=>{B(),(!w.query.startDate||!w.query.endDate)&&(V.value=!0,b({startDate:c.value,endDate:r.value,page:s.value}))}),mt(()=>w.query,a=>{V.value&&(!a.startDate||!a.endDate)||(V.value=!1,ut(a),J())},{immediate:!0});const j=a=>{if(!a)return"-";try{const t=typeof a=="string"?JSON.parse(a):a;return JSON.stringify(t,null,2)}catch{return String(a)}},G=a=>{if(!f.value.length)return;const t=c.value||"from",n=r.value||"to",l=`admin-audit-logs_${t}_${n}.${a}`,C=f.value.map(u=>({time:M(u.createdAt),action:O(u.actionType),targetType:L(u.targetType),targetId:u.targetId??"-",reason:E(u.reason),admin:X(u),requestIp:u.requestIp??"-",userAgent:u.userAgent??"-",metadata:j(u.metadataJson)})),y={name:"감사 로그",columns:[{key:"time",label:"시간(YYYY-MM-DD HH:mm)"},{key:"action",label:"액션"},{key:"targetType",label:"대상 타입"},{key:"targetId",label:"대상ID"},{key:"reason",label:"사유"},{key:"admin",label:"관리자"},{key:"requestIp",label:"요청 IP"},{key:"userAgent",label:"User-Agent"},{key:"metadata",label:"변경 메타데이터(JSON)"}],rows:C};if(a==="xlsx"){Tt({filename:l,sheets:[y]});return}kt({filename:l,sheets:[y]})};return(a,t)=>(v(),p("section",Et,[e("header",Ct,[t[13]||(t[13]=e("div",null,[e("h1",{class:"admin-title"},"감사 로그"),e("p",{class:"admin-subtitle"},"관리자 주요 액션 기록을 조회합니다.")],-1)),e("div",It," 총 "+o(x.value.toLocaleString())+"건 ",1)]),e("div",$t,[e("div",Nt,[t[14]||(t[14]=e("span",{class:"admin-chip"},"기간",-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>c.value=n),class:"admin-input",type:"date",onChange:K},null,544),[[I,c.value]]),t[15]||(t[15]=e("span",{class:"admin-divider"},"~",-1)),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>r.value=n),class:"admin-input",type:"date",onChange:K},null,544),[[I,r.value]]),e("div",Rt,[e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:t[2]||(t[2]=n=>U(7))},"최근 7일(오늘 포함)"),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:t[3]||(t[3]=n=>U(30))},"최근 30일(오늘 포함)"),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:t[4]||(t[4]=n=>U(90))},"최근 90일(오늘 포함)")])]),e("div",xt,[t[17]||(t[17]=e("span",{class:"admin-chip"},"액션 필터",-1)),_(e("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>m.value=n),class:"admin-select",onChange:at},[...t[16]||(t[16]=[q('<option value="all" data-v-b1ec2bc3>전체</option><option value="APPROVE" data-v-b1ec2bc3>승인</option><option value="REJECT" data-v-b1ec2bc3>반려</option><option value="REFUND" data-v-b1ec2bc3>환불</option><option value="BAN" data-v-b1ec2bc3>정지</option><option value="UNBAN" data-v-b1ec2bc3>해제</option>',6)])],544),[[Z,m.value]])]),e("div",Vt,[t[19]||(t[19]=e("span",{class:"admin-chip"},"대상 타입",-1)),_(e("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>g.value=n),class:"admin-select",onChange:nt},[...t[18]||(t[18]=[q('<option value="all" data-v-b1ec2bc3>전체</option><option value="ACC" data-v-b1ec2bc3>숙소</option><option value="USER" data-v-b1ec2bc3>회원</option><option value="PAY" data-v-b1ec2bc3>결제</option><option value="REVIEW" data-v-b1ec2bc3>리뷰/신고</option>',5)])],544),[[Z,g.value]])]),e("div",Mt,[t[20]||(t[20]=e("span",{class:"admin-chip"},"검색",-1)),_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=n=>D.value=n),class:"admin-input",type:"search",placeholder:"대상 ID로 검색",onKeydown:tt(F(P,["prevent"]),["enter"])},null,40,Ut),[[I,D.value]]),_(e("input",{"onUpdate:modelValue":t[8]||(t[8]=n=>S.value=n),class:"admin-input",type:"search",placeholder:"사유/대상 타입/관리자ID 등",onKeydown:tt(F(P,["prevent"]),["enter"])},null,40,Pt),[[I,S.value]]),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:P},"검색"),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:t[9]||(t[9]=n=>G("csv"))},"CSV"),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:t[10]||(t[10]=n=>G("xlsx"))},"XLSX")])]),gt(St,{title:"감사 로그",class:"admin-audit-card"},{default:bt(()=>[e("table",Lt,[t[22]||(t[22]=e("colgroup",null,[e("col",{style:{width:"170px"}}),e("col",{style:{width:"90px"}}),e("col",{style:{width:"90px"}}),e("col",{style:{width:"110px"}}),e("col",{class:"col-reason"}),e("col",{style:{width:"170px"}}),e("col",{style:{width:"80px"}})],-1)),t[23]||(t[23]=e("thead",null,[e("tr",null,[e("th",null,"시간"),e("th",{class:"is-center"},"액션"),e("th",{class:"is-center"},"대상"),e("th",{class:"is-center"},"대상ID"),e("th",{class:"col-reason"},"사유"),e("th",{class:"is-center"},"관리자"),e("th",{class:"is-center"},"상세")])],-1)),e("tbody",null,[(v(!0),p(_t,null,ft(f.value,n=>(v(),p("tr",{key:n.logId},[e("td",null,o(M(n.createdAt)),1),e("td",Ot,[e("span",{class:Dt(["admin-action-badge",`admin-action-badge--${it(n.actionType)}`])},o(O(n.actionType)),3)]),e("td",Ft,o(L(n.targetType)),1),e("td",Yt,[e("button",{class:"admin-link-button",type:"button",disabled:!Q(n),onClick:l=>dt(n)},o(n.targetId),9,zt)]),e("td",Bt,[e("span",{class:"reason-text",title:E(n.reason)},[e("span",Kt,o(E(n.reason)),1)],8,Jt)]),e("td",Ht,[e("div",Xt,[e("span",Qt,o(n.adminUsername??"-"),1),e("span",Wt,"#"+o(n.adminId??"-"),1)])]),e("td",jt,[e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:l=>rt(n)},"상세",8,Gt)])]))),128)),!f.value.length&&!k.value&&!h.value?(v(),p("tr",Zt,[...t[21]||(t[21]=[e("td",{class:"admin-audit-empty",colspan:"7"},"조건에 맞는 로그가 없습니다.",-1)])])):T("",!0)])]),k.value?(v(),p("div",qt,"불러오는 중...")):h.value?(v(),p("div",te,[e("span",null,o(h.value),1),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:J},"다시 시도")])):T("",!0),x.value>0?(v(),p("div",ee,[e("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:s.value<=0,onClick:t[11]||(t[11]=n=>H(s.value-1))}," 이전 ",8,ae),e("span",null,o(s.value+1)+" / "+o(Math.max(R.value,1)),1),e("button",{class:"admin-btn admin-btn--ghost",type:"button",disabled:s.value+1>=R.value,onClick:t[12]||(t[12]=n=>H(s.value+1))}," 다음 ",8,ne)])):T("",!0)]),_:1}),d.value?(v(),p("div",{key:0,class:"admin-modal",onClick:F(W,["self"])},[e("div",se,[e("div",{class:"admin-modal__head"},[t[24]||(t[24]=e("h3",null,"감사 로그 상세",-1)),e("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:W},"닫기")]),e("div",oe,[e("div",le,[t[25]||(t[25]=e("span",null,"시간",-1)),e("strong",null,o(M(d.value.createdAt)),1)]),e("div",ie,[t[26]||(t[26]=e("span",null,"액션",-1)),e("strong",null,o(O(d.value.actionType)),1)]),e("div",de,[t[27]||(t[27]=e("span",null,"대상",-1)),e("strong",null,o(L(d.value.targetType)),1)]),e("div",re,[t[28]||(t[28]=e("span",null,"대상ID",-1)),e("strong",null,o(d.value.targetId??"-"),1)]),e("div",ue,[t[29]||(t[29]=e("span",null,"사유",-1)),e("p",null,o(E(d.value.reason)),1)]),d.value.metadataJson?(v(),p("div",ce,[t[30]||(t[30]=e("span",null,"변경 내용",-1)),e("pre",null,o(j(d.value.metadataJson)),1)])):T("",!0),e("div",pe,[t[31]||(t[31]=e("span",null,"요청 IP",-1)),e("strong",null,o(d.value.requestIp??"-"),1)]),e("div",ve,[t[32]||(t[32]=e("span",null,"User-Agent",-1)),e("p",null,o(d.value.userAgent??"-"),1)]),e("div",me,[t[33]||(t[33]=e("span",null,"관리자ID",-1)),e("strong",null,o(X(d.value)),1)])])])])):T("",!0)]))}},he=ct(ge,[["__scopeId","data-v-b1ec2bc3"]]);export{he as default};
