import{_ as B,r as m,q as u,b as E,y as I,c as r,e as n,C as U,I as F,d as f,F as W,f as L,t as y,l as h,k as M,o}from"./index-CMhx5Eqk.js";import{a as O}from"./reportExport-DvZZ7m0X.js";import{A as H}from"./AdminStatCard-CeRT2I1g.js";import{a as K,t as k,b as P,f as T,A as G}from"./chartSeries-Chxv7KBi.js";import{c as Q}from"./adminApi-ikFfbPlF.js";import"./AdminBadge-BD_Hrkfc.js";const X={class:"admin-page"},j={class:"admin-page__header"},z={class:"admin-inline-actions admin-inline-actions--nowrap"},J={class:"admin-grid"},Y={key:0,class:"admin-status"},Z={key:1,class:"admin-status"},ee={class:"admin-card admin-report-card"},ae={class:"admin-card__head"},te={class:"admin-card__title"},se={key:0,class:"admin-chip admin-chip--muted"},ne={class:"admin-chart-area"},oe={key:0,class:"admin-status"},le={__name:"AdminWeeklyReportView",setup(ue){const l=m(7),a=m(null),v=m(!1),c=m(""),g=M(),C=e=>K(e),w=e=>e?String(e).slice(0,10):"",p=async()=>{v.value=!0,c.value="";const e=await Q({days:l.value});e.ok&&e.data?a.value=e.data:c.value="주간 리포트를 불러오지 못했습니다.",v.value=!1},D=u(()=>{if(!a.value)return[];const{from:e,to:s}=_(),t=e&&s?{from:e,to:s}:{};return[{label:"예약 수",value:`${a.value.reservationCount??0}건`,sub:"선택 기간",tone:"primary",to:{path:"/admin/bookings",query:t}},{label:"결제 성공",value:`${a.value.paymentSuccessCount??0}건`,sub:"완료 기준",tone:"success",to:{path:"/admin/payments",query:{status:"SUCCESS",...t}}},{label:"취소",value:`${a.value.cancelCount??0}건`,sub:"예약 취소",tone:"neutral",to:{path:"/admin/bookings",query:{status:"canceled",...t}}},{label:"환불",value:`${a.value.refundCount??0}건`,sub:C(a.value.refundAmount),tone:"warning",to:{path:"/admin/payments",query:{status:"REFUNDED",type:"REFUND",...t}}},{label:"신규 가입자",value:`${a.value.newUsers??0}명`,sub:"전체 계정",tone:"accent",to:{path:"/admin/users",query:t}},{label:"신규 숙소",value:`${a.value.newAccommodations??0}개`,sub:"등록 완료",tone:"primary",to:{path:"/admin/accommodations",query:t}},{label:"승인 대기 숙소",value:`${a.value.pendingAccommodations??0}개`,sub:"심사 대기",tone:"warning",to:{path:"/admin/accommodations",query:{status:"PENDING",...t}}},{label:"신규 호스트",value:`${a.value.newHosts??0}명`,sub:"전환 기준",tone:"success",to:{path:"/admin/users",query:{role:"HOST",...t}}}]}),_=()=>{if(a.value?.from&&a.value?.to)return{from:a.value.from,to:a.value.to};const e=new Date,s=new Date;return s.setDate(e.getDate()-(Number(l.value??7)-1)),{from:k(s),to:k(e)}},d=u(()=>{if(!a.value)return[];const e=a.value.revenueSeries??[],{from:s,to:t}=_(),b=P(s,t),q=T(b,e,i=>w(i.date),i=>i.value);return b.map((i,V)=>({date:i,value:q[V]}))}),S=u(()=>d.value.some(e=>Number(e.value??0)>0)),R=u(()=>d.value.map(e=>e.date)),$=u(()=>d.value.map(e=>Number(e.value??0))),x=u(()=>Number(l.value)>10?8:7),A=()=>{if(!a.value)return;const e=d.value.map(s=>({date:s.date,revenue:s.value??0}));O({filename:`admin-weekly-report-${a.value.from}-to-${a.value.to}.csv`,sheets:[{name:"일별 매출",columns:[{key:"date",label:"날짜"},{key:"revenue",label:"매출"}],rows:e}]})};E(p),I(l,p);const N=e=>{e?.to&&g.push(e.to)};return(e,s)=>(o(),r("section",X,[n("header",j,[s[2]||(s[2]=n("div",null,[n("h1",{class:"admin-title"},"주간 리포트"),n("p",{class:"admin-subtitle"},"선택 기간의 KPI와 매출 추이를 요약합니다.")],-1)),n("div",z,[U(n("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>l.value=t),class:"admin-select"},[...s[1]||(s[1]=[n("option",{value:7},"최근 7일",-1),n("option",{value:30},"최근 30일",-1)])],512),[[F,l.value]]),n("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:A},"CSV 다운로드")])]),n("div",J,[(o(!0),r(W,null,L(D.value,t=>(o(),h(H,{key:t.label,label:t.label,value:t.value,sub:t.sub,tone:t.tone,clickable:!!t.to,onClick:b=>N(t)},null,8,["label","value","sub","tone","clickable","onClick"]))),128)),v.value?(o(),r("div",Y,"불러오는 중...")):c.value?(o(),r("div",Z,[n("span",null,y(c.value),1),n("button",{class:"admin-btn admin-btn--ghost",type:"button",onClick:p},"다시 시도")])):f("",!0)]),n("div",ee,[n("div",ae,[n("div",null,[s[3]||(s[3]=n("p",{class:"admin-card__eyebrow"},"일별 매출",-1)),n("h3",te,y(a.value?.from??"-")+" ~ "+y(a.value?.to??"-"),1)]),a.value&&!a.value.statsReady?(o(),r("span",se,"통계 데이터 준비 중")):f("",!0)]),n("div",ne,[S.value?(o(),h(G,{key:1,labels:R.value,values:$.value,height:260,"max-x-ticks":x.value},null,8,["labels","values","max-x-ticks"])):(o(),r("div",oe,"표시할 데이터가 없습니다."))])])]))}},pe=B(le,[["__scopeId","data-v-d6cfc538"]]);export{pe as default};
